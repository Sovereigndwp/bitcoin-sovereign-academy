<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Bitcoin Sovereign Game</title>
    <meta name="description" content="Interactive demo exploring monetary sovereignty tradeoffs across personas." />
    <style>
      :root {
        --bg: #0b0e14;
        --panel: #121723;
        --text: #e6edf3;
        --muted: #9aa4b2;
        --accent: #f59e0b;
        --accent-2: #22d3ee;
        --ok: #10b981;
        --warn: #f59e0b;
        --bad: #ef4444;
        --border: #202938;
        --chip: #1b2433;
        --link: #7dd3fc;
        color-scheme: dark light;
      }
      @media (prefers-color-scheme: light) {
        :root {
          --bg: #f8fafc;
          --panel: #ffffff;
          --text: #0f172a;
          --muted: #475569;
          --accent: #b45309;
          --accent-2: #0891b2;
          --ok: #059669;
          --warn: #b45309;
          --bad: #b91c1c;
          --border: #e2e8f0;
          --chip: #f1f5f9;
          --link: #0369a1;
        }
      }

      html, body {
        margin: 0;
        padding: 0;
        background: var(--bg);
        color: var(--text);
        font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }

      .wrap {
        max-width: 960px;
        margin: 0 auto;
        padding: 24px;
      }

      header {
        display: grid;
        gap: 8px;
        margin-bottom: 16px;
      }

      h1 {
        margin: 0;
        font-size: 1.75rem;
        letter-spacing: 0.2px;
      }

      .muted {
        color: var(--muted);
        font-size: 0.95rem;
      }

      .panel {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 16px;
      }

      .row {
        display: grid;
        gap: 12px;
      }
      @media (min-width: 720px) {
        .row {
          grid-template-columns: 1fr 1fr;
        }
      }

      label {
        font-weight: 600;
        font-size: 0.95rem;
      }
      select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid var(--border);
        background: var(--chip);
        color: var(--text);
      }

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .chip {
        background: var(--chip);
        border: 1px solid var(--border);
        color: var(--muted);
        font-size: 0.85rem;
        border-radius: 999px;
        padding: 6px 10px;
      }

      .section-title {
        font-size: 1.05rem;
        font-weight: 700;
        margin: 2px 0 8px;
      }

      .scenario {
        display: grid;
        gap: 10px;
      }

      .choices {
        display: grid;
        gap: 8px;
      }
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(0,0,0,0.04));
        color: var(--text);
        cursor: pointer;
        text-decoration: none;
        user-select: none;
      }
      .btn:hover { border-color: var(--accent-2); }
      .btn.ok { box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--ok) 40%, transparent); }
      .btn.warn { box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--warn) 40%, transparent); }
      .btn.bad { box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--bad) 40%, transparent); }

      /* Lightweight, accessible tooltips */
      .tip {
        position: relative;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 0 6px;
        margin: 0 2px;
        border-radius: 6px;
        color: var(--accent-2);
        cursor: help;
        text-decoration: underline dotted;
        text-underline-offset: 2px;
      }
      .tip:focus-visible {
        outline: 2px solid var(--accent-2);
        outline-offset: 2px;
      }
      .tip::after {
        content: attr(data-tip);
        position: absolute;
        left: 0;
        bottom: calc(100% + 8px);
        min-width: 240px;
        max-width: min(70vw, 420px);
        background: var(--panel);
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 10px 12px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.35);
        opacity: 0;
        pointer-events: none;
        transform: translateY(4px);
        transition: opacity 160ms ease, transform 160ms ease;
        z-index: 30;
        white-space: normal;
      }
      .tip:hover::after,
      .tip:focus-visible::after,
      .tip[data-open="true"]::after {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }

      .grid-2 {
        display: grid;
        gap: 12px;
      }
      @media (min-width: 900px) {
        .grid-2 {
          grid-template-columns: 1.2fr 0.8fr;
        }
      }

      .scoreboard {
        display: grid;
        gap: 8px;
      }
      .score {
        display: flex;
        justify-content: space-between;
        background: var(--chip);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 8px 10px;
        font-size: 0.95rem;
      }
      .score .v { color: var(--muted); }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>Bitcoin Sovereign Game</h1>
        <p class="muted">
          Explore trade-offs across personas. Hover or focus terms like
          <span class="tip" tabindex="0" role="button" aria-label="CBDC definition" data-tip="Central Bank Digital Currency — a digital liability of the central bank that can be programmable, censored, and surveilled.">CBDC</span>,
          <span class="tip" tabindex="0" role="button" aria-label="KYC definition" data-tip="Know Your Customer — identity verification to access regulated financial services, often tied to AML/CFT rules.">KYC</span>, and
          <span class="tip" tabindex="0" role="button" aria-label="UTXO definition" data-tip="Unspent Transaction Output — the fundamental unit Bitcoin tracks to represent spendable coins; each spend creates new UTXOs.">UTXO</span>
          for quick definitions.
        </p>
      </header>

      <section class="panel row" aria-labelledby="persona-heading">
        <div>
          <div class="section-title" id="persona-heading">Choose your persona</div>
          <label for="persona">Persona</label>
          <select id="persona" name="persona" aria-describedby="persona-hint">
            <option value="citizen">Citizen</option>
            <option value="merchant">Merchant</option>
            <option value="developer">Developer</option>
            <option value="miner">Miner</option>
            <option value="regulator">Regulator</option>
            <option value="dissident">Dissident</option>
            <option value="journalist">Journalist</option>
          </select>
          <p id="persona-hint" class="muted" style="margin: 8px 0 0;">
            Your starting advantages and risks adapt to your role.
          </p>
          <div id="persona-desc" class="muted" style="margin-top: 8px;"></div>
        </div>

        <div>
          <div class="section-title">Capabilities & risks</div>
          <div class="chips" id="persona-tags" aria-live="polite"></div>
        </div>
      </section>

      <section class="grid-2" style="margin-top: 16px;">
        <div class="panel scenario" aria-labelledby="scenario-heading">
          <div class="section-title" id="scenario-heading">Scenario: Onboarding</div>
          <p id="scenario-text">
            You’re opening a digital wallet. A centralized provider offers fast onboarding,
            but requires
            <span class="tip" tabindex="0" role="button" data-tip="KYC captures personally identifying information (PII) that can be linked to transactions and shared across institutions.">KYC</span>
            and may enforce account freezes. A self-custodial Bitcoin wallet preserves
            sovereignty, but you’re responsible for security and backups.
          </p>

          <div class="choices" role="group" aria-label="Onboarding choices">
            <button class="btn ok" data-choice="self-custody">Use a self-custodial Bitcoin wallet</button>
            <button class="btn warn" data-choice="custodial">Use a custodial wallet (KYC required)</button>
            <button class="btn bad" data-choice="cbdc">Use a CBDC wallet (full compliance)</button>
          </div>
          <p class="muted" id="choice-outcome" aria-live="polite"></p>
        </div>

        <aside class="panel scoreboard" aria-labelledby="score-heading">
          <div class="section-title" id="score-heading">Scoreboard</div>
          <div class="score"><span>Sovereignty</span><span class="v" id="sov-v">50</span></div>
          <div class="score"><span>Privacy</span><span class="v" id="priv-v">50</span></div>
          <div class="score"><span>Convenience</span><span class="v" id="conv-v">50</span></div>
          <div class="score"><span>Compliance</span><span class="v" id="comp-v">50</span></div>
        </aside>
      </section>

      <section class="panel" style="margin-top: 16px;">
        <div class="section-title">Quick glossary</div>
        <p class="muted">
          Click or hover these terms anywhere on the page to learn more:
          <span class="tip" tabindex="0" role="button" data-tip="Censorship resistance — the difficulty for any third party to block, reverse, or prevent valid transactions.">Censorship resistance</span>,
          <span class="tip" tabindex="0" role="button" data-tip="Programmability — the ability to embed rules into money transfers (e.g., time locks, allow/deny lists). In CBDCs this can include policy-enforced spending controls.">Programmability</span>,
          <span class="tip" tabindex="0" role="button" data-tip="Self-custody — you control your private keys; no third party can move your funds. Comes with responsibility for key management.">Self-custody</span>.
        </p>
      </section>
    </div>

    <script>
      // Persona descriptions and tags
      const personaData = {
        citizen: {
          desc: "Everyday user seeking savings stability, reasonable privacy, and payment freedom.",
          tags: ["Saves in BTC", "Needs UX", "Privacy-aware", "Travels occasionally"]
        },
        merchant: {
          desc: "Business owner balancing chargeback risk, fees, settlement finality, and accounting.",
          tags: ["Wants finality", "Low fees", "Compliance pressure", "Recurring payouts"]
        },
        developer: {
          desc: "Builder optimizing for openness, composability, and minimizing platform lock-in.",
          tags: ["Open protocols", "Composability", "Prefers OSS", "Avoids lock-in"]
        },
        miner: {
          desc: "Secures the network; sensitive to energy policy, fee markets, and jurisdiction.",
          tags: ["Capex heavy", "Policy risk", "Revenue volatility", "Jurisdiction-aware"]
        },
        regulator: {
          desc: "Seeks consumer protection and AML/CFT while enabling innovation and competition.",
          tags: ["Risk-based controls", "Proportionality", "Market competition", "Innovation"]
        },
        dissident: {
          desc: "High-risk speech/association context; privacy and permissionlessness are critical.",
          tags: ["High privacy", "No custodian", "Offline strategies", "Censorship risk"]
        },
        journalist: {
          desc: "Investigative context; sources at risk; needs operational security.",
          tags: ["OpSec", "Source protection", "Cold paths", "Secure comms"]
        }
      };

      // Scoring knobs per choice; minimal scaffolding
      const delta = {
        "self-custody": { sov: +8, priv: +7, conv: -3, comp: -2, text: "You control keys; higher sovereignty and privacy, some UX overhead." },
        "custodial":   { sov: -4, priv: -6, conv: +6, comp: +4, text: "Fast UX and recovery; trade privacy and sovereignty for convenience." },
        "cbdc":        { sov: -10, priv: -9, conv: +5, comp: +9, text: "Programmable money with full compliance; minimal sovereignty and privacy." }
      };

      const el = (id) => document.getElementById(id);
      const personaSel = el("persona");
      const personaDesc = el("persona-desc");
      const personaTags = el("persona-tags");
      const out = el("choice-outcome");

      const meters = {
        sov: el("sov-v"),
        priv: el("priv-v"),
        conv: el("conv-v"),
        comp: el("comp-v"),
      };

      // Initialize persona panel
      function setPersona(p) {
        const data = personaData[p] || personaData.citizen;
        personaDesc.textContent = data.desc;
        personaTags.innerHTML = "";
        data.tags.forEach(t => {
          const span = document.createElement("span");
          span.className = "chip";
          span.textContent = t;
          personaTags.appendChild(span);
        });
        localStorage.setItem("bsg_persona", p);
      }

      // Read initial scores from memory or defaults
      function getScore(name) {
        return parseInt(localStorage.getItem("bsg_" + name) || "50", 10);
      }
      function setScore(name, v) {
        const clamped = Math.max(0, Math.min(100, v));
        meters[name].textContent = String(clamped);
        localStorage.setItem("bsg_" + name, String(clamped));
      }
      function nudgeScores(d) {
        setScore("sov", getScore("sov") + d.sov);
        setScore("priv", getScore("priv") + d.priv);
        setScore("conv", getScore("conv") + d.conv);
        setScore("comp", getScore("comp") + d.comp);
      }
      function resetIfMissing() {
        ["sov","priv","conv","comp"].forEach(k => {
          if (!localStorage.getItem("bsg_" + k)) setScore(k, 50);
          else meters[k].textContent = localStorage.getItem("bsg_" + k);
        });
      }

      // Bind choice buttons
      document.querySelectorAll(".choices .btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const c = btn.getAttribute("data-choice");
          const d = delta[c];
          if (!d) return;
          nudgeScores(d);
          out.textContent = d.text;
        });
      });

      // Allow click-to-toggle tooltips for touch users
      document.querySelectorAll(".tip").forEach(t => {
        t.addEventListener("click", (e) => {
          const open = t.getAttribute("data-open") === "true";
          // close all others
          document.querySelectorAll(".tip[data-open='true']").forEach(o => {
            if (o !== t) o.setAttribute("data-open", "false");
          });
          t.setAttribute("data-open", open ? "false" : "true");
          e.stopPropagation();
        });
      });
      document.addEventListener("click", () => {
        document.querySelectorAll(".tip[data-open='true']").forEach(o => o.setAttribute("data-open", "false"));
      });

      // Boot
      (function init() {
        resetIfMissing();
        const savedPersona = localStorage.getItem("bsg_persona") || "citizen";
        personaSel.value = savedPersona;
        setPersona(savedPersona);
        personaSel.addEventListener("change", (e) => setPersona(e.target.value));
      })();
    </script>
  </body>
</html>
