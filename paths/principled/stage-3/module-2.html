<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ledger as Civilization's Memory | Stage 3 Module 2 | Principled Path</title>
    <style>
        :root {
            --accent-bronze: #8B6F47;
            --accent-bronze-light: #A0826D;
            --primary-dark: #1a1a1a;
            --secondary-dark: #2d2d2d;
            --accent-bronze: #8B6F47;
            --accent-bronze-light: #A0826D;
            --accent-bronze-light: #A0826D;
            --text-light: #e0e0e0;
            --text-dim: #999;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-dark);
            color: var(--text-light);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .back-btn {
            display: inline-block;
            background: var(--accent-bronze);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        .back-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(247, 147, 26, 0.4); }
        .module-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(139, 111, 71, 0.2), rgba(139, 111, 71, 0.05));
            border-radius: 12px;
            border: 2px solid var(--accent-bronze);
        }
        .module-icon { font-size: 4rem; margin-bottom: 1rem; }
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        .module-subtitle { font-size: 1.2rem; color: var(--text-dim); max-width: 700px; margin: 0 auto; }
        .content-section {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }
        .content-section h2 {
            color: var(--accent-bronze);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }
        .content-section h3 {
            color: var(--accent-bronze-light);
            font-size: 1.3rem;
            margin: 2rem 0 1rem;
        }
        .content-section p {
            color: var(--text-dim);
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .content-section ul {
            list-style: none;
            padding-left: 0;
        }
        .content-section li {
            padding: 0.75rem 0 0.75rem 2rem;
            position: relative;
            color: var(--text-light);
            line-height: 1.8;
        }
        .content-section li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--accent-bronze);
            font-weight: bold;
        }
        .highlight-box {
            background: rgba(139, 111, 71, 0.1);
            border-left: 4px solid var(--accent-bronze);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0.5rem;
        }
        .highlight-box strong {
            color: var(--accent-bronze);
            display: block;
            margin-bottom: 0.5rem;
        }
        .demo-container {
            background: var(--primary-dark);
            border: 2px solid rgba(139, 111, 71, 0.3);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }
        .demo-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .demo-tab {
            background: var(--secondary-dark);
            color: var(--text-dim);
            border: 2px solid rgba(139, 111, 71, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .demo-tab:hover {
            border-color: var(--accent-bronze);
            color: var(--text-light);
        }
        .demo-tab.active {
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            color: var(--primary-dark);
            border-color: var(--accent-bronze);
        }
        .demo-panel {
            display: none;
        }
        .demo-panel.active {
            display: block;
        }
        .timeline {
            position: relative;
            padding-left: 3rem;
            margin: 2rem 0;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 1rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, var(--accent-bronze), var(--accent-bronze-light));
        }
        .timeline-item {
            position: relative;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--secondary-dark);
            border-radius: 8px;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.5rem;
            top: 1.5rem;
            width: 1rem;
            height: 1rem;
            background: var(--accent-bronze);
            border-radius: 50%;
            border: 3px solid var(--primary-dark);
        }
        .timeline-era {
            color: var(--accent-bronze);
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .timeline-title {
            color: var(--text-light);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .timeline-description {
            color: var(--text-dim);
            line-height: 1.6;
        }
        .ledger-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .ledger-card {
            background: var(--secondary-dark);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid rgba(139, 111, 71, 0.2);
            text-align: center;
            transition: all 0.3s ease;
        }
        .ledger-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-bronze);
        }
        .ledger-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .ledger-name {
            color: var(--accent-bronze);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .ledger-trust {
            color: var(--text-dim);
            font-size: 0.9rem;
        }
        .interactive-ledger {
            background: var(--secondary-dark);
            padding: 2rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        .ledger-entry {
            display: flex;
            justify-content: space-between;
            padding: 1rem;
            margin: 0.5rem 0;
            background: var(--primary-dark);
            border-radius: 6px;
            border-left: 4px solid var(--accent-bronze);
        }
        .ledger-entry.corrupted {
            border-left-color: #e74c3c;
            opacity: 0.7;
        }
        .ledger-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        button {
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 111, 71, 0.4);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        input[type="text"], input[type="number"] {
            background: var(--secondary-dark);
            border: 2px solid rgba(139, 111, 71, 0.3);
            color: var(--text-light);
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1rem;
            width: 100%;
            margin: 0.5rem 0;
        }
        input:focus {
            outline: none;
            border-color: var(--accent-bronze);
        }
        .reflection-section {
            background: linear-gradient(135deg, rgba(139, 111, 71, 0.1), rgba(139, 111, 71, 0.05));
            border: 2px solid rgba(139, 111, 71, 0.3);
            border-radius: 12px;
            padding: 2.5rem;
            margin: 3rem 0;
        }
        .reflection-section h2 {
            color: var(--accent-bronze);
            margin-bottom: 2rem;
            text-align: center;
        }
        .question-box {
            background: var(--secondary-dark);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }
        .question-box h3 {
            color: var(--accent-bronze-light);
            margin-bottom: 1rem;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            background: var(--primary-dark);
            border: 2px solid rgba(139, 111, 71, 0.3);
            color: var(--text-light);
            padding: 1rem;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: var(--accent-bronze);
        }

        /* Interactive Reflection System */
        .reflection-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid rgba(139, 111, 71, 0.2);
            padding-bottom: 0.5rem;
        }
        .reflection-tab {
            background: transparent;
            border: none;
            color: var(--text-dim);
            padding: 0.5rem 1rem;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .reflection-tab:hover {
            color: var(--accent-bronze-light);
            background: rgba(139, 111, 71, 0.1);
        }
        .reflection-tab.active {
            color: var(--accent-bronze);
            background: rgba(139, 111, 71, 0.15);
        }
        .reflection-panel {
            display: none;
        }
        .reflection-panel.active {
            display: block;
        }
        .choice-select {
            width: 100%;
            background: var(--primary-dark);
            border: 2px solid rgba(139, 111, 71, 0.3);
            border-radius: 8px;
            padding: 0.75rem;
            color: var(--text-light);
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: 1rem;
        }
        .choice-select:focus {
            outline: none;
            border-color: var(--accent-bronze);
        }
        .feedback-btn {
            background: linear-gradient(135deg, var(--accent-bronze), var(--accent-bronze-light));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .feedback-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 111, 71, 0.4);
        }
        .feedback-box {
            background: rgba(45, 45, 45, 0.8);
            border-left: 4px solid var(--accent-bronze);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
        .feedback-box.positive {
            border-left-color: var(--success-green);
        }
        .feedback-box.hint {
            border-left-color: #f39c12;
        }
        .feedback-box h5 {
            color: var(--accent-bronze);
            margin: 0 0 0.75rem 0;
            font-size: 1.05rem;
        }
        .feedback-box.positive h5 {
            color: var(--success-green);
        }
        .feedback-box.hint h5 {
            color: #f39c12;
        }
        .checklist-reflection {
            background: rgba(26, 26, 26, 0.6);
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }
        .checkbox-label {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.2s ease;
        }
        .checkbox-label:hover {
            background: rgba(139, 111, 71, 0.1);
        }
        .checkbox-label input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            margin-top: 0.15rem;
        }
        .save-indicator {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-top: 0.5rem;
            font-style: italic;
        }
        @media (max-width: 480px) {
            .reflection-tabs {
                flex-direction: column;
                gap: 0.25rem;
            }
            .reflection-tab {
                width: 100%;
                text-align: center;
                border-radius: 6px;
            }
            .question-box {
                padding: 1.5rem;
            }
        }
        .next-module {
            text-align: center;
            margin-top: 3rem;
        }
        .next-module a {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-bronze), var(--accent-bronze-light));
            color: white;
            padding: 1.25rem 2.5rem;
            border-radius: 2rem;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        .next-module a:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(139, 111, 71, 0.5);
        }
        @media (max-width: 768px) {
            .module-header h1 { font-size: 2rem; }
            .ledger-comparison { grid-template-columns: 1fr; }
            .demo-tabs { flex-direction: column; }
        }
    </style>
    <script src="/js/subdomain-access-control.js"></script>
    <script src="/js/module-gate-subdomain.js"></script>
</head>
<body>
    <div class="container">
        <a href="/paths/principled/stage-3/" class="back-btn">← Back to Stage 3</a>

        <div class="module-header">
            <div class="module-icon">📖</div>
            <h1>The Ledger as Civilization's Memory</h1>
            <p class="module-subtitle">
                Societies evolve by improving their record-keeping systems. Bitcoin is the latest upgrade
                in humanity's quest for truth.
            </p>
        </div>

        <!-- Introduction -->
        <div class="content-section">
            <h2>Why Ledgers Matter</h2>
            <p>
                Every civilization has faced the same fundamental problem: <strong>How do we remember who owns what?</strong>
            </p>
            <p>
                Without reliable memory, societies cannot function. You can't have property rights, contracts,
                or trade if there's no trusted record of ownership. The ledger—civilization's collective memory—
                is the foundation of every economy.
            </p>

            <div class="highlight-box">
                <strong>Key Insight:</strong>
                Human progress can be measured by the quality of our ledgers. From clay tablets to blockchain,
                each upgrade in record-keeping enabled new forms of cooperation and commerce.
            </div>

            <p>
                Throughout history, societies have continuously upgraded their ledger technology:
            </p>
            <ul>
                <li><strong>Clay tablets (3000 BCE)</strong> – First written records of debts and ownership</li>
                <li><strong>Paper ledgers (1494)</strong> – Double-entry bookkeeping revolutionizes accounting</li>
                <li><strong>Digital databases (1960s)</strong> – Computers enable instant record updates</li>
                <li><strong>Blockchain (2009)</strong> – Decentralized, immutable, transparent ledger</li>
            </ul>

            <p>
                Each upgrade solved specific problems but introduced new ones. Bitcoin represents a fundamental
                breakthrough: a ledger that requires no trusted authority to maintain.
            </p>
        </div>

        <!-- Historical Evolution -->
        <div class="content-section">
            <h2>The Evolution of Record-Keeping</h2>
            <p>
                Let's trace how humanity's ledgers evolved—and why each system eventually needed replacement.
            </p>

            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-era">3000 BCE – ANCIENT MESOPOTAMIA</div>
                    <div class="timeline-title">Clay Tablets</div>
                    <div class="timeline-description">
                        Scribes carved records into wet clay. Problem: Tablets were fragile, localized,
                        and required trusting the scribe. But for the first time, agreements outlived human memory.
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-era">1494 CE – RENAISSANCE ITALY</div>
                    <div class="timeline-title">Double-Entry Bookkeeping</div>
                    <div class="timeline-description">
                        Luca Pacioli formalized accounting with debits and credits. Problem: Books could be
                        altered, burned, or kept secret. But this system enabled modern banking and global trade.
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-era">1971 CE – DIGITAL AGE</div>
                    <div class="timeline-title">Electronic Databases</div>
                    <div class="timeline-description">
                        Computers allowed instant updates and global synchronization. Problem: Databases are
                        centralized, hackable, and controlled by authorities. One administrator can alter history.
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="timeline-era">2009 CE – BITCOIN ERA</div>
                    <div class="timeline-title">Blockchain Ledger</div>
                    <div class="timeline-description">
                        A distributed ledger maintained by thousands of computers worldwide. Problem solved:
                        No single authority can alter the record. History becomes permanent and verifiable.
                    </div>
                </div>
            </div>

            <div class="highlight-box">
                <strong>Pattern Recognition:</strong>
                Each ledger upgrade increased <em>scale</em> and <em>speed</em>, but decreased <em>decentralization</em>.
                Bitcoin reverses this trend—it's the first ledger that scales globally without sacrificing decentralization.
            </div>
        </div>

        <!-- Trust Comparison -->
        <div class="content-section">
            <h2>Who Do You Trust?</h2>
            <p>
                Every ledger system requires trust in someone or something. The question is: who holds the power
                to alter the record?
            </p>

            <div class="ledger-comparison">
                <div class="ledger-card">
                    <div class="ledger-icon">📜</div>
                    <div class="ledger-name">Clay Tablets</div>
                    <div class="ledger-trust">Trust: Scribes & priests</div>
                </div>
                <div class="ledger-card">
                    <div class="ledger-icon">📕</div>
                    <div class="ledger-name">Paper Ledgers</div>
                    <div class="ledger-trust">Trust: Accountants & banks</div>
                </div>
                <div class="ledger-card">
                    <div class="ledger-icon">💾</div>
                    <div class="ledger-name">Digital Databases</div>
                    <div class="ledger-trust">Trust: Tech companies & governments</div>
                </div>
                <div class="ledger-card">
                    <div class="ledger-icon">⛓️</div>
                    <div class="ledger-name">Bitcoin Blockchain</div>
                    <div class="ledger-trust">Trust: Mathematics & energy</div>
                </div>
            </div>

            <p>
                Bitcoin is the first ledger that replaces human trust with mathematical proof. You don't need
                to trust miners, developers, or validators—you can verify the entire history yourself.
            </p>
        </div>

        <!-- Interactive Demo -->
        <div class="content-section">
            <h2>Interactive Demonstrations</h2>
            <p>
                Experience the difference between centralized and decentralized ledgers.
            </p>

            <div class="demo-container">
                <div class="demo-tabs">
                    <button class="demo-tab active" onclick="switchTab('centralized')">Centralized Ledger</button>
                    <button class="demo-tab" onclick="switchTab('distributed')">Distributed Ledger</button>
                    <button class="demo-tab" onclick="switchTab('evolution')">Evolution Simulator</button>
                </div>

                <!-- Centralized Ledger Demo -->
                <div id="centralized-panel" class="demo-panel active">
                    <h3 style="color: var(--accent-bronze-light); margin-bottom: 1rem;">Centralized Ledger</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1.5rem;">
                        One authority controls the record. Watch what happens when they have incentive to cheat.
                    </p>

                    <div class="interactive-ledger">
                        <h4 style="color: var(--accent-bronze); margin-bottom: 1rem;">Bank's Internal Ledger</h4>
                        <div id="centralizedEntries"></div>

                        <div class="ledger-controls">
                            <button onclick="addCentralizedEntry()">Add Legitimate Entry</button>
                            <button onclick="corruptCentralizedEntry()" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">
                                Corrupt Entry (Admin Override)
                            </button>
                            <button onclick="resetCentralized()">Reset</button>
                        </div>

                        <div id="centralizedLog" style="margin-top: 1rem; padding: 1rem; background: var(--primary-dark); border-radius: 6px; color: var(--text-dim); font-size: 0.9rem;"></div>
                    </div>

                    <div class="highlight-box" style="margin-top: 1.5rem;">
                        <strong>What You Learned:</strong>
                        With centralized control, records can be altered with no evidence. Trust becomes mandatory,
                        verification becomes impossible.
                    </div>
                </div>

                <!-- Distributed Ledger Demo -->
                <div id="distributed-panel" class="demo-panel">
                    <h3 style="color: var(--accent-bronze-light); margin-bottom: 1rem;">Distributed Ledger</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1.5rem;">
                        Multiple copies exist. Changing one copy doesn't change consensus.
                    </p>

                    <div class="interactive-ledger">
                        <h4 style="color: var(--accent-bronze); margin-bottom: 1rem;">Network Consensus (5 Nodes)</h4>
                        <div id="distributedNodes" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;"></div>

                        <div class="ledger-controls">
                            <button onclick="addDistributedEntry()">Add Network Entry</button>
                            <button onclick="attackDistributedNode()" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">
                                Attack Random Node
                            </button>
                            <button onclick="resetDistributed()">Reset</button>
                        </div>

                        <div id="distributedLog" style="margin-top: 1rem; padding: 1rem; background: var(--primary-dark); border-radius: 6px; color: var(--text-dim); font-size: 0.9rem;"></div>
                    </div>

                    <div class="highlight-box" style="margin-top: 1.5rem;">
                        <strong>What You Learned:</strong>
                        In a distributed system, tampering with one copy is obvious. The majority consensus
                        preserves truth even when some nodes are compromised.
                    </div>
                </div>

                <!-- Evolution Simulator -->
                <div id="evolution-panel" class="demo-panel">
                    <h3 style="color: var(--accent-bronze-light); margin-bottom: 1rem;">Ledger Evolution Simulator</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1.5rem;">
                        See how different ledger systems handle the same transactions over time.
                    </p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">📜</div>
                            <div style="color: var(--accent-bronze); font-weight: 600;">Clay Tablets</div>
                            <div id="claySpeed" style="color: var(--text-dim); font-size: 0.9rem;">Speed: 1 day/tx</div>
                            <div id="clayCost" style="color: var(--text-dim); font-size: 0.9rem;">Cost: High</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">📕</div>
                            <div style="color: var(--accent-bronze); font-weight: 600;">Paper Ledger</div>
                            <div id="paperSpeed" style="color: var(--text-dim); font-size: 0.9rem;">Speed: 1 hour/tx</div>
                            <div id="paperCost" style="color: var(--text-dim); font-size: 0.9rem;">Cost: Medium</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">💾</div>
                            <div style="color: var(--accent-bronze); font-weight: 600;">Database</div>
                            <div id="dbSpeed" style="color: var(--text-dim); font-size: 0.9rem;">Speed: Instant</div>
                            <div id="dbCost" style="color: var(--text-dim); font-size: 0.9rem;">Cost: Low</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">⛓️</div>
                            <div style="color: var(--accent-bronze); font-weight: 600;">Bitcoin</div>
                            <div id="btcSpeed" style="color: var(--text-dim); font-size: 0.9rem;">Speed: ~10 min/block</div>
                            <div id="btcCost" style="color: var(--text-dim); font-size: 0.9rem;">Cost: Energy</div>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 2rem 0;">
                        <div style="color: var(--text-light); font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem;">
                            Transactions Processed: <span id="txCount">0</span>
                        </div>
                        <div style="color: var(--text-dim); margin-bottom: 1rem;">
                            Integrity Status: <span id="integrityStatus" style="color: #2ecc71; font-weight: 600;">All Systems Operational</span>
                        </div>
                    </div>

                    <div class="ledger-controls">
                        <button onclick="simulateEvolution()">Process 100 Transactions</button>
                        <button onclick="testIntegrity()" style="background: linear-gradient(45deg, #e74c3c, #c0392b);">
                            Test Integrity (Random Attack)
                        </button>
                        <button onclick="resetEvolution()">Reset</button>
                    </div>

                    <div id="evolutionLog" style="margin-top: 1rem; padding: 1rem; background: var(--primary-dark); border-radius: 6px; color: var(--text-dim); font-size: 0.9rem; max-height: 150px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>

        <!-- Key Takeaways -->
        <div class="content-section">
            <h2>Why Bitcoin's Ledger Is Different</h2>
            <p>
                Bitcoin solves problems that have plagued ledgers for 5,000 years:
            </p>

            <h3>1. No Trusted Authority</h3>
            <p>
                Previous ledgers required trusting someone—a scribe, accountant, bank, or government.
                Bitcoin replaces this trust with mathematical proof and energy expenditure.
            </p>

            <h3>2. Global Consensus Without Coordination</h3>
            <p>
                Thousands of independent computers worldwide maintain identical copies of Bitcoin's ledger.
                They agree on the state of the ledger without any central coordinator.
            </p>

            <h3>3. Append-Only History</h3>
            <p>
                Once a transaction is recorded in Bitcoin's ledger and buried under enough proof-of-work,
                altering it becomes physically impossible. History solidifies like geological layers.
            </p>

            <h3>4. Open Verification</h3>
            <p>
                Anyone can download the entire ledger and verify every transaction back to the genesis block.
                You don't need permission to audit the system.
            </p>

            <div class="highlight-box">
                <strong>The Breakthrough:</strong>
                Bitcoin is the first ledger in human history where verification is easier than corruption.
                This inverts the traditional power structure—truth becomes stronger than authority.
            </div>
        </div>

        <!-- Socratic Reflection -->
        <div class="reflection-section">
            <h2>🤔 Test Your Understanding</h2>
            <p style="text-align: center; color: var(--text-dim); margin-bottom: 2rem;">
                Answer at your own depth—quick thoughts or deep analysis. Get instant feedback on your grasp of the concepts.
            </p>

            <!-- Question 1: Historical Pattern -->
            <div class="question-box">
                <h3>Question 1: Historical Pattern</h3>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    Throughout history, ledger upgrades increased speed and scale but decreased decentralization.
                    Why did centralization happen?
                </p>

                <div class="reflection-tabs">
                    <button class="reflection-tab active" onclick="switchReflectionTab(1, 'quick', event)" role="tab">⚡ Quick (1-2 min)</button>
                    <button class="reflection-tab" onclick="switchReflectionTab(1, 'deep', event)" role="tab">🎯 Deep (5 min)</button>
                </div>

                <div id="q1-quick" class="reflection-panel active">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-dim);">
                        Which incentive drove centralization the most?
                    </label>
                    <select id="question1-choice" class="choice-select">
                        <option value="">Select your answer...</option>
                        <option value="efficiency">Efficiency: Faster transactions with one authority</option>
                        <option value="control">Control: Governments/banks wanted power over money</option>
                        <option value="technology">Technology: Couldn't build decentralized systems yet</option>
                        <option value="all">All of the above worked together</option>
                    </select>
                    <button class="feedback-btn" onclick="checkReflection(1, 'quick')">Check Answer</button>
                    <div id="feedback1-quick" class="feedback-box" style="display: none;"></div>
                </div>

                <div id="q1-deep" class="reflection-panel">
                    <textarea id="question1-deep" placeholder="Deeper analysis: Explain the trade-off between efficiency and trust. Why did societies accept centralization despite the risks?" style="min-height: 150px;"></textarea>
                    <button class="feedback-btn" onclick="checkReflection(1, 'deep')">Get Feedback</button>
                    <div id="feedback1-deep" class="feedback-box" style="display: none;"></div>
                </div>
                <div class="save-indicator">✓ Auto-saved locally</div>
            </div>

            <!-- Question 2: Trust Layers -->
            <div class="question-box">
                <h3>Question 2: Trust Layers</h3>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    Count the trust layers: How many do you need with centralized systems vs. Bitcoin?
                </p>

                <div class="reflection-tabs">
                    <button class="reflection-tab active" onclick="switchReflectionTab(2, 'quick', event)" role="tab">⚡ Quick (1-2 min)</button>
                    <button class="reflection-tab" onclick="switchReflectionTab(2, 'deep', event)" role="tab">🎯 Deep (5 min)</button>
                </div>

                <div id="q2-quick" class="reflection-panel active">
                    <div style="background: rgba(26, 26, 26, 0.6); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem;">
                        <h4 style="color: var(--accent-bronze); margin-top: 0;">Centralized Database:</h4>
                        <div class="checklist-reflection" style="background: transparent; padding: 0; border: none;">
                            <label class="checkbox-label"><input type="checkbox" disabled checked> Database administrator</label>
                            <label class="checkbox-label"><input type="checkbox" disabled checked> Company/organization</label>
                            <label class="checkbox-label"><input type="checkbox" disabled checked> Government regulations</label>
                            <label class="checkbox-label"><input type="checkbox" disabled checked> Legal system</label>
                            <label class="checkbox-label"><input type="checkbox" disabled checked> Infrastructure providers</label>
                        </div>
                        <p style="margin: 1rem 0 0 0; color: var(--accent-bronze); font-weight: 600;">= 5+ layers of trust</p>
                    </div>

                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-dim); font-weight: 600;">
                        How many trust layers does Bitcoin require?
                    </label>
                    <select id="question2-choice" class="choice-select">
                        <option value="">Select your answer...</option>
                        <option value="0">0 - Completely trustless</option>
                        <option value="1">1 - Trust Bitcoin's code/network</option>
                        <option value="2-3">2-3 - Code + some infrastructure</option>
                        <option value="same">Same as centralized systems</option>
                    </select>
                    <button class="feedback-btn" onclick="checkReflection(2, 'quick')">Check Answer</button>
                    <div id="feedback2-quick" class="feedback-box" style="display: none;"></div>
                </div>

                <div id="q2-deep" class="reflection-panel">
                    <textarea id="question2-deep" placeholder="Explain: What specific trust assumptions does Bitcoin eliminate? What trust assumptions remain (if any)? Why is minimizing trust important?" style="min-height: 150px;"></textarea>
                    <button class="feedback-btn" onclick="checkReflection(2, 'deep')">Get Feedback</button>
                    <div id="feedback2-deep" class="feedback-box" style="display: none;"></div>
                </div>
                <div class="save-indicator">✓ Auto-saved locally</div>
            </div>

            <!-- Question 3: Civilization's Memory -->
            <div class="question-box">
                <h3>Question 3: Civilization's Memory</h3>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    If a civilization's ledger can be altered or erased, what happens?
                </p>

                <div class="checklist-reflection">
                    <p style="color: var(--text-dim); font-size: 0.95rem; margin-bottom: 1rem;">Select the consequences of mutable ledgers:</p>
                    <label class="checkbox-label">
                        <input type="checkbox" id="consequence-property" onchange="updateConsequenceFeedback()">
                        Property rights become uncertain (who owns what?)
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="consequence-contracts" onchange="updateConsequenceFeedback()">
                        Contracts can be retroactively changed
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="consequence-history" onchange="updateConsequenceFeedback()">
                        Historical truth can be rewritten
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="consequence-power" onchange="updateConsequenceFeedback()">
                        Power concentrates in whoever controls the ledger
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="consequence-innovation" onchange="updateConsequenceFeedback()">
                        Innovation improves—mistakes can be fixed easily
                    </label>
                </div>
                <div id="feedback3" class="feedback-box" style="display: none; margin-top: 1rem;"></div>

                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid rgba(139, 111, 71, 0.2);">
                    <h4 style="color: var(--accent-bronze); margin-bottom: 1rem;">🎯 Deep Reflection (Optional)</h4>
                    <textarea id="question3-deep" placeholder="Why is immutability valuable even if it means mistakes can't be undone? When is the trade-off worth it?" style="min-height: 120px;"></textarea>
                </div>
                <div class="save-indicator">✓ Auto-saved locally</div>
            </div>
        </div>

        <!-- Next Module -->
        <div class="next-module">
            <h2 style="color: var(--accent-bronze); margin-bottom: 1rem;">Ready to Continue?</h2>
            <p style="color: var(--text-dim); margin-bottom: 2rem;">
                Next, discover why truth requires energy—and why that's actually a good thing.
            </p>
            <a href="/paths/principled/stage-3/?completed=true&module=2">
                Continue to Module 3: The Cost of Truth →
            </a>
        </div>
    </div>

    <script>
        // ===== Centralized Ledger Demo =====
        let centralizedLedger = [];
        let centralizedCounter = 0;

        function addCentralizedEntry() {
            const entry = {
                id: centralizedCounter++,
                from: 'Alice',
                to: 'Bob',
                amount: Math.floor(Math.random() * 100) + 1,
                corrupted: false
            };
            centralizedLedger.push(entry);
            updateCentralizedDisplay();
            logCentralized(`✓ Added: ${entry.from} → ${entry.to}: $${entry.amount}`);
        }

        function corruptCentralizedEntry() {
            if (centralizedLedger.length === 0) {
                logCentralized('⚠️ No entries to corrupt');
                return;
            }
            const index = Math.floor(Math.random() * centralizedLedger.length);
            const entry = centralizedLedger[index];
            const oldAmount = entry.amount;
            entry.amount = Math.floor(Math.random() * 1000) + 100;
            entry.corrupted = true;
            updateCentralizedDisplay();
            logCentralized(`⚠️ ADMIN OVERRIDE: Entry #${entry.id} changed from $${oldAmount} to $${entry.amount}. No audit trail.`);
        }

        function resetCentralized() {
            centralizedLedger = [];
            centralizedCounter = 0;
            updateCentralizedDisplay();
            logCentralized('🔄 Ledger reset');
        }

        function updateCentralizedDisplay() {
            const container = document.getElementById('centralizedEntries');
            if (centralizedLedger.length === 0) {
                container.innerHTML = '<div style="color: var(--text-dim); text-align: center; padding: 2rem;">No entries yet</div>';
                return;
            }
            container.innerHTML = centralizedLedger.map(entry => `
                <div class="ledger-entry ${entry.corrupted ? 'corrupted' : ''}">
                    <div>
                        <div style="font-weight: 600; color: var(--text-light);">#${entry.id}: ${entry.from} → ${entry.to}</div>
                        <div style="font-size: 0.9rem; color: var(--text-dim);">Amount: $${entry.amount}</div>
                    </div>
                    ${entry.corrupted ? '<div style="color: #e74c3c; font-weight: 600;">⚠️ ALTERED</div>' : '<div style="color: #2ecc71;">✓</div>'}
                </div>
            `).join('');
        }

        function logCentralized(message) {
            const log = document.getElementById('centralizedLog');
            log.innerHTML = `<div>${new Date().toLocaleTimeString()}: ${message}</div>` + log.innerHTML;
        }

        // ===== Distributed Ledger Demo =====
        let distributedLedger = [];
        let distributedCounter = 0;
        const nodeCount = 5;

        function addDistributedEntry() {
            const entry = {
                id: distributedCounter++,
                from: 'Alice',
                to: 'Bob',
                amount: Math.floor(Math.random() * 100) + 1
            };
            distributedLedger.push(entry);
            updateDistributedDisplay();
            logDistributed(`✓ Consensus reached: ${entry.from} → ${entry.to}: $${entry.amount} (${nodeCount}/${nodeCount} nodes agree)`);
        }

        function attackDistributedNode() {
            if (distributedLedger.length === 0) {
                logDistributed('⚠️ No entries to attack');
                return;
            }
            const nodeNum = Math.floor(Math.random() * nodeCount) + 1;
            logDistributed(`⚠️ Node ${nodeNum} compromised! Altered local copy...`);
            setTimeout(() => {
                logDistributed(`✓ Other nodes rejected Node ${nodeNum}'s invalid state. Consensus maintained (${nodeCount-1}/${nodeCount} agree).`);
                logDistributed(`🔄 Node ${nodeNum} re-synchronized with network consensus.`);
            }, 1500);
        }

        function resetDistributed() {
            distributedLedger = [];
            distributedCounter = 0;
            updateDistributedDisplay();
            logDistributed('🔄 Network reset');
        }

        function updateDistributedDisplay() {
            const container = document.getElementById('distributedNodes');
            container.innerHTML = Array.from({length: nodeCount}, (_, i) => `
                <div style="background: var(--secondary-dark); padding: 1rem; border-radius: 6px; border: 2px solid rgba(139, 111, 71, 0.2);">
                    <div style="color: var(--accent-bronze); font-weight: 600; margin-bottom: 0.5rem;">Node ${i+1}</div>
                    <div style="color: var(--text-dim); font-size: 0.85rem;">
                        ${distributedLedger.length} entries<br/>
                        Status: <span style="color: #2ecc71;">✓ Synced</span>
                    </div>
                </div>
            `).join('');
        }

        function logDistributed(message) {
            const log = document.getElementById('distributedLog');
            log.innerHTML = `<div>${new Date().toLocaleTimeString()}: ${message}</div>` + log.innerHTML;
        }

        // ===== Evolution Simulator =====
        let txCount = 0;
        let systemIntegrity = {
            clay: true,
            paper: true,
            database: true,
            bitcoin: true
        };

        function simulateEvolution() {
            txCount += 100;
            document.getElementById('txCount').textContent = txCount;
            logEvolution(`✓ Processed 100 transactions across all ledger types`);
            logEvolution(`📜 Clay tablets: 100 days elapsed`);
            logEvolution(`📕 Paper ledger: ~4 days elapsed`);
            logEvolution(`💾 Database: Instant processing`);
            logEvolution(`⛓️ Bitcoin: ~16 hours (100 blocks)`);
        }

        function testIntegrity() {
            const systems = ['clay', 'paper', 'database', 'bitcoin'];
            const target = systems[Math.floor(Math.random() * systems.length)];
            const names = {clay: 'Clay Tablets', paper: 'Paper Ledger', database: 'Database', bitcoin: 'Bitcoin'};

            logEvolution(`⚠️ Attack targeting ${names[target]}...`);

            setTimeout(() => {
                if (target === 'bitcoin') {
                    logEvolution(`✓ Bitcoin attack failed: Would require 51% of global hashpower + rewriting all subsequent blocks`);
                } else {
                    systemIntegrity[target] = false;
                    logEvolution(`⚠️ ${names[target]} compromised: Administrator altered historical records`);
                    updateIntegrityStatus();
                }
            }, 1000);
        }

        function updateIntegrityStatus() {
            const failed = Object.entries(systemIntegrity).filter(([k,v]) => !v).length;
            const status = document.getElementById('integrityStatus');
            if (failed === 0) {
                status.textContent = 'All Systems Operational';
                status.style.color = '#2ecc71';
            } else {
                status.textContent = `${failed} System${failed > 1 ? 's' : ''} Compromised (Bitcoin: ✓ Secure)`;
                status.style.color = '#e74c3c';
            }
        }

        function resetEvolution() {
            txCount = 0;
            systemIntegrity = {clay: true, paper: true, database: true, bitcoin: true};
            document.getElementById('txCount').textContent = '0';
            updateIntegrityStatus();
            document.getElementById('evolutionLog').innerHTML = '';
            logEvolution('🔄 Simulation reset');
        }

        function logEvolution(message) {
            const log = document.getElementById('evolutionLog');
            log.innerHTML = `<div>${new Date().toLocaleTimeString()}: ${message}</div>` + log.innerHTML;
        }

        // ===== Tab Switching =====
        function switchTab(tab) {
            document.querySelectorAll('.demo-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.demo-panel').forEach(p => p.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tab}-panel`).classList.add('active');
        }

        // ===== Interactive Reflection System =====
        const STORAGE_KEY = 'principled-stage3-module2-reflections';

        function switchReflectionTab(questionNum, level, event) {
            document.querySelectorAll(`#q${questionNum}-quick, #q${questionNum}-deep`).forEach(panel => {
                panel.classList.remove('active');
                panel.setAttribute('aria-hidden', 'true');
            });
            event.target.parentElement.querySelectorAll('.reflection-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
            });
            const panel = document.getElementById(`q${questionNum}-${level}`);
            panel.classList.add('active');
            panel.setAttribute('aria-hidden', 'false');
            event.target.classList.add('active');
            event.target.setAttribute('aria-selected', 'true');
        }

        function checkReflection(questionNum, level) {
            const feedbackDiv = document.getElementById(`feedback${questionNum}-${level}`);

            if (questionNum === 1 && level === 'quick') {
                const choice = document.getElementById('question1-choice').value;
                let feedback = '';

                if (!choice) {
                    feedback = `<h5>Select an Answer</h5><p>Choose what you think drove centralization in ledger systems.</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                } else if (choice === 'all') {
                    feedback = `<h5>✓ Excellent!</h5><p>You identified the full picture. All three factors worked together: (1) <strong>Efficiency</strong> was the obvious benefit, (2) <strong>Control</strong> was the political motivation, and (3) <strong>Technology</strong> limited alternatives until cryptography + internet made decentralization possible.</p><p style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(139, 111, 71, 0.3);"><strong>Key Insight:</strong> Bitcoin didn't just choose decentralization—it became <em>possible</em> for the first time in history.</p>`;
                    feedbackDiv.className = 'feedback-box positive';
                } else if (choice === 'technology') {
                    feedback = `<h5>✓ Good Insight!</h5><p>Technology limitations were huge! Pre-internet and pre-cryptography, decentralized ledgers were impossible. But don't underestimate <em>incentives</em>—even with the tech, centralized parties had reasons to maintain control.</p><p style="color: var(--text-dim); margin-top: 0.5rem;">Hint: The complete answer involves efficiency, control, AND technology working together.</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                } else {
                    feedback = `<h5>Partially Correct</h5><p>You're right that ${choice} played a role. But it's not the full story. All three factors—efficiency, control, and technology—combined to drive centralization. Try selecting "All of the above".</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                }

                feedbackDiv.innerHTML = feedback;
                feedbackDiv.style.display = 'block';
                saveReflection('q1-choice', choice);
            }

            if (questionNum === 1 && level === 'deep') {
                const text = document.getElementById('question1-deep').value.toLowerCase();
                let feedback = '';

                if (text.length < 100) {
                    feedback = `<h5>💡 Expand Your Thinking</h5><p>Try exploring: (1) What efficiency gains did centralization provide? (2) What control did institutions want? (3) Why couldn't decentralized systems exist before Bitcoin?</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                } else {
                    const hasEfficiency = text.match(/\b(fast|speed|efficient|scale|throughput|convenience)\b/);
                    const hasControl = text.match(/\b(control|power|authority|government|bank|regulate|monopoly)\b/);
                    const hasTechnology = text.match(/\b(technolog|internet|crypto|compute|possible|feasible)\b/);
                    const score = [hasEfficiency, hasControl, hasTechnology].filter(Boolean).length;

                    if (score === 3) {
                        feedback = `<h5>✓ Comprehensive Analysis!</h5><p>You've identified all three dimensions! Centralization happened because: (1) it was <em>faster</em>, (2) institutions <em>wanted</em> control, and (3) the technology for decentralized alternatives <em>didn't exist yet</em>. Bitcoin represents a historical breakthrough—the first time all three can be overcome simultaneously.</p>`;
                        feedbackDiv.className = 'feedback-box positive';
                    } else if (score === 2) {
                        feedback = `<h5>✓ Good Analysis</h5><p>You covered ${score} of 3 key factors. ${!hasEfficiency ? 'Add: Why centralization was <em>efficient</em> (one database = faster than consensus). ' : ''}${!hasControl ? 'Add: Why institutions <em>wanted</em> control over money. ' : ''}${!hasTechnology ? 'Add: Why decentralization was <em>technically impossible</em> before cryptography + internet.' : ''}</p>`;
                        feedbackDiv.className = 'feedback-box hint';
                    } else {
                        feedback = `<h5>Keep Developing</h5><p>Think about the trade-off: centralized ledgers were fast and convenient, but required trusting powerful intermediaries. Before Bitcoin, there was no alternative.</p>`;
                        feedbackDiv.className = 'feedback-box hint';
                    }
                }

                feedbackDiv.innerHTML = feedback;
                feedbackDiv.style.display = 'block';
                saveReflection('q1-deep', text);
            }

            if (questionNum === 2 && level === 'quick') {
                const choice = document.getElementById('question2-choice').value;
                let feedback = '';

                if (!choice) {
                    feedback = `<h5>Select an Answer</h5><p>Count carefully—how many entities do you need to trust with Bitcoin?</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                } else if (choice === '1') {
                    feedback = `<h5>✓ Nuanced Understanding!</h5><p>You recognize that Bitcoin isn't <em>completely</em> trustless—you do need to trust that: (1) The cryptographic algorithms work, (2) The network stays decentralized, (3) The majority of hashpower remains honest. But this is <strong>1 trust layer</strong> (the protocol itself) versus <strong>5+ layers</strong> with centralized systems. Huge reduction!</p><p style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(139, 111, 71, 0.3);"><strong>Key:</strong> Bitcoin minimizes trust, not eliminates it. The trust you need is in <em>math and incentives</em>, not <em>people and institutions</em>.</p>`;
                    feedbackDiv.className = 'feedback-box positive';
                } else if (choice === '0') {
                    feedback = `<h5>Almost!</h5><p>While Bitcoin is often called "trustless," you technically do trust: (1) the cryptographic algorithms (SHA-256, ECDSA), (2) that the network stays decentralized, (3) that miners follow incentives. But these are <em>systemic</em> truths, not <em>institutional</em> truths. The better answer is <strong>1 trust layer</strong>—the protocol itself.</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                } else if (choice === '2-3') {
                    feedback = `<h5>Rethink It</h5><p>What specific entities do you think you need to trust with Bitcoin? If you're thinking of wallet software, nodes, or internet—those are <em>tools</em>, not <em>trust requirements</em>. You can verify everything yourself. The answer is closer to <strong>1</strong>—just the protocol/network.</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                } else {
                    feedback = `<h5>❌ Not Quite</h5><p>Bitcoin dramatically reduces trust! With centralized systems, you trust: admin, company, government, laws, infrastructure (5+ layers). With Bitcoin, you only trust the protocol itself—that the math works and incentives hold. That's <strong>1 layer</strong>.</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                }

                feedbackDiv.innerHTML = feedback;
                feedbackDiv.style.display = 'block';
                saveReflection('q2-choice', choice);
            }

            if (questionNum === 2 && level === 'deep') {
                const text = document.getElementById('question2-deep').value;
                let feedback = '';

                if (text.length < 100) {
                    feedback = `<h5>💡 Go Deeper</h5><p>Consider: What specific trust assumptions does Bitcoin eliminate? (Hint: administrators, companies, governments). What trust remains? (Hint: math, incentives, decentralization). Why does this matter?</p>`;
                    feedbackDiv.className = 'feedback-box hint';
                } else {
                    const eliminates = text.toLowerCase().match(/\b(eliminat|remov|no need|don't need|without|trustless)\b/);
                    const minimal = text.toLowerCase().match(/\b(minim|reduc|less|fewer)\b/);
                    const math = text.toLowerCase().match(/\b(math|crypto|algorithm|code|protocol|incentive)\b/);

                    if ((eliminates || minimal) && math) {
                        feedback = `<h5>✓ Excellent Analysis!</h5><p>You understand the key distinction: Bitcoin doesn't eliminate <em>all</em> trust, but it replaces <em>institutional trust</em> (people/organizations) with <em>systematic trust</em> (math/incentives). This is revolutionary because institutions can be corrupted, but math cannot.</p>`;
                        feedbackDiv.className = 'feedback-box positive';
                    } else if (eliminates || minimal) {
                        feedback = `<h5>✓ On the Right Track</h5><p>You're right that Bitcoin reduces trust requirements. To strengthen your answer: explain <em>what kind</em> of trust remains (cryptographic assumptions, network decentralization) and why trusting math is different from trusting people.</p>`;
                        feedbackDiv.className = 'feedback-box hint';
                    } else {
                        feedback = `<h5>Develop This Further</h5><p>Think about the shift: from trusting <em>people</em> (administrators, CEOs, politicians) to trusting <em>systems</em> (cryptography, game theory, decentralized consensus). Why is this shift significant?</p>`;
                        feedbackDiv.className = 'feedback-box hint';
                    }
                }

                feedbackDiv.innerHTML = feedback;
                feedbackDiv.style.display = 'block';
                saveReflection('q2-deep', text);
            }
        }

        function updateConsequenceFeedback() {
            const property = document.getElementById('consequence-property').checked;
            const contracts = document.getElementById('consequence-contracts').checked;
            const history = document.getElementById('consequence-history').checked;
            const power = document.getElementById('consequence-power').checked;
            const innovation = document.getElementById('consequence-innovation').checked;

            const feedbackDiv = document.getElementById('feedback3');
            let feedback = '';
            let correctCount = [property, contracts, history, power].filter(Boolean).length;

            if (innovation) {
                feedback = `<h5>⚠️ Reconsider</h5><p>"Innovation improves" is a common misconception. While it's true mistakes could be fixed, <strong>mutable ledgers enable fraud</strong>. If the ledger can be changed, who decides what's a "mistake" vs. legitimate history? The powerful will always claim their alterations are "fixes." Immutability prevents this abuse.</p>`;
                feedbackDiv.className = 'feedback-box hint';
            } else if (correctCount === 4) {
                feedback = `<h5>✓ Perfect Understanding!</h5><p>You identified all four consequences! Mutable ledgers undermine: (1) <strong>Property rights</strong> (ownership becomes uncertain), (2) <strong>Contracts</strong> (agreements can be retroactively changed), (3) <strong>Historical truth</strong> (facts become fluid), and (4) <strong>Power concentration</strong> (whoever controls the ledger controls reality).</p><p style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(139, 111, 71, 0.3);"><strong>Insight:</strong> Immutability isn't just a technical feature—it's a prerequisite for trust, property, and truth itself.</p>`;
                feedbackDiv.className = 'feedback-box positive';
            } else if (correctCount >= 2) {
                feedback = `<h5>✓ Good Start</h5><p>You've identified ${correctCount} correct consequences. ${!property ? 'Also consider: If records can change, who really owns what? ' : ''}${!contracts ? 'Also consider: Can contracts be trusted if they can be altered retroactively? ' : ''}${!history ? 'Also consider: If the past can be rewritten, what does "truth" even mean? ' : ''}${!power ? 'Also consider: Who has the power to change the ledger?' : ''}</p>`;
                feedbackDiv.className = 'feedback-box hint';
            } else if (correctCount > 0) {
                feedback = `<h5>Keep Thinking</h5><p>You're on the right track. Think about what happens when the <em>record of reality</em> can be changed. Who has power? What can't be trusted?</p>`;
                feedbackDiv.className = 'feedback-box hint';
            }

            if (correctCount > 0 || innovation) {
                feedbackDiv.innerHTML = feedback;
                feedbackDiv.style.display = 'block';
            }

            saveReflection('q3-consequences', JSON.stringify({property, contracts, history, power, innovation}));
        }

        function saveReflection(key, value) {
            const reflections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            reflections[key] = value;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(reflections));
        }

        function loadReflections() {
            const reflections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');

            // Load choices
            if (reflections['q1-choice']) document.getElementById('question1-choice').value = reflections['q1-choice'];
            if (reflections['q2-choice']) document.getElementById('question2-choice').value = reflections['q2-choice'];

            // Load textareas
            if (reflections['q1-deep']) document.getElementById('question1-deep').value = reflections['q1-deep'];
            if (reflections['q2-deep']) document.getElementById('question2-deep').value = reflections['q2-deep'];
            if (reflections['q3-deep']) document.getElementById('question3-deep').value = reflections['q3-deep'];

            // Load checkboxes
            if (reflections['q3-consequences']) {
                const consequences = JSON.parse(reflections['q3-consequences']);
                document.getElementById('consequence-property').checked = consequences.property || false;
                document.getElementById('consequence-contracts').checked = consequences.contracts || false;
                document.getElementById('consequence-history').checked = consequences.history || false;
                document.getElementById('consequence-power').checked = consequences.power || false;
                document.getElementById('consequence-innovation').checked = consequences.innovation || false;
            }
        }

        // Auto-save textareas
        ['question1-deep', 'question2-deep', 'question3-deep'].forEach(id => {
            const elem = document.getElementById(id);
            if (elem) {
                elem.addEventListener('input', (e) => {
                    saveReflection(id, e.target.value);
                });
            }
        });

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            loadReflections();
            updateConsequenceFeedback();
            updateCentralizedDisplay();
            updateDistributedDisplay();
        });
    </script>
</body>
</html>
