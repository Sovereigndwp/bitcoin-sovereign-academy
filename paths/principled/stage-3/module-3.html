<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Cost of Truth | Stage 3 Module 3 | Principled Path</title>
    <style>
        :root {
            --primary-orange: #f7931a;
            --primary-dark: #1a1a1a;
            --secondary-dark: #2d2d2d;
            --accent-bronze: #8B6F47;
            --accent-bronze-light: #A0826D;
            --text-light: #e0e0e0;
            --text-dim: #999;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-dark);
            color: var(--text-light);
            line-height: 1.6;
            padding: 2rem;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .back-btn {
            display: inline-block;
            background: var(--primary-orange);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        .back-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(247, 147, 26, 0.4); }
        .module-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(139, 111, 71, 0.2), rgba(139, 111, 71, 0.05));
            border-radius: 12px;
            border: 2px solid var(--accent-bronze);
        }
        .module-icon { font-size: 4rem; margin-bottom: 1rem; }
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        .module-subtitle { font-size: 1.2rem; color: var(--text-dim); max-width: 700px; margin: 0 auto; }
        .content-section {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }
        .content-section h2 {
            color: var(--accent-bronze);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }
        .content-section h3 {
            color: var(--accent-bronze-light);
            font-size: 1.3rem;
            margin: 2rem 0 1rem;
        }
        .content-section p {
            color: var(--text-dim);
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .content-section ul {
            list-style: none;
            padding-left: 0;
        }
        .content-section li {
            padding: 0.75rem 0 0.75rem 2rem;
            position: relative;
            color: var(--text-light);
            line-height: 1.8;
        }
        .content-section li:before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--accent-bronze);
            font-weight: bold;
        }
        .highlight-box {
            background: rgba(139, 111, 71, 0.1);
            border-left: 4px solid var(--accent-bronze);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0.5rem;
        }
        .highlight-box strong {
            color: var(--accent-bronze);
            display: block;
            margin-bottom: 0.5rem;
        }
        .demo-container {
            background: var(--primary-dark);
            border: 2px solid rgba(139, 111, 71, 0.3);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }
        .demo-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .demo-tab {
            background: var(--secondary-dark);
            color: var(--text-dim);
            border: 2px solid rgba(139, 111, 71, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .demo-tab:hover {
            border-color: var(--accent-bronze);
            color: var(--text-light);
        }
        .demo-tab.active {
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            color: var(--primary-dark);
            border-color: var(--accent-bronze);
        }
        .demo-panel {
            display: none;
        }
        .demo-panel.active {
            display: block;
        }
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .comparison-card {
            background: var(--secondary-dark);
            border: 2px solid rgba(139, 111, 71, 0.2);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .comparison-card:hover {
            border-color: var(--accent-bronze);
            transform: translateY(-4px);
        }
        .comparison-title {
            color: var(--accent-bronze);
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        .comparison-property {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(139, 111, 71, 0.1);
        }
        .comparison-property:last-child {
            border-bottom: none;
        }
        .property-label {
            color: var(--text-dim);
            font-size: 0.9rem;
        }
        .property-value {
            color: var(--text-light);
            font-weight: 600;
        }
        .energy-meter {
            position: relative;
            height: 30px;
            background: var(--secondary-dark);
            border-radius: 15px;
            overflow: hidden;
            margin: 1rem 0;
        }
        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-bronze), var(--accent-bronze-light));
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 1rem;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }
        button {
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 111, 71, 0.4);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        input[type="range"] {
            width: 100%;
            margin: 1rem 0;
        }
        .cost-calculator {
            background: var(--secondary-dark);
            padding: 2rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        .calculator-row {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            padding: 1rem;
            background: var(--primary-dark);
            border-radius: 6px;
        }
        .reflection-section {
            background: linear-gradient(135deg, rgba(139, 111, 71, 0.1), rgba(139, 111, 71, 0.05));
            border: 2px solid rgba(139, 111, 71, 0.3);
            border-radius: 12px;
            padding: 2.5rem;
            margin: 3rem 0;
        }
        .reflection-section h2 {
            color: var(--accent-bronze);
            margin-bottom: 2rem;
            text-align: center;
        }
        .question-box {
            background: var(--secondary-dark);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }
        .question-box h3 {
            color: var(--accent-bronze-light);
            margin-bottom: 1rem;
        }
        textarea {
            width: 100%;
            min-height: 120px;
            background: var(--primary-dark);
            border: 2px solid rgba(139, 111, 71, 0.3);
            color: var(--text-light);
            padding: 1rem;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: var(--accent-bronze);
        }
        .next-module {
            text-align: center;
            margin-top: 3rem;
        }
        .next-module a {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-bronze), var(--accent-bronze-light));
            color: white;
            padding: 1.25rem 2.5rem;
            border-radius: 2rem;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        .next-module a:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(139, 111, 71, 0.5);
        }
        @media (max-width: 768px) {
            .module-header h1 { font-size: 2rem; }
            .comparison-grid { grid-template-columns: 1fr; }
            .demo-tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/paths/principled/stage-3/" class="back-btn">← Back to Stage 3</a>

        <div class="module-header">
            <div class="module-icon">⚡</div>
            <h1>The Cost of Truth</h1>
            <p class="module-subtitle">
                Truth requires energy—and that's exactly what makes it valuable.
                Discover why proof-of-work anchors digital records in physical reality.
            </p>
        </div>

        <!-- Introduction -->
        <div class="content-section">
            <h2>Why Does Truth Cost Energy?</h2>
            <p>
                In the physical world, creating something real requires energy. You can't build a house,
                grow food, or manufacture goods without expending energy. This is a fundamental law of physics.
            </p>
            <p>
                But in the digital world, copying is free. Files can be duplicated infinitely at zero cost.
                This creates a problem: <strong>How do you make digital records costly to corrupt?</strong>
            </p>

            <div class="highlight-box">
                <strong>The Breakthrough:</strong>
                Bitcoin solves this by tying digital records to physical energy expenditure.
                Through proof-of-work, altering Bitcoin's history would require re-spending the energy
                used to create it—making lies expensive and truth cheap to verify.
            </div>

            <p>
                This isn't a bug—it's the feature that makes Bitcoin's ledger immutable.
                Energy expenditure creates a bridge between the digital realm and physical reality.
            </p>
        </div>

        <!-- Free vs. Costly Information -->
        <div class="content-section">
            <h2>Free Information vs. Costly Truth</h2>
            <p>
                There's a critical difference between information that's free to create and truth that's costly to forge.
            </p>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <div class="comparison-title">🗣️ Free Information</div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to create</span>
                        <span class="property-value">$0</span>
                    </div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to copy</span>
                        <span class="property-value">$0</span>
                    </div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to verify</span>
                        <span class="property-value">Hard</span>
                    </div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to forge</span>
                        <span class="property-value">$0</span>
                    </div>
                    <p style="color: var(--text-dim); margin-top: 1rem; font-size: 0.9rem;">
                        Examples: Social media posts, fake news, spam emails
                    </p>
                </div>

                <div class="comparison-card">
                    <div class="comparison-title">⚡ Costly Truth (Bitcoin)</div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to create</span>
                        <span class="property-value">Energy + Time</span>
                    </div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to copy</span>
                        <span class="property-value">$0</span>
                    </div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to verify</span>
                        <span class="property-value">Easy</span>
                    </div>
                    <div class="comparison-property">
                        <span class="property-label">Cost to forge</span>
                        <span class="property-value">Impossible*</span>
                    </div>
                    <p style="color: var(--text-dim); margin-top: 1rem; font-size: 0.9rem;">
                        *Would require re-expending all energy used to secure the chain
                    </p>
                </div>
            </div>

            <h3>The Asymmetry That Matters</h3>
            <p>
                Bitcoin's genius is this asymmetry:
            </p>
            <ul>
                <li><strong>Creating a valid block:</strong> Requires massive energy expenditure</li>
                <li><strong>Verifying a block:</strong> Requires trivial computation</li>
                <li><strong>Altering history:</strong> Requires re-doing all the work that came after</li>
            </ul>

            <p>
                This makes honesty cheap to verify and dishonesty expensive to attempt.
            </p>
        </div>

        <!-- Proof-of-Work Explained -->
        <div class="content-section">
            <h2>How Proof-of-Work Creates Cost</h2>
            <p>
                Proof-of-work is a mechanism that requires miners to solve computational puzzles
                before adding new blocks to the blockchain. Here's why this matters:
            </p>

            <h3>1. Energy as an Unforgeable Costliness</h3>
            <p>
                Energy can't be faked. You either spent electricity running mining hardware, or you didn't.
                This creates an objective, physical anchor for digital records.
            </p>

            <h3>2.累積 Difficulty</h3>
            <p>
                Each new block added to Bitcoin requires more energy. The deeper a transaction is buried
                in the blockchain, the more energy you'd need to expend to alter it. After 6 blocks,
                rewriting history becomes economically irrational.
            </p>

            <h3>3. Time as a One-Way Function</h3>
            <p>
                Proof-of-work introduces time into the digital realm. You can't skip ahead—you must
                actually wait and compute. This prevents instant rewrites of history.
            </p>

            <div class="highlight-box">
                <strong>Thought Experiment:</strong>
                Imagine someone wants to alter a Bitcoin transaction from 1 hour ago (6 blocks deep).
                They would need to:
                <ul style="margin-top: 0.5rem;">
                    <li>Re-mine those 6 blocks faster than the honest network mines 1 new block</li>
                    <li>Control more than 51% of global mining power</li>
                    <li>Spend millions in electricity</li>
                </ul>
                And even if they succeeded, the network would likely reject their chain, making the attack pointless.
            </div>
        </div>

        <!-- Interactive Demos -->
        <div class="content-section">
            <h2>Interactive Demonstrations</h2>
            <p>
                Experience the cost of truth through these simulations.
            </p>

            <div class="demo-container">
                <div class="demo-tabs">
                    <button class="demo-tab active" onclick="switchTab('energy')">Energy Cost Calculator</button>
                    <button class="demo-tab" onclick="switchTab('attack')">Attack Cost Simulator</button>
                    <button class="demo-tab" onclick="switchTab('time')">Time-Lock Visualization</button>
                </div>

                <!-- Energy Cost Calculator -->
                <div id="energy-panel" class="demo-panel active">
                    <h3 style="color: var(--accent-bronze-light); margin-bottom: 1rem;">Energy Cost Calculator</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1.5rem;">
                        See how much energy it takes to secure Bitcoin blocks at different difficulty levels.
                    </p>

                    <div class="cost-calculator">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="color: var(--accent-bronze); font-weight: 600; display: block; margin-bottom: 0.5rem;">
                                Number of Blocks to Mine: <span id="blockCount">1</span>
                            </label>
                            <input type="range" id="blockSlider" min="1" max="10" value="1" oninput="updateEnergyCost()">
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">Estimated Energy (kWh)</span>
                            <span id="energyKwh" style="color: var(--accent-bronze); font-weight: 600;">~1,500</span>
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">Electricity Cost ($0.10/kWh)</span>
                            <span id="energyCost" style="color: var(--accent-bronze); font-weight: 600;">~$150</span>
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">Equivalent to powering a home for</span>
                            <span id="homeDays" style="color: var(--accent-bronze); font-weight: 600;">~50 days</span>
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">CO₂ Emissions (if coal-powered)</span>
                            <span id="co2Amount" style="color: var(--accent-bronze); font-weight: 600;">~1,200 kg</span>
                        </div>

                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(139, 111, 71, 0.1); border-radius: 6px;">
                            <div style="color: var(--accent-bronze); font-weight: 600; margin-bottom: 0.5rem;">💡 Context</div>
                            <div style="color: var(--text-dim); font-size: 0.9rem; line-height: 1.6;">
                                Bitcoin miners increasingly use renewable energy sources (hydro, solar, wind) and
                                capture otherwise-wasted energy (flared gas, excess grid capacity). The energy
                                expenditure is the security mechanism—it makes rewriting history prohibitively expensive.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attack Cost Simulator -->
                <div id="attack-panel" class="demo-panel">
                    <h3 style="color: var(--accent-bronze-light); margin-bottom: 1rem;">51% Attack Cost Simulator</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1.5rem;">
                        Calculate the cost of attempting to rewrite Bitcoin's history.
                    </p>

                    <div class="cost-calculator">
                        <div style="margin-bottom: 1.5rem;">
                            <label style="color: var(--accent-bronze); font-weight: 600; display: block; margin-bottom: 0.5rem;">
                                Blocks to Rewrite: <span id="attackDepth">6</span>
                            </label>
                            <input type="range" id="attackSlider" min="1" max="144" value="6" oninput="updateAttackCost()">
                            <div style="color: var(--text-dim); font-size: 0.85rem; margin-top: 0.5rem;">
                                (144 blocks = ~1 day of history)
                            </div>
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">Hashpower Needed</span>
                            <span id="hashpower" style="color: #e74c3c; font-weight: 600;">>51% of network</span>
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">Hardware Cost (ASIC miners)</span>
                            <span id="hardwareCost" style="color: #e74c3c; font-weight: 600;">~$15 billion</span>
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">Electricity Cost to Rewrite</span>
                            <span id="attackElectricity" style="color: #e74c3c; font-weight: 600;">~$900,000</span>
                        </div>

                        <div class="calculator-row">
                            <span style="color: var(--text-dim);">Total Attack Cost</span>
                            <span id="totalAttackCost" style="color: #e74c3c; font-weight: 600; font-size: 1.2rem;">~$15,000,900,000</span>
                        </div>

                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(231, 76, 60, 0.1); border-radius: 6px; border-left: 4px solid #e74c3c;">
                            <div style="color: #e74c3c; font-weight: 600; margin-bottom: 0.5rem;">⚠️ Attack Outcome</div>
                            <div style="color: var(--text-dim); font-size: 0.9rem; line-height: 1.6;">
                                Even if the attack succeeded, the Bitcoin price would crash due to lost confidence,
                                making the attacker's coins worthless. The attacker would destroy billions in value
                                while gaining nothing. This is why Bitcoin has never been successfully attacked.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Time-Lock Visualization -->
                <div id="time-panel" class="demo-panel">
                    <h3 style="color: var(--accent-bronze-light); margin-bottom: 1rem;">Time-Lock Visualization</h3>
                    <p style="color: var(--text-dim); margin-bottom: 1.5rem;">
                        Watch how transactions become progressively harder to alter as they get buried deeper in the chain.
                    </p>

                    <div style="background: var(--secondary-dark); padding: 2rem; border-radius: 8px;">
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div style="color: var(--text-light); font-size: 1.2rem; margin-bottom: 0.5rem;">
                                Your Transaction: <span style="color: var(--accent-bronze); font-weight: 600;">0.1 BTC to Alice</span>
                            </div>
                            <div style="color: var(--text-dim); font-size: 0.9rem;">
                                Confirmations: <span id="confirmations" style="color: var(--accent-bronze); font-weight: 600;">0</span> / 6 recommended
                            </div>
                        </div>

                        <div style="margin: 2rem 0;">
                            <div style="color: var(--text-dim); font-size: 0.9rem; margin-bottom: 0.5rem;">
                                Security Level
                            </div>
                            <div class="energy-meter">
                                <div id="securityFill" class="energy-fill" style="width: 0%;">0%</div>
                            </div>
                        </div>

                        <div id="blockList" style="margin: 2rem 0;"></div>

                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                            <button onclick="addConfirmation()">Mine Next Block (~10 min)</button>
                            <button onclick="resetConfirmations()">Reset</button>
                        </div>

                        <div id="statusMessage" style="margin-top: 1.5rem; padding: 1rem; background: rgba(139, 111, 71, 0.1); border-radius: 6px; text-align: center;">
                            <div style="color: var(--accent-bronze); font-weight: 600; margin-bottom: 0.5rem;">⏳ Waiting for first confirmation...</div>
                            <div style="color: var(--text-dim); font-size: 0.9rem;">
                                Transaction is in the mempool, waiting to be included in a block.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Why Energy Isn't Waste -->
        <div class="content-section">
            <h2>Why This Energy Isn't "Wasted"</h2>
            <p>
                Critics often say Bitcoin "wastes" energy. But this misunderstands what Bitcoin's energy does.
            </p>

            <h3>Energy Secures $1+ Trillion in Value</h3>
            <p>
                Bitcoin's energy expenditure directly corresponds to its security level. The more energy
                spent mining, the more expensive it becomes to attack the network. This energy secures
                hundreds of billions of dollars worth of digital assets.
            </p>

            <h3>Enables Uncensorable Money</h3>
            <p>
                The energy cost makes Bitcoin resistant to government shutdown or corporate control.
                You can't simply "turn off" a system that's distributed across thousands of independent
                miners worldwide.
            </p>

            <h3>Uses Otherwise-Wasted Energy</h3>
            <p>
                Bitcoin miners seek the cheapest energy, which often means:
            </p>
            <ul>
                <li>Capturing flared gas that would otherwise burn into the atmosphere</li>
                <li>Using excess renewable energy that can't be stored or transmitted</li>
                <li>Monetizing stranded energy resources too remote for other uses</li>
                <li>Balancing electrical grids by consuming surplus during low-demand periods</li>
            </ul>

            <div class="highlight-box">
                <strong>Reframing the Question:</strong>
                Instead of asking "Is Bitcoin's energy use wasteful?", ask:
                "What is the appropriate energy cost for securing a global, uncensorable, immutable ledger
                that enables financial sovereignty for billions of people?"
            </div>
        </div>

        <!-- The Physics of Immutability -->
        <div class="content-section">
            <h2>The Physics of Immutability</h2>
            <p>
                Bitcoin's immutability comes from a fundamental law of physics: <strong>energy cannot be created or destroyed</strong>.
            </p>

            <p>
                When miners expend energy to create a block:
            </p>
            <ul>
                <li>That energy is permanently gone—converted to heat</li>
                <li>The computational work cannot be "undone"</li>
                <li>To change the block, you must re-expend that energy</li>
                <li>Each subsequent block makes previous blocks exponentially harder to change</li>
            </ul>

            <p>
                This is why Bitcoin's ledger gets progressively more immutable over time. The energy
                expenditure creates a one-way time-lock that anchors digital records in physical reality.
            </p>

            <div class="highlight-box">
                <strong>The Elegant Truth:</strong>
                Bitcoin doesn't waste energy—it transforms energy into security, immutability, and truth.
                The energy becomes the unforgeable cost of altering history.
            </div>
        </div>

        <!-- Socratic Reflection -->
        <div class="reflection-section">
            <h2>💭 Reflect on What You've Learned</h2>
            <p style="text-align: center; color: var(--text-dim); margin-bottom: 2rem;">
                Think deeply about the relationship between energy, truth, and value.
                Your reflections are saved automatically.
            </p>

            <div class="question-box">
                <h3>Question 1: Digital vs. Physical</h3>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    In the digital world, copying is free, but in the physical world, creation requires energy.
                    How does Bitcoin bridge these two realms? Why is this bridge necessary for digital money?
                </p>
                <textarea id="question1" placeholder="Type your reflection here..."></textarea>
            </div>

            <div class="question-box">
                <h3>Question 2: Energy and Value</h3>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    Some say Bitcoin "wastes" energy. But all forms of money require resources to secure them
                    (bank vaults, armed guards, regulatory agencies). Is Bitcoin's energy expenditure
                    fundamentally different? Why or why not?
                </p>
                <textarea id="question2" placeholder="Type your reflection here..."></textarea>
            </div>

            <div class="question-box">
                <h3>Question 3: The Cost of Truth</h3>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    If truth were free to create, lies would be indistinguishable from facts. If truth is
                    costly to forge, verification becomes easy. How does this principle apply beyond Bitcoin—
                    to journalism, science, or governance?
                </p>
                <textarea id="question3" placeholder="Type your reflection here..."></textarea>
            </div>
        </div>

        <!-- Next Steps -->
        <div class="next-module">
            <h2 style="color: var(--accent-bronze); margin-bottom: 1rem;">Stage 3 Complete!</h2>
            <p style="color: var(--text-dim); margin-bottom: 2rem;">
                You've learned how Bitcoin's technical building blocks create an immutable ledger.
                Next, explore how these pieces come together as an emergent system.
            </p>
            <a href="/paths/principled/stage-4/">
                Continue to Stage 4: Bitcoin as an Emergent System →
            </a>
        </div>
    </div>

    <script>
        // ===== Energy Cost Calculator =====
        function updateEnergyCost() {
            const blocks = parseInt(document.getElementById('blockSlider').value);
            document.getElementById('blockCount').textContent = blocks;

            // Approximate values (real values vary based on network hashrate)
            const kwhPerBlock = 1500;
            const electricityRate = 0.10; // $0.10 per kWh
            const homeKwhPerDay = 30;
            const co2PerKwh = 0.8; // kg CO2 per kWh for coal

            const totalKwh = kwhPerBlock * blocks;
            const totalCost = totalKwh * electricityRate;
            const homeDays = Math.round(totalKwh / homeKwhPerDay);
            const co2 = Math.round(totalKwh * co2PerKwh);

            document.getElementById('energyKwh').textContent = `~${totalKwh.toLocaleString()}`;
            document.getElementById('energyCost').textContent = `~$${Math.round(totalCost).toLocaleString()}`;
            document.getElementById('homeDays').textContent = `~${homeDays} days`;
            document.getElementById('co2Amount').textContent = `~${co2.toLocaleString()} kg`;
        }

        // ===== Attack Cost Simulator =====
        function updateAttackCost() {
            const blocks = parseInt(document.getElementById('attackSlider').value);
            document.getElementById('attackDepth').textContent = blocks;

            // Simplified calculations
            const hardwareCostBillion = 15;
            const electricityPerBlock = 150000; // $150k per block
            const totalElectricity = electricityPerBlock * blocks;
            const totalCost = (hardwareCostBillion * 1e9) + totalElectricity;

            document.getElementById('hardwareCost').textContent = `~$${hardwareCostBillion} billion`;
            document.getElementById('attackElectricity').textContent = `~$${(totalElectricity / 1000).toFixed(0)}k`;
            document.getElementById('totalAttackCost').textContent = `~$${(totalCost / 1e9).toFixed(2)} billion`;
        }

        // ===== Time-Lock Visualization =====
        let confirmationCount = 0;
        const maxConfirmations = 6;

        function addConfirmation() {
            if (confirmationCount >= maxConfirmations) return;

            confirmationCount++;
            updateTimeLock();
        }

        function resetConfirmations() {
            confirmationCount = 0;
            updateTimeLock();
        }

        function updateTimeLock() {
            document.getElementById('confirmations').textContent = confirmationCount;

            const securityPercent = Math.min((confirmationCount / maxConfirmations) * 100, 100);
            const fill = document.getElementById('securityFill');
            fill.style.width = securityPercent + '%';
            fill.textContent = Math.round(securityPercent) + '%';

            // Update block list
            const blockList = document.getElementById('blockList');
            if (confirmationCount === 0) {
                blockList.innerHTML = '';
            } else {
                let blocksHTML = '';
                for (let i = 0; i < confirmationCount; i++) {
                    const opacity = 1 - (i * 0.1);
                    blocksHTML += `
                        <div style="padding: 1rem; margin: 0.5rem 0; background: rgba(139, 111, 71, ${opacity * 0.2}); border-left: 4px solid var(--accent-bronze); border-radius: 6px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="color: var(--accent-bronze); font-weight: 600;">Block ${800000 + i}</div>
                                    <div style="color: var(--text-dim); font-size: 0.85rem;">${i === 0 ? 'Contains your transaction' : `${i} confirmation${i > 1 ? 's' : ''} deep`}</div>
                                </div>
                                <div style="color: var(--text-light); font-weight: 600;">
                                    ${i === 0 ? '⏱️' : '✓'}
                                </div>
                            </div>
                        </div>
                    `;
                }
                blockList.innerHTML = blocksHTML;
            }

            // Update status message
            const statusDiv = document.getElementById('statusMessage');
            if (confirmationCount === 0) {
                statusDiv.innerHTML = `
                    <div style="color: var(--accent-bronze); font-weight: 600; margin-bottom: 0.5rem;">⏳ Waiting for first confirmation...</div>
                    <div style="color: var(--text-dim); font-size: 0.9rem;">
                        Transaction is in the mempool, waiting to be included in a block.
                    </div>
                `;
            } else if (confirmationCount < 3) {
                statusDiv.style.background = 'rgba(241, 196, 15, 0.1)';
                statusDiv.style.borderLeft = '4px solid #f1c40f';
                statusDiv.innerHTML = `
                    <div style="color: #f1c40f; font-weight: 600; margin-bottom: 0.5rem;">⚠️ Low Security (${confirmationCount} confirmation${confirmationCount > 1 ? 's' : ''})</div>
                    <div style="color: var(--text-dim); font-size: 0.9rem;">
                        Wait for more confirmations for high-value transactions. Each block makes reversal exponentially harder.
                    </div>
                `;
            } else if (confirmationCount < 6) {
                statusDiv.style.background = 'rgba(52, 152, 219, 0.1)';
                statusDiv.style.borderLeft = '4px solid #3498db';
                statusDiv.innerHTML = `
                    <div style="color: #3498db; font-weight: 600; margin-bottom: 0.5rem;">🔒 Medium Security (${confirmationCount} confirmations)</div>
                    <div style="color: var(--text-dim); font-size: 0.9rem;">
                        Your transaction is getting buried deeper. Reversal would require re-mining ${confirmationCount} blocks.
                    </div>
                `;
            } else {
                statusDiv.style.background = 'rgba(46, 204, 113, 0.1)';
                statusDiv.style.borderLeft = '4px solid #2ecc71';
                statusDiv.innerHTML = `
                    <div style="color: #2ecc71; font-weight: 600; margin-bottom: 0.5rem;">✅ High Security (${confirmationCount} confirmations)</div>
                    <div style="color: var(--text-dim); font-size: 0.9rem;">
                        Your transaction is effectively irreversible. It would cost millions to attempt reversal.
                    </div>
                `;
            }
        }

        // ===== Tab Switching =====
        function switchTab(tab) {
            document.querySelectorAll('.demo-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.demo-panel').forEach(p => p.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tab}-panel`).classList.add('active');
        }

        // ===== Reflection Questions with localStorage =====
        const STORAGE_KEY = 'principled-stage3-module3-reflections';

        function saveReflection(questionNum, value) {
            const reflections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            reflections[`question${questionNum}`] = value;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(reflections));
        }

        function loadReflections() {
            const reflections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            for (let i = 1; i <= 3; i++) {
                const textarea = document.getElementById(`question${i}`);
                if (textarea && reflections[`question${i}`]) {
                    textarea.value = reflections[`question${i}`];
                }
            }
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            loadReflections();
            updateEnergyCost();
            updateAttackCost();
            updateTimeLock();

            // Auto-save reflections
            ['question1', 'question2', 'question3'].forEach((id, index) => {
                const textarea = document.getElementById(id);
                if (textarea) {
                    textarea.addEventListener('input', (e) => {
                        saveReflection(index + 1, e.target.value);
                    });
                }
            });
        });
    </script>
</body>
</html>
