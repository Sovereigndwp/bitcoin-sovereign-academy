<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 3: Trust, Power, and Accountability | Stage 2 | Principled Path</title>
    <link rel="stylesheet" href="/css/brand.css">
    <style>
        :root {
            --accent-bronze: #8B6F47;
            --accent-bronze-light: #A0826D;
            --primary-dark: #1a1a1a;
            --secondary-dark: #2d2d2d;
            --text-light: #e0e0e0;
            --text-dim: #b3b3b3;
            --danger-red: #e74c3c;
            --success-green: #2ecc71;
            --warning-yellow: #f39c12;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-dark);
            color: var(--text-light);
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Navigation */
        .breadcrumb {
            
            margin-bottom: 2rem;
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--accent-bronze);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb ol {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .breadcrumb li {
            display: inline;
            color: var(--text-dim);
        }

        .breadcrumb li:not(:last-child)::after {
            content: "‚Üí";
            margin-left: 0.5rem;
        }


        /* Module Header */
        .module-header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: var(--secondary-dark);
            border-radius: 12px;
            border: 2px solid var(--accent-bronze);
        }

        .stage-indicator {
            font-size: 0.9rem;
            color: var(--accent-bronze);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .module-subtitle {
            font-size: 1.2rem;
            color: var(--text-dim);
        }

        /* Content Sections */
        .content-section {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }

        .content-section h2 {
            color: var(--accent-bronze);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }

        .content-section h3 {
            color: var(--accent-bronze-light);
            font-size: 1.3rem;
            margin: 2rem 0 1rem;
        }

        .content-section p {
            color: var(--text-dim);
            margin-bottom: 1rem;
            line-height: 1.8;
        }

        .key-insight {
            background: rgba(247, 147, 26, 0.1);
            border-left: 4px solid var(--accent-bronze);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .key-insight p {
            color: var(--text-light);
            font-weight: 500;
        }

        /* Interactive Demo Styles */
        .demo-container {
            background: var(--primary-dark);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .demo-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .demo-header h3 {
            color: var(--accent-bronze);
            margin-bottom: 0.5rem;
        }

        .demo-header p {
            color: var(--text-dim);
            font-size: 0.95rem;
        }

        .system-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .system-card {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 2rem;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .system-card.surveillance {
            border-color: var(--danger-red);
        }

        .system-card.transparency {
            border-color: var(--success-green);
        }

        .system-card h4 {
            font-size: 1.4rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .system-card.surveillance h4 {
            color: var(--danger-red);
        }

        .system-card.transparency h4 {
            color: var(--success-green);
        }

        .system-visual {
            height: 250px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: var(--primary-dark);
        }

        /* Panopticon Styles */
        .panopticon-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .central-tower {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 80px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
            z-index: 10;
        }

        .watched-cell {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(231, 76, 60, 0.3);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .watched-cell.watching {
            border-color: var(--danger-red);
            background: rgba(231, 76, 60, 0.2);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.6);
        }

        .watch-beam {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            width: 2px;
            height: 100px;
            background: linear-gradient(to bottom,
                rgba(231, 76, 60, 0.8),
                rgba(231, 76, 60, 0));
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .watch-beam.active {
            opacity: 1;
        }

        /* Transparent Ledger Styles */
        .ledger-container {
            position: relative;
            width: 100%;
            height: 100%;
            padding: 1rem;
        }

        .ledger-block {
            background: rgba(46, 204, 113, 0.1);
            border: 2px solid rgba(46, 204, 113, 0.3);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .ledger-block.highlight {
            border-color: var(--success-green);
            background: rgba(46, 204, 113, 0.2);
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.4);
        }

        .ledger-block .block-header {
            color: var(--success-green);
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .ledger-block .block-data {
            color: var(--text-dim);
        }

        .verification-icon {
            display: inline-block;
            color: var(--success-green);
            margin-left: 0.5rem;
        }

        /* Control Buttons */
        .demo-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        .demo-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .demo-btn.surveillance {
            background: var(--danger-red);
            color: white;
        }

        .demo-btn.surveillance:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
        }

        .demo-btn.transparency {
            background: var(--success-green);
            color: white;
        }

        .demo-btn.transparency:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4);
        }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            margin-top: 2rem;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(139, 111, 71, 0.2);
        }

        .comparison-table th {
            color: var(--accent-bronze);
            font-weight: 600;
            background: rgba(139, 111, 71, 0.1);
        }

        .comparison-table td {
            color: var(--text-dim);
        }

        .comparison-table td:first-child {
            color: var(--text-light);
            font-weight: 500;
        }

        .check-mark {
            color: var(--success-green);
            font-weight: bold;
        }

        .x-mark {
            color: var(--danger-red);
            font-weight: bold;
        }

        /* Socratic Questions */
        .question-section {
            background: var(--secondary-dark);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(139, 111, 71, 0.2);
        }

        .question-section h4 {
            color: var(--accent-bronze);
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .question-section textarea {
            width: 100%;
            min-height: 100px;
            background: var(--primary-dark);
            border: 2px solid rgba(139, 111, 71, 0.3);
            border-radius: 8px;
            padding: 1rem;
            color: var(--text-light);
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
        }

        .question-section textarea:focus {
            outline: none;
            border-color: var(--accent-bronze);
        }

        .save-indicator {
            font-size: 0.9rem;
            color: var(--text-dim);
            margin-top: 0.5rem;
            font-style: italic;
        }

        /* Navigation Buttons */
        .module-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            gap: 1rem;
        }

        .nav-btn {
            padding: 1rem 2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .nav-btn-primary {
            background: linear-gradient(45deg, #8B6F47, #A0826D);
            color: var(--primary-dark);
        }

        .nav-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(139, 111, 71, 0.4);
        }

        .nav-btn-secondary {
            background: var(--secondary-dark);
            color: var(--accent-bronze);
            border: 2px solid var(--accent-bronze);
        }

        .nav-btn-secondary:hover {
            background: var(--accent-bronze);
            color: var(--primary-dark);
        }

        
        /* ===== ACCESSIBILITY ENHANCEMENTS (WCAG 2.1 AA) ===== */

        /* WCAG 2.5.5: Touch Target Size */
        button, a, [role="button"], .nav-btn, .nav-link, .back-button, .demo-button, .feedback-btn, .check-answer-btn {
            min-height: 44px;
            min-width: 44px;
        }

        p a, li a {
            min-height: auto;
            min-width: auto;
            padding: 0.25rem 0;
        }

        /* WCAG 2.4.7: Focus Visible */
        *:focus-visible {
            outline: 3px solid var(--accent-bronze, #8B6F47);
            outline-offset: 2px;
        }

        button:focus-visible, a:focus-visible, [role="button"]:focus-visible {
            outline: 3px solid var(--accent-bronze, #8B6F47);
            outline-offset: 4px;
            box-shadow: 0 0 0 4px rgba(139, 111, 71, 0.2);
        }

        /* WCAG 2.3.3: Animation from Interactions */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* WCAG 1.4.10: Reflow */
        @media (max-width: 360px) {
            body {
                overflow-x: hidden;
            }

            .container {
                padding: 0 1rem;
            }
        }


        @media (max-width: 768px) {
            .container { padding: 1rem; }
            h1 { font-size: 2rem; }
            .system-comparison {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            .module-navigation {
                flex-direction: column;
            }
            .nav-btn {
                text-align: center;
            }
        }
    </style>
    <script src="/js/subdomain-access-control.js"></script>
    <script src="/js/module-gate-subdomain.js"></script>
    <link rel="stylesheet" href="/css/icons.css">
</head>
<body>
    <div class="container">
        <!-- Breadcrumb Navigation -->
        <nav class="breadcrumb">
            <a href="/">Home</a> ‚Üí
            <a href="/paths/principled/">Principled Path</a> ‚Üí
            <a href="/paths/principled/stage-2/">Stage 2</a> ‚Üí
            <span>Module 3</span>
        </nav>

        <!-- Module Header -->
        <header class="module-header">
            <div class="stage-indicator">STAGE 2 ¬∑ MODULE 3</div>
            <h1>Trust, Power, and Accountability</h1>
            <p class="module-subtitle">Why verification beats trust when transparency is lost</p>
        </header>

        <!-- Introduction Section -->
        <section class="content-section">
            <h2>The Accountability Problem</h2>
            <p>
                Power without transparency leads to corruption. When those in authority cannot be observed,
                they act in their own interest, not the public's. History shows this pattern repeating:
                banks create money in secret, governments print currency behind closed doors, and financial
                institutions manipulate markets without consequence.
            </p>

            <div class="key-insight">
                <p>
                    <strong>Core Principle:</strong> Trust decays exponentially with distance from verification.
                    When you cannot see what someone is doing, you cannot hold them accountable.
                </p>
            </div>

            <p>
                Two models exist for managing power: surveillance (one watches many) and transparency
                (many watch one). The former concentrates power. The latter distributes it.
            </p>
        </section>

        <!-- Problem Section -->
        <section class="content-section">
            <h2>Two Models of Accountability</h2>

            <h3>The Panopticon: One Watches Many</h3>
            <p>
                In the 18th century, philosopher Jeremy Bentham designed the "panopticon": a circular
                prison where a single guard in a central tower could observe all prisoners without being
                seen. Prisoners never knew when they were being watched, so they had to assume constant
                surveillance. The guard held all the power.
            </p>
            <p>
                Modern financial systems operate like panopticons: central banks watch all transactions,
                freeze accounts, and monitor spending, while their own money creation happens in secret
                boardrooms. The watchers are never watched.
            </p>

            <h3>The Transparent Ledger: Many Watch One</h3>
            <p>
                In contrast, a transparent ledger inverts the power structure. Every transaction is visible
                to everyone. No single authority can change the rules without detection. Verification replaces
                trust. The system becomes accountable by design, not by promise.
            </p>
            <p>
                An ideal monetary system would embody this model: every transaction, every unit created, every rule change
                would be visible to all participants. Code would enforce the rules. No central authority could inflate supply
                without everyone immediately knowing.
            </p>
        </section>

        <!-- Interactive Demo -->
        <section class="content-section">
            <h2>Interactive Demo: Surveillance vs. Transparency</h2>

            <div class="demo-container">
                <div class="demo-header">
                    <h3>Experience the Difference</h3>
                    <p>Compare the panopticon model with the transparent ledger model</p>
                </div>

                <div class="system-comparison">
                    <!-- Panopticon System -->
                    <div class="system-card surveillance">
                        <h4>üëÅÔ∏è Panopticon (Surveillance)</h4>
                        <div class="system-visual" id="panopticon">
                            <div class="panopticon-container">
                                <div class="central-tower">üèõÔ∏è</div>
                                <div class="watched-cell" style="top: 20%; left: 20%;">üë§</div>
                                <div class="watched-cell" style="top: 20%; right: 20%;">üë§</div>
                                <div class="watched-cell" style="bottom: 20%; left: 20%;">üë§</div>
                                <div class="watched-cell" style="bottom: 20%; right: 20%;">üë§</div>
                                <div class="watched-cell" style="top: 50%; left: 5%;">üë§</div>
                                <div class="watched-cell" style="top: 50%; right: 5%;">üë§</div>
                                <div class="watch-beam" id="beam1"></div>
                                <div class="watch-beam" id="beam2"></div>
                                <div class="watch-beam" id="beam3"></div>
                            </div>
                        </div>
                        <p style="color: var(--text-dim); font-size: 0.9rem; text-align: center;">
                            Central authority watches citizens.<br>
                            Citizens cannot watch back.<br>
                            Power flows one direction.
                        </p>
                    </div>

                    <!-- Transparent Ledger System -->
                    <div class="system-card transparency">
                        <h4><span data-icon="book"></span> Transparent Ledger</h4>
                        <div class="system-visual" id="ledger">
                            <div class="ledger-container">
                                <div class="ledger-block">
                                    <div class="block-header">Block #840,123</div>
                                    <div class="block-data">
                                        Txns: 2,847 | Reward: 3.125 units
                                        <span class="verification-icon">‚úì</span>
                                    </div>
                                </div>
                                <div class="ledger-block">
                                    <div class="block-header">Block #840,124</div>
                                    <div class="block-data">
                                        Txns: 3,102 | Reward: 3.125 units
                                        <span class="verification-icon">‚úì</span>
                                    </div>
                                </div>
                                <div class="ledger-block">
                                    <div class="block-header">Block #840,125</div>
                                    <div class="block-data">
                                        Txns: 2,956 | Reward: 3.125 units
                                        <span class="verification-icon">‚úì</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p style="color: var(--text-dim); font-size: 0.9rem; text-align: center;">
                            Everyone can verify all transactions.<br>
                            No central authority to trust.<br>
                            Power distributed to all.
                        </p>
                    </div>
                </div>

                <div class="demo-controls">
                    <button class="demo-btn surveillance" id="activateSurveillance">
                        üëÅÔ∏è Activate Surveillance
                    </button>
                    <button class="demo-btn transparency" id="activateTransparency">
                        <span data-icon="book"></span> Verify Ledger
                    </button>
                </div>

                <!-- Comparison Table -->
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Feature</th>
                            <th>Panopticon</th>
                            <th>Transparent Ledger</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Who can observe?</td>
                            <td><span class="x-mark">‚úó</span> Only authority</td>
                            <td><span class="check-mark">‚úì</span> Everyone</td>
                        </tr>
                        <tr>
                            <td>Who has power?</td>
                            <td><span class="x-mark">‚úó</span> Centralized</td>
                            <td><span class="check-mark">‚úì</span> Distributed</td>
                        </tr>
                        <tr>
                            <td>Can rules change secretly?</td>
                            <td><span class="x-mark">‚úó</span> Yes</td>
                            <td><span class="check-mark">‚úì</span> No</td>
                        </tr>
                        <tr>
                            <td>Who verifies behavior?</td>
                            <td><span class="x-mark">‚úó</span> Trust required</td>
                            <td><span class="check-mark">‚úì</span> Math verifies</td>
                        </tr>
                        <tr>
                            <td>Accountability</td>
                            <td><span class="x-mark">‚úó</span> None for authority</td>
                            <td><span class="check-mark">‚úì</span> Enforced by code</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- What Would a Solution Look Like? -->
        <section class="content-section">
            <h2>The Solution Pattern: Verification, Not Trust</h2>

            <p>
                An ideal system would replace the need to trust authorities with the ability to verify facts. Every
                participant could independently confirm:
            </p>

            <ul style="color: var(--text-dim); margin-left: 2rem; line-height: 2;">
                <li><strong>Total supply:</strong> Exactly how many units exist (with a hard maximum)</li>
                <li><strong>Transaction validity:</strong> Every transaction follows the rules</li>
                <li><strong>New issuance:</strong> Participants must prove work to create new units</li>
                <li><strong>Rule changes:</strong> No one can change the protocol without consensus</li>
            </ul>

            <div class="key-insight">
                <p>
                    <strong>Why This Matters:</strong> When verification replaces trust, power cannot concentrate.
                    Corruption requires secrecy. Transparency by default eliminates the corruption curve.
                </p>
                <p style="margin-top: 1rem; font-style: italic; color: var(--text-dim);">
                    Continue forward to discover the cryptographic system that makes this real.
                </p>
            </div>

            <h3>Real-World Impact</h3>
            <p>
                In traditional systems, governments and banks can:
            </p>
            <ul style="color: var(--text-dim); margin-left: 2rem; line-height: 2;">
                <li>Print money in secret boardrooms</li>
                <li>Freeze accounts without explanation</li>
                <li>Change rules retroactively</li>
                <li>Confiscate wealth through inflation</li>
                <li>Censor transactions they dislike</li>
            </ul>

            <p>
                In a transparent, verifiable system, these actions would be cryptographically impossible. The code would be the law,
                and the law would be visible to all.
            </p>
        </section>

        <!-- Socratic Questions -->
        <section class="content-section">
            <h2>Reflection Questions</h2>
            <p style="color: var(--text-dim); margin-bottom: 2rem;">
                Consider these questions. Your responses are saved locally and never shared.
            </p>

            <div class="question-section">
                <h4>Question 1: Surveillance in Daily Life</h4>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    Where do you see the "panopticon model" in your daily life? How do governments,
                    corporations, or financial institutions observe you without being observable themselves?
                </p>
                <textarea
                    id="question1"
                    placeholder="Your reflection..."
                ></textarea>
                <div class="save-indicator">Auto-saved locally</div>
            </div>

            <div class="question-section">
                <h4>Question 2: Power Without Accountability</h4>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    Think of an institution you're supposed to trust (bank, government, employer).
                    What happens when they make decisions behind closed doors? Can you verify their claims?
                </p>
                <textarea
                    id="question2"
                    placeholder="Your reflection..."
                ></textarea>
                <div class="save-indicator">Auto-saved locally</div>
            </div>

            <div class="question-section">
                <h4>Question 3: Verification vs. Trust</h4>
                <p style="color: var(--text-dim); margin-bottom: 1rem;">
                    Imagine a monetary system where you could verify the total supply, transaction history, and rule enforcement yourself.
                    How would your relationship with money change if you could verify everything banks currently
                    ask you to trust?
                </p>
                <textarea
                    id="question3"
                    placeholder="Your reflection..."
                ></textarea>
                <div class="save-indicator">Auto-saved locally</div>
            </div>
        </section>

        <!-- Module Navigation -->
        <nav class="module-navigation">
            <a href="/paths/principled/stage-2/module-2.html" class="nav-btn nav-btn-secondary">
                ‚Üê Previous: The Corruption Curve
            </a>
            <a href="/paths/principled/stage-2/?completed=true&module=3" class="nav-btn nav-btn-primary">
                Complete Module 3 ‚Üí
            </a>
        </nav>
    </div>

    <script>
        // Demo: Surveillance System Animation
        const surveillanceBtn = document.getElementById('activateSurveillance');
        const transparencyBtn = document.getElementById('activateTransparency');
        const watchedCells = document.querySelectorAll('.watched-cell');
        const beams = document.querySelectorAll('.watch-beam');
        const ledgerBlocks = document.querySelectorAll('.ledger-block');

        let surveillanceInterval = null;
        let currentTarget = 0;

        surveillanceBtn.addEventListener('click', () => {
            // Clear any existing surveillance
            if (surveillanceInterval) {
                clearInterval(surveillanceInterval);
                watchedCells.forEach(cell => cell.classList.remove('watching'));
                beams.forEach(beam => beam.classList.remove('active'));
            }

            // Start surveillance animation
            surveillanceInterval = setInterval(() => {
                // Remove previous highlights
                watchedCells.forEach(cell => cell.classList.remove('watching'));
                beams.forEach(beam => beam.classList.remove('active'));

                // Highlight random citizen
                const targetIndex = Math.floor(Math.random() * watchedCells.length);
                watchedCells[targetIndex].classList.add('watching');

                // Show watch beam
                if (beams[targetIndex % beams.length]) {
                    const beam = beams[targetIndex % beams.length];
                    beam.classList.add('active');

                    // Calculate angle to target
                    const cell = watchedCells[targetIndex];
                    const cellRect = cell.getBoundingClientRect();
                    const tower = document.querySelector('.central-tower');
                    const towerRect = tower.getBoundingClientRect();

                    const angle = Math.atan2(
                        cellRect.top - towerRect.top,
                        cellRect.left - towerRect.left
                    ) * (180 / Math.PI);

                    beam.style.transform = `rotate(${angle}deg)`;
                }
            }, 1500);

            // Auto-stop after 10 seconds
            setTimeout(() => {
                if (surveillanceInterval) {
                    clearInterval(surveillanceInterval);
                    surveillanceInterval = null;
                    watchedCells.forEach(cell => cell.classList.remove('watching'));
                    beams.forEach(beam => beam.classList.remove('active'));
                }
            }, 10000);
        });

        // Demo: Transparent Ledger Animation
        transparencyBtn.addEventListener('click', () => {
            // Clear surveillance if running
            if (surveillanceInterval) {
                clearInterval(surveillanceInterval);
                surveillanceInterval = null;
                watchedCells.forEach(cell => cell.classList.remove('watching'));
                beams.forEach(beam => beam.classList.remove('active'));
            }

            // Highlight blocks sequentially
            ledgerBlocks.forEach((block, index) => {
                setTimeout(() => {
                    block.classList.add('highlight');
                    setTimeout(() => {
                        block.classList.remove('highlight');
                    }, 800);
                }, index * 600);
            });
        });

        // Socratic Questions - LocalStorage
        const STORAGE_KEY = 'principled-stage2-module3-reflections';

        function saveReflection(questionNum, value) {
            const reflections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            reflections[`question${questionNum}`] = value;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(reflections));
        }

        function loadReflections() {
            const reflections = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            for (let i = 1; i <= 3; i++) {
                const textarea = document.getElementById(`question${i}`);
                if (textarea && reflections[`question${i}`]) {
                    textarea.value = reflections[`question${i}`];
                }
            }
        }

        // Auto-save reflections
        document.getElementById('question1').addEventListener('input', (e) => {
            saveReflection(1, e.target.value);
        });

        document.getElementById('question2').addEventListener('input', (e) => {
            saveReflection(2, e.target.value);
        });

        document.getElementById('question3').addEventListener('input', (e) => {
            saveReflection(3, e.target.value);
        });

        // Load saved reflections on page load
        loadReflections();

        // Track module completion
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('completed') === 'true') {
            const progress = JSON.parse(localStorage.getItem('principled-path-progress') || '{}');
            if (!progress.stage2) progress.stage2 = {};
            progress.stage2.module3 = true;
            localStorage.setItem('principled-path-progress', JSON.stringify(progress));
        }
    </script>

    <!-- Animated Icon Library -->
    <script src="/js/icon-library.js"></script>
    <script>
        // Inject icons after DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            if (window.IconLibrary) {
                document.querySelectorAll('[data-icon]').forEach(function(element) {
                    var iconName = element.getAttribute('data-icon');
                    if (iconName) {
                        var iconHTML = IconLibrary.get(iconName, 20, true);
                        var span = document.createElement('span');
                        span.innerHTML = iconHTML;
                        span.className = 'icon-inline';
                        span.style.marginRight = '0.5rem';
                        span.style.display = 'inline-block';
                        span.style.verticalAlign = 'middle';
                        element.insertBefore(span, element.firstChild);
                    }
                });
            }
        });
    </script>
</body>
</html>
