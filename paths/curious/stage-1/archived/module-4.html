<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building Digital Trust | The Curious Path | Bitcoin Sovereign Academy</title>

    <style>
        :root {
            --primary-orange: #f7931a;
            --primary-dark: #1a1a1a;
            --secondary-dark: #2d2d2d;
            --accent-green: #4caf50;
            --accent-blue: #2196f3;
            --accent-purple: #9c27b0;
            --text-light: #e0e0e0;
            --text-dim: #999;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-dark);
            color: var(--text-light);
            line-height: 1.8;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            background: linear-gradient(135deg, var(--secondary-dark), var(--primary-dark));
            border-bottom: 3px solid var(--primary-orange);
            padding: 2rem 0;
            margin-bottom: 3rem;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-orange), #ffb347);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--text-dim);
            font-size: 1.1rem;
        }

        .breadcrumb {
            margin-bottom: 1.5rem;
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--primary-orange);
            text-decoration: none;
        }

        .story-section {
            background: var(--secondary-dark);
            border-left: 4px solid var(--primary-orange);
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 0 0.5rem 0.5rem 0;
        }

        .story-section h2 {
            color: var(--primary-orange);
            margin-bottom: 1rem;
            font-size: 1.8rem;
        }

        .story-section h3 {
            color: var(--accent-blue);
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
        }

        .story-section p {
            margin-bottom: 1rem;
            font-size: 1.05rem;
        }

        .analogy-box {
            background: rgba(33, 150, 243, 0.1);
            border: 2px solid var(--accent-blue);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .analogy-box h4 {
            color: var(--accent-blue);
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .interactive-demo {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--primary-orange);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .interactive-demo h3 {
            color: var(--primary-orange);
            margin-bottom: 1rem;
        }

        .demo-controls {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(135deg, var(--primary-orange), #ffb347);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(247, 147, 26, 0.4);
        }

        button.secondary {
            background: transparent;
            border: 2px solid var(--primary-orange);
            color: var(--primary-orange);
        }

        .demo-output {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            min-height: 100px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .demo-output:empty::before {
            content: "Output will appear here...";
            color: var(--text-dim);
            font-style: italic;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: slideIn 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .pulsing {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .aha-moment {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(33, 150, 243, 0.2));
            border: 2px solid var(--accent-green);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .aha-moment h4 {
            color: var(--accent-green);
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .comparison-card {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--accent-blue);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .comparison-card h5 {
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        .highlight {
            color: var(--primary-orange);
            font-weight: 600;
        }

        .ledger-entry {
            background: rgba(247, 147, 26, 0.1);
            border-left: 3px solid var(--primary-orange);
            padding: 0.75rem;
            margin: 0.5rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--secondary-dark);
        }

        .nav-button {
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }

        .stamp-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stamp {
            background: rgba(247, 147, 26, 0.2);
            border: 2px solid var(--primary-orange);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stamp:hover {
            background: rgba(247, 147, 26, 0.3);
            transform: scale(1.05);
        }

        .stamp.used {
            opacity: 0.4;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2rem;
            }
        }
    </style>
    <script src="/js/subdomain-access-control.js"></script>
    <script src="/js/module-gate-subdomain.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <div class="breadcrumb">
                <a href="../../../index.html">Home</a> ‚Üí
                <a href="../../curious/index.html">The Curious Path</a> ‚Üí
                <a href="../stage-1/index.html">Stage 1</a> ‚Üí
                Module 4
            </div>
            <h1>üß≠ Building Digital Trust</h1>
            <p class="subtitle">Understanding the Machine Behind the Magic (Without the Technical Jargon)</p>
        </div>
    </header>

    <main class="container">
        <!-- Bridge from Module 3 -->
        <div class="story-section">
            <h2>From WHAT and WHY to HOW</h2>
            <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 1.5rem;">
                In Module 3, you learned <strong style="color: var(--accent-green);">WHAT Bitcoin fixes</strong> (the three leaks)
                and <strong style="color: var(--accent-green);">WHY it matters</strong> (sealed time capsule for your work).
            </p>
            <p style="font-size: 1.15rem; color: var(--primary-orange); font-weight: 600; margin-bottom: 2rem;">
                Now you're ready to understand <strong>HOW it works</strong> ‚Äî the machine behind the magic.
            </p>

            <div style="background: rgba(33, 150, 243, 0.1); border: 2px solid var(--accent-blue); border-radius: 0.75rem; padding: 1.5rem; margin: 2rem 0;">
                <h3 style="color: var(--accent-blue); margin-bottom: 1rem;">üìö About the Jargon...</h3>
                <p style="margin-bottom: 1rem;">
                    Bitcoin has its own vocabulary: <em>private keys, blockchain, mining, proof of work, nodes...</em>
                    These terms might sound intimidating now, <strong>but we'll start slowly</strong>.
                </p>
                <p style="margin: 0;">
                    We'll use simple analogies you already understand ‚Äî stamps, notebooks, pages, and puzzles ‚Äî to build up each concept gradually.
                    <strong style="color: var(--accent-blue);">By the time we dive into the technical explanations later,
                    these terms will feel like old friends.</strong>
                </p>
            </div>

            <p style="margin-top: 2rem;">
                Let's start by connecting what you've already learned to the technology that makes it possible.
            </p>
        </div>

        <!-- Warm-Up Activity -->
        <div class="story-section">
            <h2>üß© Interactive Challenge: Connect the Dots</h2>
            <p style="margin-bottom: 1.5rem;">
                You saw the three leaks in Module 2 and how Bitcoin seals them in Module 3.
                Now let's connect each leak to the specific technology that fixes it.
            </p>

            <div class="interactive-demo">
                <h3 style="margin-bottom: 1rem;">üéÆ Match Leaks to Solutions</h3>
                <p style="color: var(--text-dim); margin-bottom: 1.5rem; font-size: 0.95rem;">
                    Click a card to flip it, then find its matching pair. Each correct match reveals how the technology works!
                </p>

                <div id="progress-tracker" style="text-align: center; margin-bottom: 1.5rem; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 0.75rem;">
                    <div style="display: flex; justify-content: center; gap: 1rem; margin-bottom: 0.5rem;">
                        <span id="match-1" class="match-dot">‚óè</span>
                        <span id="match-2" class="match-dot">‚óè</span>
                        <span id="match-3" class="match-dot">‚óè</span>
                        <span id="match-4" class="match-dot">‚óè</span>
                        <span id="match-5" class="match-dot">‚óè</span>
                    </div>
                    <p id="progress-text" style="margin: 0; font-size: 0.9rem; color: var(--accent-blue); font-weight: 600;">
                        0 / 5 Connections Made
                    </p>
                </div>

                <div id="card-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 2rem 0;">
                    <!-- Problem Cards -->
                    <div class="match-card" data-id="inflation" data-type="problem" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Leak #1</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">üíß</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Inflation</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">Your savings lose value over time</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="fixed-supply" data-type="solution" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Fix #1</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">üíé</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Fixed Supply</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">Only 21 million Bitcoin, forever</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="centralization" data-type="problem" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Leak #2</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">üîß</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Centralization</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">A few control the money supply</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="shared-ledger" data-type="solution" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Fix #2</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">üìñ</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Shared Ledger</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">Everyone has a copy, no single authority</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="control" data-type="problem" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Leak #3</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">üö´</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Control</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">They can freeze or block your money</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="true-ownership" data-type="solution" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Fix #3</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">üîê</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">True Ownership</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">You control your keys, you control your Bitcoin</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="downtime" data-type="problem" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Problem #4</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">‚è∞</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Downtime</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">Banks close, servers crash</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="always-on" data-type="solution" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Fix #4</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">‚ö°</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Always On</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">Network runs 24/7/365, no holidays</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="corruption" data-type="problem" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Problem #5</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">‚ö†Ô∏è</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Corruption</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">Insiders can cheat the system</p>
                            </div>
                        </div>
                    </div>

                    <div class="match-card" data-id="proof-of-work" data-type="solution" onclick="flipCard(this)">
                        <div class="card-inner">
                            <div class="card-front">
                                <div style="font-size: 3rem;">‚ùì</div>
                                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Fix #5</p>
                            </div>
                            <div class="card-back">
                                <div style="font-size: 2.5rem;">‚õèÔ∏è</div>
                                <strong style="display: block; margin: 0.5rem 0; font-size: 0.95rem;">Proof of Work</strong>
                                <p style="font-size: 0.75rem; color: var(--text-dim); margin: 0;">Cheating costs more than honesty</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="match-feedback" style="min-height: 100px; margin-top: 2rem;"></div>

                <div id="completion-message" style="display: none; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border: 2px solid var(--accent-green); border-radius: 1rem; padding: 2rem; text-align: center; margin-top: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üéâ</div>
                    <h3 style="color: var(--accent-green); margin-bottom: 1rem;">Perfect! All Connections Complete!</h3>
                    <p style="margin: 0; font-size: 1.05rem;">
                        You've mapped every problem to its Bitcoin solution. Now let's dive deep into <strong>how</strong> each one actually works!
                    </p>
                </div>
            </div>

            <style>
                .match-dot {
                    font-size: 1.5rem;
                    color: var(--text-dim);
                    transition: all 0.5s ease;
                }

                .match-dot.matched {
                    color: var(--accent-green);
                    transform: scale(1.3);
                    filter: drop-shadow(0 0 8px rgba(76, 175, 80, 0.6));
                }

                .match-card {
                    perspective: 1000px;
                    cursor: pointer;
                    min-height: 180px;
                }

                .card-inner {
                    position: relative;
                    width: 100%;
                    height: 100%;
                    min-height: 180px;
                    transition: transform 0.6s;
                    transform-style: preserve-3d;
                }

                .match-card.flipped .card-inner {
                    transform: rotateY(180deg);
                }

                .card-front, .card-back {
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    min-height: 180px;
                    backface-visibility: hidden;
                    border-radius: 0.75rem;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 1.5rem;
                    text-align: center;
                }

                .card-front {
                    background: var(--secondary-dark);
                    border: 2px solid var(--border-color);
                }

                .card-back {
                    background: var(--secondary-dark);
                    border: 2px solid var(--primary-orange);
                    transform: rotateY(180deg);
                }

                .match-card.matched {
                    opacity: 0.6;
                    pointer-events: none;
                }

                .match-card.matched .card-back {
                    border-color: var(--accent-green);
                    background: rgba(76, 175, 80, 0.1);
                }

                .match-card.selected .card-back {
                    border-color: var(--accent-blue);
                    border-width: 3px;
                    box-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
                }

                @media (max-width: 768px) {
                    #card-grid {
                        grid-template-columns: repeat(2, 1fr);
                    }

                    .card-front, .card-back {
                        min-height: 150px;
                        padding: 1rem;
                    }
                }
            </style>
        </div>

        <!-- Chapter 1: Secret Stamps -->
        <div class="story-section">
            <h2>Chapter 1: The Secret Stamp System</h2>

            <h3>üí≠ If anyone can copy your signature, how can you prove it's really you?</h3>
            <p>
                Imagine handing someone a signed check. They smile, but later claim: <em>"This signature looks fake. I don't trust it."</em>
                In the physical world, signatures can be forged. We need something <strong>impossible to fake</strong>.
            </p>
            <p>
                What if you had a <span class="highlight">secret stamp</span> that only you possess ‚Äî one so unique that everyone can verify it came from you, but nobody can copy it?
            </p>

            <div class="analogy-box">
                <h4>üîè The Secret Stamp Analogy</h4>
                <p>
                    Imagine you have a one-of-a-kind stamp only you own. You keep this stamp locked in a safe that only you can access.
                    This is your <strong>secret stamp</strong>.
                </p>
                <p>
                    You also have a <strong>public mailbox</strong> where anyone can send you letters. The address on this mailbox
                    is derived from your stamp's pattern‚Äîbut knowing the mailbox address doesn't help anyone recreate your stamp!
                </p>
                <p>
                    When you want to send money, you stamp the transaction with your secret stamp. Everyone can see the stamp mark
                    and verify it came from your mailbox, but nobody can forge your stamp because they don't have access to it.
                </p>
            </div>

            <div class="interactive-demo">
                <h3>üéÆ Experiment: Can you forge someone's secret stamp?</h3>
                <p>You have your own secret stamp. Watch how it creates a unique signature that only you can make ‚Äî but everyone can verify.</p>

                <div class="demo-controls">
                    <input type="text" id="recipient" placeholder="Send to..." value="Alice" style="padding: 0.75rem; flex: 1; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 0.5rem;">
                    <input type="number" id="amount" placeholder="Amount" value="10" min="1" style="padding: 0.75rem; width: 100px; background: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 0.5rem;">
                    <button onclick="stampTransaction()">üîè Use Secret Stamp</button>
                </div>

                <div id="stamp-output" class="demo-output"></div>
            </div>

            <div class="aha-moment">
                <h4>üí° Aha! Moment</h4>
                <p>
                    When you hear <strong>"private key"</strong> or <strong>"public address"</strong>,
                    just think: <em>your secret stamp and your public mailbox</em>.
                </p>
            </div>
        </div>

        <!-- Chapter 2: The Shared Ledger -->
        <div class="story-section">
            <h2>Chapter 2: The Town's Shared Ledger Book</h2>

            <h3>üí≠ What if you send me money and I claim I never got it ‚Äî who's right?</h3>
            <p>
                In the old system, one bank keeps the records. But what if the bank makes a mistake? What if it lies?
                What if we don't want to trust <em>anyone</em> to keep the books?
            </p>
            <p>
                Here's a wild idea: <strong>What if everyone in town kept the exact same records?</strong>
                If Alice tries to cheat, hundreds of people will catch her instantly.
            </p>

            <div class="analogy-box">
                <h4>üìñ The Shared Ledger Analogy</h4>
                <p>
                    Imagine a town where everyone has the same notebook. Whenever someone spends money, everyone updates their copy together.
                </p>
                <p>
                    When Alice sends Bob 10 coins:
                </p>
                <ol style="margin-left: 2rem; margin-top: 1rem;">
                    <li>Alice announces: "I'm sending Bob 10 coins" (and stamps it with her secret stamp)</li>
                    <li>Everyone checks: "Does Alice have 10 coins? Is the stamp real?"</li>
                    <li>If yes, everyone writes it in their ledger: "Alice ‚Üí Bob: 10 coins"</li>
                </ol>
                <p style="margin-top: 1rem;">
                    Now, if Alice tries to spend the same 10 coins again, everyone will see: "Wait, you already sent those coins to Bob!"
                    The shared ledger prevents cheating because <strong>everyone is watching</strong>.
                </p>
            </div>

            <div class="interactive-demo">
                <h3>üéÆ Experiment: Can Alice spend the same coins twice?</h3>
                <p>Alice has 50 coins. Watch what happens when she tries to cheat the system by spending the same money to two different people.</p>

                <div class="demo-controls">
                    <button onclick="addValidTransaction()">‚úÖ Send 10 Coins (Valid)</button>
                    <button onclick="tryDoubleSpend()">‚ùå Try to Spend Same Coins Again</button>
                    <button onclick="resetLedger()">üîÑ Reset</button>
                </div>

                <div id="ledger-output" class="demo-output">
                    <div style="color: var(--text-dim);">Ledger will appear here...</div>
                </div>
            </div>

            <div class="aha-moment">
                <h4>üí° Aha! Moment</h4>
                <p>
                    When you hear <strong>"blockchain"</strong>, remember: it's just a fancy name for this shared ledger book!
                    Everyone has a copy, every transaction is recorded, and no one can cheat because everyone is watching.
                </p>
            </div>
        </div>

        <!-- Chapter 3: Linking Pages -->
        <div class="story-section">
            <h2>Chapter 3: The Unbreakable Page Chain</h2>

            <h3>üí≠ What if someone finds an old page and changes one number ‚Äî would anyone notice?</h3>
            <p>
                Our shared ledger is great, but there's a problem: What if someone sneaks into the archive and quietly changes Page 1?
                They could erase a debt, add fake transactions, rewrite history!
            </p>
            <p>
                We need pages to be <strong>locked together</strong> ‚Äî like a chain where touching one link breaks the entire thing.
                But how do you link pages made of paper?
            </p>

            <div class="analogy-box">
                <h4>üîó The Page Chain Analogy</h4>
                <p>
                    Imagine each page leaves a <strong>unique mark</strong> based on everything written on it ‚Äî like a digital thumbprint.
                    Page 2 includes Page 1's mark at the top. Page 3 includes Page 2's mark. And so on.
                </p>
                <p>
                    Now, if someone tries to change Page 1, its mark changes. But wait‚ÄîPage 2 has the OLD mark written on it!
                    The chain is broken. It's like if someone changed an old receipt ‚Äî everyone would instantly see the mismatch.
                </p>
                <p>
                    To successfully cheat, you'd have to rewrite Page 1, then recalculate Page 2's mark, then Page 3's,
                    then Page 4's... all the way to the current page. And you'd have to do this faster than the entire town
                    is adding new pages. <strong>Impossible!</strong>
                </p>
            </div>

            <div class="interactive-demo">
                <h3>üéÆ Experiment: What happens if you change Page 1?</h3>
                <p>Build a chain of pages, then try tampering with an old one. Can you get away with it?</p>

                <div class="demo-controls">
                    <button onclick="addPage()">‚ûï Add New Page</button>
                    <button onclick="tamperPage()">üî® Try to Change Page 1</button>
                    <button onclick="resetChain()">üîÑ Reset</button>
                </div>

                <div id="chain-output" class="demo-output"></div>
            </div>

            <div class="aha-moment">
                <h4>üí° Aha! Moment</h4>
                <p>
                    When you hear <strong>"hash"</strong> or <strong>"Merkle tree"</strong>, remember:
                    it's just the unique marking system! These marks link pages together, making the ledger unbreakable.
                </p>
            </div>
        </div>

        <!-- Chapter 4: The Town Competition -->
        <div class="story-section">
            <h2>Chapter 4: The Town Competition</h2>

            <h3>üí≠ If everyone could add pages at once, what chaos would follow?</h3>
            <p>
                Picture this: Ten townspeople all try to write Page 5 at the same time. Each adds different transactions.
                Now we have ten conflicting versions! <em>Which one is the real Page 5?</em>
            </p>
            <p>
                We need a <strong>fair way to choose who writes the next page</strong> ‚Äî one that requires real work,
                but anyone can win. No favoritism, no corruption, just pure effort.
            </p>

            <div class="analogy-box">
                <h4>üèÜ The Competition Analogy</h4>
                <p>
                    Every 10 minutes, the town holds a <strong>puzzle-solving competition</strong>. Here's how it works:
                </p>
                <ul style="margin-left: 2rem; margin-top: 1rem;">
                    <li><strong>The Puzzle:</strong> "Find a number that makes this page's unique mark start with five zeros"</li>
                    <li><strong>The Work:</strong> Competitors try random numbers: 1, 2, 3, 4... until someone finds it</li>
                    <li><strong>The Winner:</strong> First person to solve it gets to add the page AND earns a reward. The winner shows the answer ‚Äî everyone can check instantly if it works</li>
                </ul>
                <p style="margin-top: 1rem;">
                    This competition requires real work (trying millions of numbers), but cheating is impossible.
                    You can't fake the solution‚Äîit either creates the right pattern or it doesn't.
                </p>
            </div>

            <div class="interactive-demo">
                <h3>üéÆ Experiment: Who wins the race to add the next page?</h3>
                <p>Five townspeople compete to find the right number. Watch them try hundreds of guesses ‚Äî only one will succeed!</p>

                <div class="demo-controls">
                    <button onclick="startCompetition()">üèÅ Start Competition</button>
                    <button onclick="stopCompetition()">‚èπÔ∏è Stop</button>
                </div>

                <div id="competition-output" class="demo-output"></div>
            </div>

            <div class="aha-moment">
                <h4>üí° Aha! Moment</h4>
                <p>
                    When you hear <strong>"mining"</strong> or <strong>"proof of work"</strong>, remember:
                    it's just the puzzle-solving competition! Miners are the townspeople competing to add the next page.
                    The work proves they put in effort, making attacks expensive.
                </p>
            </div>
        </div>

        <!-- Chapter 5: No Central Authority -->
        <div class="story-section">
            <h2>Chapter 5: The Town Runs Itself</h2>

            <h3>üí° Wait... if there's no mayor, no bank, no boss ‚Äî how does it not fall apart?</h3>
            <p>
                This is the moment it clicks. Our little town doesn't need anyone in charge. Why?
                Because the <strong>rules we built make cheating impossible and honesty automatic</strong>.
            </p>
            <p>
                Let's review what we created:
            </p>

            <div class="analogy-box">
                <h4>üèõÔ∏è The Self-Governing System</h4>
                <div style="margin-top: 1rem;">
                    <div class="ledger-entry">
                        <strong>1. Secret Stamps</strong> prevent impersonation<br>
                        <em>You can't spend someone else's money without their stamp</em>
                    </div>
                    <div class="ledger-entry">
                        <strong>2. Shared Ledger</strong> prevents double-spending<br>
                        <em>Everyone sees if you try to spend the same coins twice</em>
                    </div>
                    <div class="ledger-entry">
                        <strong>3. Page Chains</strong> prevent history rewrites<br>
                        <em>Tampering with old pages breaks the fingerprint chain</em>
                    </div>
                    <div class="ledger-entry">
                        <strong>4. Competition</strong> prevents takeover<br>
                        <em>Adding pages requires real work; cheating costs more than it's worth</em>
                    </div>
                </div>
                <p style="margin-top: 1.5rem;">
                    The result? A system where trust comes from <strong>mathematics and incentives</strong>, not from trusting people.
                    No one can freeze your account. No one can quietly change the rules.
                </p>
            </div>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <h5>Traditional Bank</h5>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--text-dim);">
                        <li>Bank keeps the ledger</li>
                        <li>Bank verifies transactions</li>
                        <li>Bank can freeze accounts</li>
                        <li>Bank hours: 9am-5pm</li>
                        <li>You trust the bank</li>
                    </ul>
                </div>
                <div class="comparison-card">
                    <h5>Bitcoin (Our Town System)</h5>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--accent-green);">
                        <li>Everyone keeps the ledger</li>
                        <li>Everyone verifies transactions</li>
                        <li>Nobody can freeze accounts</li>
                        <li>Open 24/7/365</li>
                        <li>You trust mathematics</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Recap Table -->
        <div class="story-section">
            <h2>üìä Recap: From Problems to Solutions</h2>
            <p style="margin-bottom: 1.5rem;">
                Let's connect everything you've learned. Here's how each problem from Module 3 maps to the solution you built in this module:
            </p>

            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.3); border-radius: 0.5rem; overflow: hidden;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, rgba(247, 147, 26, 0.3), rgba(76, 175, 80, 0.3));">
                            <th style="padding: 1rem; text-align: left; color: var(--primary-orange); font-size: 1.05rem; border-bottom: 2px solid var(--primary-orange);">
                                Problem (Module 3)
                            </th>
                            <th style="padding: 1rem; text-align: left; color: var(--accent-green); font-size: 1.05rem; border-bottom: 2px solid var(--accent-green);">
                                How Bitcoin Solves It (Module 4)
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--primary-orange);">üí∏ Inflation</strong><br>
                                <span style="color: var(--text-dim); font-size: 0.9rem;">Money loses value as more is printed</span>
                            </td>
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--accent-green);">üíé Fixed Supply (21M coins)</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">No one can print more Bitcoin ‚Äî the rules are locked in code</span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--primary-orange);">üèõÔ∏è Centralization</strong><br>
                                <span style="color: var(--text-dim); font-size: 0.9rem;">One authority controls everything</span>
                            </td>
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--accent-green);">üìñ Shared Ledger</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Everyone keeps the same records ‚Äî no single point of control</span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--primary-orange);">üîí Control</strong><br>
                                <span style="color: var(--text-dim); font-size: 0.9rem;">Accounts can be frozen or seized</span>
                            </td>
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--accent-green);">üîê True Ownership (Secret Stamps)</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Your private key = full control. Nobody can freeze what only you can unlock</span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--primary-orange);">‚è∞ Downtime</strong><br>
                                <span style="color: var(--text-dim); font-size: 0.9rem;">Banks close; systems go offline</span>
                            </td>
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--accent-green);">‚ö° Always On (Global Network)</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Bitcoin runs 24/7/365 across thousands of computers worldwide</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--primary-orange);">‚ö†Ô∏è Corruption</strong><br>
                                <span style="color: var(--text-dim); font-size: 0.9rem;">Human manipulation changes the rules</span>
                            </td>
                            <td style="padding: 1rem; vertical-align: top;">
                                <strong style="color: var(--accent-green);">‚õèÔ∏è Proof of Work (Competition)</strong><br>
                                <span style="color: var(--text-light); font-size: 0.9rem;">Cheating costs more than it's worth ‚Äî honest work is always rewarded</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(247, 147, 26, 0.15)); border: 2px solid var(--accent-blue); border-radius: 0.5rem;">
                <strong style="color: var(--accent-blue); font-size: 1.1rem;">üí° The Pattern:</strong><br>
                <p style="margin-top: 0.75rem; color: var(--text-light);">
                    Every broken system you learned about in Module 3 has a matching technical solution you built in Module 4.
                    Bitcoin didn't just fix one problem ‚Äî it redesigned the entire foundation.
                </p>
            </div>
        </div>

        <!-- Final Aha Moment -->
        <div class="story-section">
            <h2>üéØ Bringing It All Together</h2>

            <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(247, 147, 26, 0.2), rgba(76, 175, 80, 0.2)); border-radius: 0.5rem; margin-bottom: 2rem;">
                <h3 style="font-size: 1.5rem; color: var(--accent-green); margin-bottom: 0.5rem;">‚ú® You Did It!</h3>
                <p style="font-size: 1.1rem; color: var(--text-light);">
                    You've already rebuilt Bitcoin with your imagination.<br>The rest is just names and code.
                </p>
            </div>

            <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">
                Let's connect our simple town system to Bitcoin's technical terms:
            </p>

            <div class="comparison-grid">
                <div class="comparison-card" style="border-color: var(--primary-orange);">
                    <h5>üèòÔ∏è What We Called It</h5>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Secret Stamp</li>
                        <li>Public Mailbox</li>
                        <li>Shared Ledger Book</li>
                        <li>Unique Marks</li>
                        <li>Page Chains</li>
                        <li>Puzzle Competition</li>
                        <li>Townspeople</li>
                        <li>Winner's Reward</li>
                    </ul>
                </div>
                <div class="comparison-card" style="border-color: var(--accent-green);">
                    <h5>‚Çø Bitcoin's Technical Name</h5>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem; color: var(--accent-green);">
                        <li>Private Key</li>
                        <li>Public Address</li>
                        <li>Blockchain</li>
                        <li>Cryptographic Hash</li>
                        <li>Hash Pointers</li>
                        <li>Proof of Work / Mining</li>
                        <li>Network Nodes</li>
                        <li>Block Reward</li>
                    </ul>
                </div>
            </div>

            <p style="margin-top: 2rem; font-size: 1.1rem;">
                <strong>Congratulations. You just reinvented Bitcoin.</strong> The technical terms are just fancy names
                for simple ideas you now grasp completely.
            </p>

            <p style="margin-top: 1rem;">
                When you see words like "SHA-256," "ECDSA," or "Merkle root," you'll think:
                <em>"Oh, that's just a more specific way to create those unique marks we talked about!"</em>
            </p>
        </div>

        <!-- Completion Section -->
        <div class="story-section" style="text-align: center; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(33, 150, 243, 0.2)); border-color: var(--accent-green);">
            <h2 style="color: var(--accent-green);">üéâ Ready to Move Forward?</h2>
            <p style="font-size: 1.1rem; margin: 1.5rem 0;">
                You now understand HOW Bitcoin works using simple analogies. Ready to dive into the technical details?
            </p>
            <button onclick="completeModule()" id="complete-btn" style="font-size: 1.1rem; padding: 1rem 2rem; margin: 1rem 0;">
                ‚úÖ Mark Complete & Continue to Stage 2
            </button>
            <div id="completion-message" style="margin-top: 1rem; color: var(--accent-green); font-weight: 600;"></div>
        </div>

        <!-- Final Reflection -->
        <div class="story-section">
            <h2>ü§î Final Reflection</h2>
            <div style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.15), rgba(33, 150, 243, 0.15)); border: 2px solid var(--accent-purple); border-radius: 0.5rem; padding: 2rem; margin: 1.5rem 0;">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem;">üí≠</div>
                    <p style="font-size: 1.2rem; color: var(--text-light); line-height: 1.7; font-weight: 500;">
                        If trust now comes from <strong style="color: var(--accent-purple);">math</strong> instead of <strong style="color: var(--primary-orange);">people</strong>, what else could we rebuild this way?
                    </p>
                </div>

                <div style="background: rgba(0,0,0,0.3); border-radius: 0.5rem; padding: 1.5rem; margin-top: 1.5rem;">
                    <p style="color: var(--text-dim); font-size: 0.95rem; line-height: 1.7; margin-bottom: 1rem;">
                        Think about it:
                    </p>
                    <ul style="color: var(--text-light); line-height: 2; margin-left: 2rem;">
                        <li>Could we build voting systems where results can't be manipulated?</li>
                        <li>Could we create contracts that execute automatically when conditions are met?</li>
                        <li>Could we design organizations that run without CEOs or boards?</li>
                        <li>Could we store medical records where <em>you</em> control who sees them?</li>
                    </ul>
                    <p style="color: var(--accent-blue); margin-top: 1.5rem; font-style: italic; text-align: center; font-size: 1.05rem;">
                        Bitcoin proved that we can replace trust in institutions with trust in mathematics.<br>
                        What you do with that knowledge is up to you.
                    </p>
                </div>
            </div>
        </div>

        <!-- Optional Challenge Section -->
        <div class="story-section" style="background: linear-gradient(135deg, rgba(255, 68, 68, 0.1), rgba(247, 147, 26, 0.1)); border-color: #ff4444;">
            <h2 style="color: #ff4444;">üî• Optional Challenge: Can You Break the System?</h2>
            <p style="margin-bottom: 1.5rem;">
                Think you understand how Bitcoin protects itself? Let's put your knowledge to the test!
                Try these attack scenarios and see what happens:
            </p>

            <div class="interactive-demo">
                <h3>‚öîÔ∏è Choose Your Attack</h3>
                <p style="margin-bottom: 1.5rem; color: var(--text-dim);">
                    Select an attack strategy and watch as Bitcoin's defense mechanisms activate:
                </p>

                <div style="display: grid; gap: 1rem; margin-bottom: 1.5rem;">
                    <button onclick="attemptDoubleSpendAttack()" style="background: transparent; border: 2px solid #ff4444; color: #ff4444; text-align: left; padding: 1rem; border-radius: 0.5rem;">
                        <strong style="font-size: 1.05rem;">üí∏ Double-Spend Attack</strong><br>
                        <span style="font-size: 0.85rem; color: var(--text-dim);">Try to spend the same Bitcoin twice simultaneously</span>
                    </button>

                    <button onclick="attemptHistoryRewrite()" style="background: transparent; border: 2px solid #ff4444; color: #ff4444; text-align: left; padding: 1rem; border-radius: 0.5rem;">
                        <strong style="font-size: 1.05rem;">üìù History Rewrite Attack</strong><br>
                        <span style="font-size: 0.85rem; color: var(--text-dim);">Change an old transaction and see what happens to the chain</span>
                    </button>

                    <button onclick="attempt51PercentAttack()" style="background: transparent; border: 2px solid #ff4444; color: #ff4444; text-align: left; padding: 1rem; border-radius: 0.5rem;">
                        <strong style="font-size: 1.05rem;">‚ö° 51% Attack</strong><br>
                        <span style="font-size: 0.85rem; color: var(--text-dim);">What if you controlled more mining power than everyone else combined?</span>
                    </button>

                    <button onclick="attemptFakeStampAttack()" style="background: transparent; border: 2px solid #ff4444; color: #ff4444; text-align: left; padding: 1rem; border-radius: 0.5rem;">
                        <strong style="font-size: 1.05rem;">üîè Fake Stamp Attack</strong><br>
                        <span style="font-size: 0.85rem; color: var(--text-dim);">Try to forge someone else's secret stamp signature</span>
                    </button>
                </div>

                <div id="challenge-output" class="demo-output"></div>
            </div>

            <div style="background: rgba(33, 150, 243, 0.1); border: 2px solid var(--accent-blue); border-radius: 0.5rem; padding: 1.5rem; margin-top: 2rem;">
                <strong style="color: var(--accent-blue); font-size: 1.05rem;">üéì Learning Point:</strong>
                <p style="color: var(--text-light); margin-top: 0.75rem; line-height: 1.7;">
                    Bitcoin isn't "unhackable" because it's complicated ‚Äî it's secure because the <strong>economic cost of cheating</strong>
                    exceeds the potential reward. Every attack you just tried would require massive resources, and even if you succeeded,
                    you'd destroy the value of what you stole. The system makes honesty the most profitable strategy.
                </p>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <a href="module-3.html" class="nav-button secondary">‚Üê Previous: Enter Bitcoin</a>
            <a href="../stage-2/module-1.html" class="nav-button" id="next-btn" style="background: var(--primary-orange); color: white;">Next: Stage 2 - How Bitcoin Works ‚Üí</a>
        </div>
    </main>

    <script>
        // Card Matching Game Logic
        let flippedCards = [];
        let matchedPairs = 0;
        const correctPairs = {
            'inflation': 'fixed-supply',
            'centralization': 'shared-ledger',
            'control': 'true-ownership',
            'downtime': 'always-on',
            'corruption': 'proof-of-work'
        };

        const matchExplanations = {
            'inflation-fixed-supply': {
                problem: 'Inflation',
                solution: 'Fixed Supply',
                explanation: 'Bitcoin has exactly 21 million coins that will ever exist ‚Äî no more can be created. This mathematical scarcity prevents inflation and protects your savings from being devalued by money printing.'
            },
            'centralization-shared-ledger': {
                problem: 'Centralization',
                solution: 'Shared Ledger (Blockchain)',
                explanation: 'Instead of one bank controlling the ledger, thousands of computers worldwide each keep an identical copy. No single authority can manipulate the records ‚Äî everyone can verify everything.'
            },
            'control-true-ownership': {
                problem: 'Control/Censorship',
                solution: 'True Ownership (Private Keys)',
                explanation: 'You hold the cryptographic keys that prove ownership. No bank can freeze your account. No government can seize your Bitcoin without your keys. You are truly the owner.'
            },
            'downtime-always-on': {
                problem: 'Downtime',
                solution: 'Always On Network',
                explanation: 'The Bitcoin network runs on thousands of computers globally, 24/7/365. No holidays, no maintenance windows, no "server down" messages. The network never sleeps.'
            },
            'corruption-proof-of-work': {
                problem: 'Corruption',
                solution: 'Proof of Work (Mining)',
                explanation: 'To add transactions, miners must solve expensive computational puzzles. Cheating would cost billions in electricity and hardware ‚Äî far more than the reward. Honesty is enforced by economics, not trust.'
            }
        };

        function flipCard(card) {
            // Don't flip if already matched or processing
            if (card.classList.contains('matched') || flippedCards.length === 2) {
                return;
            }

            // Flip the card
            card.classList.add('flipped');

            // Get card data
            const cardId = card.getAttribute('data-id');
            const cardType = card.getAttribute('data-type');

            // Add to flipped cards
            flippedCards.push({element: card, id: cardId, type: cardType});

            // If two cards are flipped, check for match
            if (flippedCards.length === 2) {
                setTimeout(() => checkForMatch(), 600);
            }
        }

        function checkForMatch() {
            const [card1, card2] = flippedCards;

            // Make sure we have one problem and one solution
            if (card1.type === card2.type) {
                // Both same type - not a valid pair
                showFeedback('error', '‚ùå You need to match a leak with its fix!');
                setTimeout(() => {
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                    flippedCards = [];
                }, 1200);
                return;
            }

            // Determine which is problem and which is solution
            const problem = card1.type === 'problem' ? card1 : card2;
            const solution = card1.type === 'solution' ? card1 : card2;

            // Check if they match
            if (correctPairs[problem.id] === solution.id) {
                // Correct match!
                card1.element.classList.add('matched');
                card2.element.classList.add('matched');

                matchedPairs++;
                updateProgress();

                const matchKey = `${problem.id}-${solution.id}`;
                showMatchExplanation(matchExplanations[matchKey]);

                // Check if all complete
                if (matchedPairs === 5) {
                    setTimeout(() => {
                        document.getElementById('completion-message').style.display = 'block';
                        document.getElementById('completion-message').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 1500);
                }
            } else {
                // Incorrect match
                showFeedback('error', `‚ùå Not quite! These don't match.`);

                // Unflip after showing feedback
                setTimeout(() => {
                    card1.element.classList.remove('flipped');
                    card2.element.classList.remove('flipped');
                }, 1500);
            }

            flippedCards = [];
        }

        function updateProgress() {
            document.getElementById('progress-text').textContent = `${matchedPairs} / 5 Connections Made`;

            // Light up progress dots
            for (let i = 1; i <= matchedPairs; i++) {
                document.getElementById(`match-${i}`).classList.add('matched');
            }
        }

        function showMatchExplanation(match) {
            const feedback = document.getElementById('match-feedback');
            feedback.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.05)); border: 2px solid var(--accent-green); border-radius: 1rem; padding: 2rem; animation: slideIn 0.5s ease;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <div style="font-size: 2.5rem;">‚úÖ</div>
                        <div>
                            <h4 style="color: var(--accent-green); margin: 0 0 0.25rem 0; font-size: 1.2rem;">Perfect Match!</h4>
                            <p style="margin: 0; color: var(--text-dim); font-size: 0.9rem;">
                                <strong>${match.problem}</strong> ‚Üí <strong>${match.solution}</strong>
                            </p>
                        </div>
                    </div>
                    <p style="margin: 0; font-size: 1.05rem; line-height: 1.7; color: var(--text-light);">
                        ${match.explanation}
                    </p>
                </div>
            `;

            feedback.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function showFeedback(type, message) {
            const feedback = document.getElementById('match-feedback');
            const color = type === 'error' ? '#ff4444' : 'var(--accent-green)';
            const bgColor = type === 'error' ? 'rgba(255, 68, 68, 0.15)' : 'rgba(76, 175, 80, 0.15)';

            feedback.innerHTML = `
                <div style="background: ${bgColor}; border: 2px solid ${color}; border-radius: 0.75rem; padding: 1.5rem; text-align: center;">
                    <p style="margin: 0; color: ${color}; font-weight: 600; font-size: 1.05rem;">
                        ${message}
                    </p>
                </div>
            `;

            if (type === 'error') {
                setTimeout(() => {
                    feedback.innerHTML = '';
                }, 2000);
            }
        }

        // Add CSS animation for slide-in effect
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);

        // Secret Stamp Demo
        let stampUsed = false;
        let stampCount = 0;

        function stampTransaction() {
            const recipient = document.getElementById('recipient').value.trim() || 'Alice';
            const amount = parseInt(document.getElementById('amount').value) || 10;
            const output = document.getElementById('stamp-output');

            if (amount <= 0) {
                output.innerHTML = `<div style="color: #ff4444; font-weight: 600;">‚ùå Amount must be greater than 0!</div>`;
                return;
            }

            stampCount++;
            const stamp = 'üîè STAMP-' + Math.random().toString(36).substring(2, 10).toUpperCase();
            const mailbox = 'MB-' + stamp.substring(7, 13);

            output.className = 'demo-output animate-in';
            output.innerHTML = `
                <div style="color: var(--accent-green); font-weight: 600; font-size: 1.1rem; margin-bottom: 1rem;">
                    ‚úÖ Transaction #${stampCount} Stamped Successfully!
                </div>
                <div style="padding: 1.5rem; background: linear-gradient(135deg, rgba(247, 147, 26, 0.15), rgba(76, 175, 80, 0.15)); border-radius: 0.5rem; border: 2px solid var(--primary-orange);">
                    <div style="display: grid; grid-template-columns: auto 1fr; gap: 0.75rem; margin-bottom: 1rem;">
                        <strong>From:</strong> <span>You (Secret Stamp Owner)</span>
                        <strong>To:</strong> <span>${recipient}</span>
                        <strong>Amount:</strong> <span style="color: var(--primary-orange); font-weight: 700;">${amount} coins</span>
                        <strong>Your Mailbox:</strong> <code style="color: var(--accent-blue);">${mailbox}</code>
                    </div>

                    <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                        <strong style="color: var(--primary-orange);">üîè Secret Stamp Signature:</strong><br>
                        <code style="color: var(--accent-green); word-break: break-all;">${stamp}</code>
                    </div>

                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-left: 3px solid var(--accent-blue); border-radius: 0.25rem;">
                        <strong style="color: var(--accent-blue);">‚ú® Verification Status:</strong><br>
                        <span style="color: var(--text-light);">Everyone can verify this stamp came from mailbox <code>${mailbox}</code>, but nobody can forge your secret stamp!</span>
                    </div>
                </div>
            `;

            // Scroll to output
            output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Shared Ledger Demo
        let ledger = [];
        let aliceBalance = 50;
        const bobBalance = 20;
        const carolBalance = 15;

        function addValidTransaction() {
            const output = document.getElementById('ledger-output');

            if (aliceBalance < 10) {
                output.className = 'demo-output animate-in';
                output.innerHTML = `
                    <div style="color: #ff4444; font-weight: 600; font-size: 1.1rem; padding: 1rem; background: rgba(255, 68, 68, 0.15); border-radius: 0.5rem; border: 2px solid #ff4444;">
                        ‚ùå TRANSACTION REJECTED!<br>
                        <span style="font-size: 0.9rem; margin-top: 0.5rem; display: block;">Alice only has ${aliceBalance} coins but tried to send 10 coins.</span>
                    </div>
                `;
                return;
            }

            ledger.push({
                from: 'Alice',
                to: 'Bob',
                amount: 10,
                valid: true,
                timestamp: new Date().toLocaleTimeString()
            });
            aliceBalance -= 10;

            updateLedger(`‚úÖ TRANSACTION ACCEPTED! Alice sent 10 coins to Bob.`, 'green');
        }

        function tryDoubleSpend() {
            const output = document.getElementById('ledger-output');

            if (aliceBalance < 10) {
                ledger.push({
                    from: 'Alice',
                    to: 'Carol',
                    amount: 10,
                    valid: false,
                    reason: 'Insufficient funds - tried to double-spend!',
                    timestamp: new Date().toLocaleTimeString()
                });
                updateLedger(`‚ùå DOUBLE-SPEND DETECTED! The town caught Alice trying to cheat!`, 'red');
                return;
            }

            ledger.push({
                from: 'Alice',
                to: 'Carol',
                amount: 10,
                valid: false,
                reason: 'Attempted to spend same coins twice!',
                timestamp: new Date().toLocaleTimeString()
            });
            updateLedger(`‚ùå DOUBLE-SPEND DETECTED! Everyone sees Alice already sent these coins!`, 'red');
        }

        function updateLedger(message, color) {
            const output = document.getElementById('ledger-output');
            const colorVar = color === 'green' ? 'var(--accent-green)' : '#ff4444';

            output.className = 'demo-output animate-in';

            let html = `
                <div style="color: ${colorVar}; font-weight: 600; font-size: 1.1rem; padding: 1rem; background: ${color === 'green' ? 'rgba(76, 175, 80, 0.15)' : 'rgba(255, 68, 68, 0.15)'}; border-radius: 0.5rem; border: 2px solid ${colorVar}; margin-bottom: 1rem;">
                    ${message}
                </div>

                <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                    <strong style="color: var(--accent-blue); font-size: 1.05rem;">üí∞ Current Balances:</strong>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.75rem; margin-top: 0.75rem;">
                        <div style="background: rgba(247, 147, 26, 0.1); padding: 0.75rem; border-radius: 0.25rem; text-align: center;">
                            <strong style="color: var(--primary-orange);">Alice</strong><br>
                            <span style="font-size: 1.2rem; color: var(--accent-green);">${aliceBalance}</span> coins
                        </div>
                        <div style="background: rgba(33, 150, 243, 0.1); padding: 0.75rem; border-radius: 0.25rem; text-align: center;">
                            <strong style="color: var(--accent-blue);">Bob</strong><br>
                            <span style="font-size: 1.2rem;">${bobBalance + (ledger.filter(tx => tx.to === 'Bob' && tx.valid).length * 10)}</span> coins
                        </div>
                        <div style="background: rgba(156, 39, 176, 0.1); padding: 0.75rem; border-radius: 0.25rem; text-align: center;">
                            <strong style="color: var(--accent-purple);">Carol</strong><br>
                            <span style="font-size: 1.2rem;">${carolBalance}</span> coins
                        </div>
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 0.5rem;">
                    <strong style="color: var(--primary-orange); font-size: 1.05rem;">üìñ Town Ledger (${ledger.length} entries):</strong>
                    <div style="margin-top: 1rem;">
            `;

            if (ledger.length === 0) {
                html += `<div style="color: var(--text-dim); font-style: italic; text-align: center; padding: 1rem;">No transactions yet...</div>`;
            } else {
                ledger.forEach((tx, i) => {
                    const status = tx.valid ? '‚úÖ' : '‚ùå';
                    const bgColor = tx.valid ? 'rgba(76, 175, 80, 0.1)' : 'rgba(255, 68, 68, 0.1)';
                    const borderColor = tx.valid ? 'var(--accent-green)' : '#ff4444';
                    const reason = tx.reason ? `<div style="color: #ff4444; margin-top: 0.5rem; font-size: 0.85rem;">‚ö†Ô∏è ${tx.reason}</div>` : '';

                    html += `
                        <div style="margin: 0.75rem 0; padding: 1rem; background: ${bgColor}; border-left: 4px solid ${borderColor}; border-radius: 0.25rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <strong style="color: var(--text-light);">${status} Transaction #${i + 1}</strong>
                                <code style="color: var(--text-dim); font-size: 0.75rem;">${tx.timestamp}</code>
                            </div>
                            <div style="color: var(--text-light);">
                                ${tx.from} ‚Üí ${tx.to}: <strong style="color: ${tx.valid ? 'var(--accent-green)' : '#ff4444'};">${tx.amount} coins</strong>
                            </div>
                            ${reason}
                        </div>
                    `;
                });
            }

            html += `</div></div>`;
            output.innerHTML = html;

            // Scroll to output
            output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function resetLedger() {
            ledger = [];
            aliceBalance = 50;
            const output = document.getElementById('ledger-output');
            output.className = 'demo-output';
            output.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--text-dim);">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üìñ</div>
                    <strong style="color: var(--primary-orange);">Ledger Reset</strong><br>
                    <span style="font-size: 0.9rem;">Alice starts with 50 coins. Ready to try again!</span>
                </div>
            `;
        }

        // Initialize ledger output on load
        document.addEventListener('DOMContentLoaded', () => {
            resetLedger();
        });

        // Page Chain Demo
        let pages = [];

        function addPage() {
            const pageNum = pages.length + 1;
            const prevMark = pages.length > 0 ? pages[pages.length - 1].mark : 'GENESIS-0000';
            const mark = 'MARK-' + Math.random().toString(36).substring(2, 10).toUpperCase();

            pages.push({
                num: pageNum,
                prevMark,
                mark,
                tampered: false,
                timestamp: new Date().toLocaleTimeString()
            });

            renderChain();
        }

        function tamperPage() {
            if (pages.length === 0) {
                const output = document.getElementById('chain-output');
                output.className = 'demo-output animate-in';
                output.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #ff4444;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <strong>No pages to tamper with!</strong><br>
                        <span style="font-size: 0.9rem;">Add some pages first, then try to tamper.</span>
                    </div>
                `;
                return;
            }

            pages[0].tampered = true;
            pages[0].mark = 'TAMPERED-' + Math.random().toString(36).substring(2, 8).toUpperCase();
            renderChain();
        }

        function renderChain() {
            const output = document.getElementById('chain-output');
            output.className = 'demo-output animate-in';

            if (pages.length === 0) {
                output.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--text-dim);">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">üîó</div>
                        <strong style="color: var(--primary-orange);">Chain Empty</strong><br>
                        <span style="font-size: 0.9rem;">Add pages to see how they link together!</span>
                    </div>
                `;
                return;
            }

            let html = `<div style="font-weight: 600; font-size: 1.05rem; margin-bottom: 1.5rem; color: var(--accent-blue);">üìÑ Page Chain (${pages.length} pages)</div>`;

            pages.forEach((page, i) => {
                const isValid = i === 0 || pages[i - 1].mark === page.prevMark;
                const statusColor = isValid ? 'var(--accent-green)' : '#ff4444';
                const statusText = isValid ? '‚úÖ Valid Link' : '‚ùå BROKEN CHAIN!';
                const bgColor = isValid ? 'rgba(76, 175, 80, 0.1)' : 'rgba(255, 68, 68, 0.15)';

                // Show connection arrow from previous page
                if (i > 0) {
                    const connectionValid = pages[i - 1].mark === page.prevMark;
                    html += `
                        <div style="text-align: center; margin: 0.5rem 0; color: ${connectionValid ? 'var(--accent-green)' : '#ff4444'};">
                            ${connectionValid ? '‚¨áÔ∏è Valid Link' : 'üíî Broken Link!'}<br>
                            <span style="font-size: 0.75rem; font-family: monospace;">${page.prevMark}</span>
                        </div>
                    `;
                }

                html += `
                    <div style="margin: 0.5rem 0; padding: 1.5rem; background: ${bgColor}; border: 3px solid ${statusColor}; border-radius: 0.5rem; position: relative;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <strong style="font-size: 1.1rem; color: var(--primary-orange);">üìÑ Page ${page.num}</strong>
                            <span style="color: ${statusColor}; font-weight: 600;">${statusText}</span>
                        </div>

                        ${page.tampered ? `
                            <div style="background: rgba(255, 68, 68, 0.2); border: 2px solid #ff4444; border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem;">
                                <strong style="color: #ff4444;">‚ö†Ô∏è TAMPERED!</strong><br>
                                <span style="font-size: 0.85rem;">Someone changed this page's content!</span>
                            </div>
                        ` : ''}

                        <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 0.5rem; font-family: monospace; font-size: 0.85rem;">
                            <div style="margin-bottom: 0.75rem;">
                                <strong style="color: var(--accent-blue);">Prev. Page Mark:</strong><br>
                                <code style="color: ${i === 0 ? 'var(--accent-blue)' : 'var(--text-dim)'};">${page.prevMark}</code>
                            </div>
                            <div>
                                <strong style="color: ${page.tampered ? '#ff4444' : 'var(--accent-green)'};">This Page's Mark:</strong><br>
                                <code style="color: ${page.tampered ? '#ff4444' : 'var(--accent-green)'};">${page.mark}</code>
                            </div>
                        </div>

                        <div style="margin-top: 0.75rem; text-align: right; color: var(--text-dim); font-size: 0.75rem;">
                            Added: ${page.timestamp}
                        </div>
                    </div>
                `;
            });

            output.innerHTML = html;

            // Scroll to latest page
            output.scrollTop = output.scrollHeight;
        }

        function resetChain() {
            pages = [];
            const output = document.getElementById('chain-output');
            output.className = 'demo-output';
            output.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: var(--text-dim);">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">üîó</div>
                    <strong style="color: var(--primary-orange);">Chain Reset</strong><br>
                    <span style="font-size: 0.9rem;">Ready to build a new chain!</span>
                </div>
            `;
        }

        // Competition Demo
        let competitionRunning = false;
        let attempts = 0;
        let competitionInterval = null;

        async function startCompetition() {
            if (competitionRunning) return;

            competitionRunning = true;
            attempts = 0;
            const output = document.getElementById('competition-output');
            output.className = 'demo-output animate-in';

            const target = Math.floor(Math.random() * 800) + 400; // Random between 400-1200 attempts
            const competitors = ['Alice', 'Bob', 'Carol', 'Dave', 'Eve'];
            const winner = competitors[Math.floor(Math.random() * competitors.length)];

            output.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.15), rgba(247, 147, 26, 0.15)); border: 2px solid var(--accent-blue); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="font-size: 1.1rem; font-weight: 600; color: var(--accent-blue); margin-bottom: 1rem;">
                        üèÅ Puzzle Competition Started!
                    </div>
                    <div style="color: var(--text-light); font-size: 0.9rem;">
                        <strong>${competitors.length} competitors</strong> are racing to find a number that creates a unique mark starting with <strong>000</strong>
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.3); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="margin-bottom: 0.5rem; color: var(--accent-blue); font-weight: 600;">Progress:</div>
                    <div style="background: rgba(0,0,0,0.5); height: 30px; border-radius: 15px; overflow: hidden; border: 2px solid var(--accent-blue);">
                        <div id="progress-bar" style="height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--primary-orange)); width: 0%; transition: width 0.1s linear; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.85rem;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; color: var(--text-dim); font-size: 0.85rem;">
                        <span id="attempt-count">Attempt: 0</span>
                        <span>Target: ~${target}</span>
                    </div>
                </div>

                <div id="competition-log" style="background: rgba(0,0,0,0.3); border-radius: 0.5rem; padding: 1rem; max-height: 200px; overflow-y: auto; font-size: 0.85rem;">
                    <div class="pulsing" style="color: var(--accent-blue);">‚öôÔ∏è Competitors trying numbers...</div>
                </div>
            `;

            const progressBar = document.getElementById('progress-bar');
            const attemptCount = document.getElementById('attempt-count');
            const log = document.getElementById('competition-log');

            competitionInterval = setInterval(() => {
                if (!competitionRunning) {
                    clearInterval(competitionInterval);
                    return;
                }

                attempts++;
                const progress = (attempts / target) * 100;

                progressBar.style.width = Math.min(progress, 100) + '%';
                progressBar.textContent = attempts < target ? Math.floor(progress) + '%' : '100%';
                attemptCount.textContent = `Attempt: ${attempts}`;

                if (attempts % 50 === 0 && attempts < target) {
                    const randomCompetitor = competitors[Math.floor(Math.random() * competitors.length)];
                    log.innerHTML += `<div style="color: var(--text-dim); margin: 0.25rem 0;">‚ùå ${randomCompetitor} tried ${attempts}... no match</div>`;
                    log.scrollTop = log.scrollHeight;
                }

                if (attempts >= target) {
                    clearInterval(competitionInterval);
                    competitionRunning = false;

                    progressBar.style.width = '100%';
                    progressBar.textContent = '‚úì';
                    progressBar.style.background = 'var(--accent-green)';

                    log.innerHTML += `
                        <div style="margin: 1rem 0; padding: 1.5rem; background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(247, 147, 26, 0.2)); border: 3px solid var(--accent-green); border-radius: 0.5rem; text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 0.5rem;">üèÜ</div>
                            <div style="color: var(--accent-green); font-weight: 700; font-size: 1.2rem; margin-bottom: 0.5rem;">
                                WINNER FOUND!
                            </div>
                            <div style="color: var(--text-light); margin-bottom: 1rem;">
                                <strong>${winner}</strong> solved the puzzle after <strong style="color: var(--primary-orange);">${attempts}</strong> attempts!
                            </div>
                            <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 0.5rem; font-family: monospace; font-size: 0.85rem;">
                                <strong style="color: var(--accent-blue);">Solution:</strong> <code style="color: var(--accent-green);">${attempts}</code><br>
                                <strong style="color: var(--accent-blue);">Unique Mark:</strong> <code style="color: var(--accent-green);">000${Math.random().toString(36).substring(2, 10)}</code>
                            </div>
                            <div style="margin-top: 1rem; padding: 1rem; background: rgba(33, 150, 243, 0.1); border-radius: 0.5rem; color: var(--text-light); font-size: 0.9rem;">
                                ‚ú® ${winner} gets to add the next page to the ledger and earns the reward!<br>
                                The work ${winner} put in proves no cheating occurred.
                            </div>
                        </div>
                    `;
                    log.scrollTop = log.scrollHeight;
                }
            }, 30);
        }

        function stopCompetition() {
            competitionRunning = false;
            if (competitionInterval) {
                clearInterval(competitionInterval);
                competitionInterval = null;
            }

            const output = document.getElementById('competition-output');
            const log = document.getElementById('competition-log');

            if (log) {
                log.innerHTML += `
                    <div style="color: #ff4444; font-weight: 600; margin-top: 1rem; padding: 1rem; background: rgba(255, 68, 68, 0.1); border-radius: 0.5rem; text-align: center;">
                        ‚èπÔ∏è Competition Stopped<br>
                        <span style="font-size: 0.85rem; font-weight: normal;">Total attempts: ${attempts}</span>
                    </div>
                `;
                log.scrollTop = log.scrollHeight;
            }
        }

        // Challenge Attack Scenarios
        function attemptDoubleSpendAttack() {
            const output = document.getElementById('challenge-output');
            output.className = 'demo-output animate-in';

            output.innerHTML = `
                <div style="background: rgba(255, 68, 68, 0.2); border: 2px solid #ff4444; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="font-size: 1.5rem; text-align: center; margin-bottom: 1rem;">‚öîÔ∏è</div>
                    <strong style="color: #ff4444; font-size: 1.1rem; display: block; margin-bottom: 1rem;">Attack Initiated: Double-Spend</strong>
                    <div style="color: var(--text-light); font-size: 0.9rem; line-height: 1.6;">
                        You try to send the same 10 BTC to two different people at once...
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.3); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="color: var(--accent-blue); font-weight: 600; margin-bottom: 1rem;">‚è±Ô∏è Network Response:</div>
                    <div style="font-family: monospace; font-size: 0.85rem; line-height: 1.8;">
                        <div style="color: var(--text-dim); margin: 0.5rem 0;">‚Üí Transaction 1 broadcast: Alice ‚Üí Bob (10 BTC)</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0;">‚Üí Transaction 2 broadcast: Alice ‚Üí Carol (same 10 BTC)</div>
                        <div style="color: var(--primary-orange); margin: 0.5rem 0;">‚Üí Nodes checking shared ledger...</div>
                        <div style="color: var(--accent-green); margin: 0.5rem 0;">‚Üí Transaction 1 arrives first ‚Äî ACCEPTED ‚úì</div>
                        <div style="color: #ff4444; margin: 0.5rem 0; font-weight: 600;">‚Üí Transaction 2 rejected ‚Äî INSUFFICIENT FUNDS ‚úó</div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(33, 150, 243, 0.15)); border: 2px solid var(--accent-green); border-radius: 0.5rem; padding: 1.5rem;">
                    <strong style="color: var(--accent-green); font-size: 1.05rem;">üõ°Ô∏è Defense Activated: Shared Ledger</strong>
                    <p style="color: var(--text-light); margin-top: 0.75rem; line-height: 1.7;">
                        <strong>Why it failed:</strong> Every node has the same ledger. Once your first transaction is confirmed,
                        all nodes update their records showing you only have 0 BTC left. The second transaction is rejected instantly
                        because thousands of nodes independently verified you don't have the funds.
                    </p>
                </div>
            `;
        }

        function attemptHistoryRewrite() {
            const output = document.getElementById('challenge-output');
            output.className = 'demo-output animate-in';

            output.innerHTML = `
                <div style="background: rgba(255, 68, 68, 0.2); border: 2px solid #ff4444; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="font-size: 1.5rem; text-align: center; margin-bottom: 1rem;">‚öîÔ∏è</div>
                    <strong style="color: #ff4444; font-size: 1.1rem; display: block; margin-bottom: 1rem;">Attack Initiated: History Rewrite</strong>
                    <div style="color: var(--text-light); font-size: 0.9rem; line-height: 1.6;">
                        You try to change Block #500,000 (6 months old) to erase a payment you made...
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.3); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="color: var(--accent-blue); font-weight: 600; margin-bottom: 1rem;">üî® Attack Progress:</div>
                    <div style="font-family: monospace; font-size: 0.85rem; line-height: 1.8;">
                        <div style="color: var(--primary-orange); margin: 0.5rem 0;">‚Üí Changing Block #500,000 data...</div>
                        <div style="color: #ff4444; margin: 0.5rem 0;">‚Üí Block hash changes: OLD-MARK-ABC ‚Üí NEW-MARK-XYZ</div>
                        <div style="color: #ff4444; margin: 0.5rem 0;">‚Üí Block #500,001 still references OLD-MARK-ABC</div>
                        <div style="color: #ff4444; margin: 0.5rem 0; font-weight: 600;">üíî CHAIN BROKEN!</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0;">‚Üí Must recalculate 500,001... 500,002... 500,003...</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0;">‚Üí All the way to current block #700,000</div>
                        <div style="color: var(--accent-green); margin: 0.5rem 0;">‚Üí Meanwhile, honest network adds Block #700,001...</div>
                        <div style="color: #ff4444; margin: 1rem 0; font-weight: 700; text-align: center;">‚ùå YOU LOSE THE RACE</div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(33, 150, 243, 0.15)); border: 2px solid var(--accent-green); border-radius: 0.5rem; padding: 1.5rem;">
                    <strong style="color: var(--accent-green); font-size: 1.05rem;">üõ°Ô∏è Defense Activated: Page Chains</strong>
                    <p style="color: var(--text-light); margin-top: 0.75rem; line-height: 1.7;">
                        <strong>Why it failed:</strong> You'd need to recalculate proof-of-work for 200,000 blocks faster than the entire
                        global network can produce 1 new block. The computing power required would cost billions of dollars in electricity alone.
                        By the time you finish, the honest chain would be thousands of blocks ahead, and everyone would reject your fake version.
                    </p>
                </div>
            `;
        }

        function attempt51PercentAttack() {
            const output = document.getElementById('challenge-output');
            output.className = 'demo-output animate-in';

            output.innerHTML = `
                <div style="background: rgba(255, 68, 68, 0.2); border: 2px solid #ff4444; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="font-size: 1.5rem; text-align: center; margin-bottom: 1rem;">‚öîÔ∏è</div>
                    <strong style="color: #ff4444; font-size: 1.1rem; display: block; margin-bottom: 1rem;">Attack Initiated: 51% Attack</strong>
                    <div style="color: var(--text-light); font-size: 0.9rem; line-height: 1.6;">
                        You somehow control 51% of Bitcoin's mining power. Can you rewrite the rules?
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.3); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="color: var(--accent-blue); font-weight: 600; margin-bottom: 1rem;">üìä What You CAN Do:</div>
                    <ul style="color: var(--primary-orange); margin-left: 2rem; line-height: 1.8;">
                        <li>Temporarily prevent transactions from confirming</li>
                        <li>Reverse your own recent transactions (double-spend)</li>
                        <li>Prevent specific people from transacting</li>
                    </ul>

                    <div style="color: var(--accent-blue); font-weight: 600; margin-top: 1.5rem; margin-bottom: 1rem;">‚õî What You CANNOT Do:</div>
                    <ul style="color: #ff4444; margin-left: 2rem; line-height: 1.8;">
                        <li>Steal coins from other people's addresses</li>
                        <li>Change the 21 million coin limit</li>
                        <li>Create coins out of thin air</li>
                        <li>Reverse old transactions (from months ago)</li>
                    </ul>

                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255, 68, 68, 0.1); border-left: 4px solid #ff4444; border-radius: 0.25rem;">
                        <strong style="color: #ff4444;">‚ö†Ô∏è Economic Reality Check:</strong><br>
                        <div style="color: var(--text-light); margin-top: 0.5rem; font-size: 0.9rem;">
                            Cost to acquire 51% of Bitcoin mining: <strong style="color: var(--primary-orange);">~$20 billion in hardware + electricity</strong><br>
                            Your reward: Temporary disruption before network detects and orphans your chain<br>
                            Result: <strong style="color: #ff4444;">Bitcoin price crashes. Your billions become worthless.</strong>
                        </div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(33, 150, 243, 0.15)); border: 2px solid var(--accent-green); border-radius: 0.5rem; padding: 1.5rem;">
                    <strong style="color: var(--accent-green); font-size: 1.05rem;">üõ°Ô∏è Defense Activated: Economic Incentives</strong>
                    <p style="color: var(--text-light); margin-top: 0.75rem; line-height: 1.7;">
                        <strong>Why it fails:</strong> Even with 51% control, you can't break the fundamental rules (cryptography, supply cap).
                        And attacking the network would destroy the value of the very thing you spent billions to attack.
                        It's like buying a company for $20 billion just to burn it down. The game theory makes honesty more profitable.
                    </p>
                </div>
            `;
        }

        function attemptFakeStampAttack() {
            const output = document.getElementById('challenge-output');
            output.className = 'demo-output animate-in';

            output.innerHTML = `
                <div style="background: rgba(255, 68, 68, 0.2); border: 2px solid #ff4444; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="font-size: 1.5rem; text-align: center; margin-bottom: 1rem;">‚öîÔ∏è</div>
                    <strong style="color: #ff4444; font-size: 1.1rem; display: block; margin-bottom: 1rem;">Attack Initiated: Fake Stamp</strong>
                    <div style="color: var(--text-light); font-size: 0.9rem; line-height: 1.6;">
                        You try to forge someone's secret stamp to steal their 1,000 BTC...
                    </div>
                </div>

                <div style="background: rgba(0,0,0,0.3); border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                    <div style="color: var(--accent-blue); font-weight: 600; margin-bottom: 1rem;">üîì Brute Force Attempt:</div>
                    <div style="font-family: monospace; font-size: 0.85rem; line-height: 1.8;">
                        <div style="color: var(--text-dim); margin: 0.5rem 0;">‚Üí Target: Wallet with 1,000 BTC (~$50 million)</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0;">‚Üí Public address: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa</div>
                        <div style="color: var(--primary-orange); margin: 0.5rem 0;">‚Üí Attempting to guess private key...</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0; padding-left: 1rem;">Try #1: Failed</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0; padding-left: 1rem;">Try #10,000: Failed</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0; padding-left: 1rem;">Try #1,000,000: Failed</div>
                        <div style="color: var(--text-dim); margin: 0.5rem 0; padding-left: 1rem;">Try #1,000,000,000: Failed</div>
                        <div style="color: #ff4444; margin: 1rem 0; font-weight: 700;">‚ùå ATTACK FUTILE</div>
                    </div>

                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(156, 39, 176, 0.1); border-left: 4px solid var(--accent-purple); border-radius: 0.25rem;">
                        <strong style="color: var(--accent-purple);">üßÆ The Math:</strong><br>
                        <div style="color: var(--text-light); margin-top: 0.5rem; font-size: 0.85rem; line-height: 1.7;">
                            ‚Ä¢ Possible private keys: 2<sup>256</sup> (that's 115 quattuorvigintillion)<br>
                            ‚Ä¢ Atoms in observable universe: 2<sup>265</sup> (roughly the same scale)<br>
                            ‚Ä¢ Time to guess using all computers on Earth: <strong style="color: var(--primary-orange);">trillions of years</strong><br>
                            ‚Ä¢ Chance of random guess: 1 in 115,792,089,237,316,195,423,570,985,008,687,907,853,269,984,665,640,564,039,457,584,007,913,129,639,936
                        </div>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(33, 150, 243, 0.15)); border: 2px solid var(--accent-green); border-radius: 0.5rem; padding: 1.5rem;">
                    <strong style="color: var(--accent-green); font-size: 1.05rem;">üõ°Ô∏è Defense Activated: Cryptography</strong>
                    <p style="color: var(--text-light); margin-top: 0.75rem; line-height: 1.7;">
                        <strong>Why it failed:</strong> The secret stamp (private key) is protected by 256-bit cryptography.
                        You're more likely to win the lottery 10 times in a row than to randomly guess someone's private key.
                        Even quantum computers (which don't exist yet) would take thousands of years to break this.
                        The universe would end before you cracked a single wallet.
                    </p>
                </div>
            `;
        }

        // Module Completion
        function completeModule() {
            const progress = JSON.parse(localStorage.getItem('learningProgress') || '{}');

            if (!progress.completedModules) {
                progress.completedModules = [];
            }

            if (!progress.completedModules.includes('curious-1-4')) {
                progress.completedModules.push('curious-1-4');
            }

            // Mark Stage 1 as complete
            if (!progress.completedStages) {
                progress.completedStages = [];
            }
            if (!progress.completedStages.includes('curious-1')) {
                progress.completedStages.push('curious-1');
            }

            // Award badge
            if (!progress.badges) {
                progress.badges = [];
            }
            if (!progress.badges.includes('understanding-money')) {
                progress.badges.push('understanding-money');
            }

            progress.lastActivity = new Date().toISOString();
            progress.path = 'curious';
            progress.currentStage = 2;
            progress.currentModule = 1;

            localStorage.setItem('learningProgress', JSON.stringify(progress));

            document.getElementById('completion-message').innerHTML = '‚úÖ Module Complete! Stage 1 finished. Stage 2 unlocked!';
            document.getElementById('complete-btn').disabled = true;
            document.getElementById('complete-btn').style.opacity = '0.5';

            // Scroll to show message
            document.getElementById('completion-message').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // Check if already completed
        function checkCompletion() {
            const progress = JSON.parse(localStorage.getItem('learningProgress') || '{}');
            const completedModules = progress.completedModules || [];

            if (completedModules.includes('curious-1-4')) {
                document.getElementById('completion-message').innerHTML = '‚úì You already completed this module!';
                document.getElementById('complete-btn').textContent = '‚úì Already Complete';
                document.getElementById('complete-btn').disabled = true;
                document.getElementById('complete-btn').style.opacity = '0.5';
            }
        }

        // Run on load
        checkCompletion();
    </script>
</body>
</html>
