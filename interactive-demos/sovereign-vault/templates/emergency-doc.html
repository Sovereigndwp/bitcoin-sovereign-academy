<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Emergency Access Document</title>
    <style>
        /* Print-optimized Emergency Document Styles */
        @page {
            size: letter;
            margin: 1in;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 11pt;
            line-height: 1.6;
            color: #1a1a1a;
            background: white;
        }
        
        .document {
            max-width: 8.5in;
            margin: 0 auto;
            padding: 0.5in;
        }
        
        /* Header */
        .document-header {
            text-align: center;
            border-bottom: 3px double #333;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }
        
        .document-header h1 {
            font-size: 24pt;
            font-weight: bold;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }
        
        .document-header .subtitle {
            font-size: 14pt;
            color: #666;
            font-style: italic;
        }
        
        .document-meta {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 10pt;
            color: #666;
        }
        
        /* Warning Box */
        .warning-box {
            border: 2px solid #c00;
            background: #fff5f5;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        .warning-box h2 {
            color: #c00;
            font-size: 12pt;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .warning-box p {
            font-size: 10pt;
        }
        
        .warning-box ul {
            margin: 0.5rem 0 0 1.5rem;
            font-size: 10pt;
        }
        
        /* Sections */
        .section {
            margin-bottom: 1.5rem;
            page-break-inside: avoid;
        }
        
        .section h2 {
            font-size: 14pt;
            border-bottom: 1px solid #333;
            padding-bottom: 0.25rem;
            margin-bottom: 0.75rem;
        }
        
        .section h3 {
            font-size: 12pt;
            margin: 1rem 0 0.5rem;
        }
        
        /* Data Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
            font-size: 10pt;
        }
        
        .data-table th,
        .data-table td {
            border: 1px solid #ccc;
            padding: 0.5rem;
            text-align: left;
        }
        
        .data-table th {
            background: #f5f5f5;
            font-weight: bold;
        }
        
        .data-table .label {
            width: 30%;
            background: #f9f9f9;
            font-weight: 600;
        }
        
        /* Info Cards */
        .info-card {
            border: 1px solid #ccc;
            padding: 1rem;
            margin: 0.75rem 0;
            background: #fafafa;
        }
        
        .info-card h4 {
            font-size: 11pt;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .info-card p {
            font-size: 10pt;
            margin-bottom: 0.25rem;
        }
        
        /* Steps */
        .steps {
            counter-reset: step;
            list-style: none;
            padding: 0;
        }
        
        .steps li {
            position: relative;
            padding-left: 2rem;
            margin-bottom: 1rem;
            page-break-inside: avoid;
        }
        
        .steps li::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 1.5rem;
            height: 1.5rem;
            background: #333;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 1.5rem;
            font-weight: bold;
            font-size: 10pt;
        }
        
        .steps li strong {
            display: block;
            margin-bottom: 0.25rem;
        }
        
        /* Checklist */
        .checklist {
            list-style: none;
            padding: 0;
        }
        
        .checklist li {
            padding: 0.5rem 0 0.5rem 1.75rem;
            position: relative;
            border-bottom: 1px dotted #ccc;
        }
        
        .checklist li::before {
            content: "‚òê";
            position: absolute;
            left: 0;
            font-size: 14pt;
        }
        
        /* Contact Card */
        .contact-card {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 0.75rem 0;
        }
        
        .contact-item {
            border: 1px solid #ccc;
            padding: 0.75rem;
            background: #fafafa;
        }
        
        .contact-item .name {
            font-weight: bold;
            font-size: 11pt;
        }
        
        .contact-item .role {
            color: #666;
            font-size: 9pt;
            font-style: italic;
        }
        
        .contact-item .details {
            margin-top: 0.5rem;
            font-size: 10pt;
        }
        
        /* Important Notes */
        .important-note {
            background: #fffde7;
            border-left: 4px solid #f9a825;
            padding: 0.75rem;
            margin: 0.75rem 0;
            font-size: 10pt;
        }
        
        .important-note strong {
            color: #f57f17;
        }
        
        /* Signature Area */
        .signature-area {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #ccc;
        }
        
        .signature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }
        
        .signature-line {
            border-top: 1px solid #333;
            padding-top: 0.25rem;
            font-size: 10pt;
            color: #666;
        }
        
        /* Footer */
        .document-footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #ccc;
            font-size: 9pt;
            color: #666;
            text-align: center;
        }
        
        /* Print-specific */
        @media print {
            .document {
                padding: 0;
            }
            
            .no-print {
                display: none !important;
            }
            
            .section {
                page-break-inside: avoid;
            }
            
            .page-break {
                page-break-before: always;
            }
        }
        
        /* Screen-only controls */
        .print-controls {
            position: fixed;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 100;
        }
        
        .print-controls button {
            padding: 0.75rem 1.5rem;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12pt;
        }
        
        .print-controls button:hover {
            background: #555;
        }
        
        @media print {
            .print-controls {
                display: none;
            }
        }
        
        /* Redacted content */
        .redacted {
            background: #333;
            color: #333;
            user-select: none;
        }
        
        .redacted::before {
            content: "[REDACTED - Full version available in secure document]";
            color: #666;
            font-style: italic;
            font-size: 9pt;
        }
        
        /* QR Code placeholder */
        .qr-placeholder {
            width: 100px;
            height: 100px;
            border: 2px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9pt;
            color: #999;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="print-controls no-print">
        <button onclick="window.print()">üñ®Ô∏è Print Document</button>
        <button onclick="window.close()">‚úï Close</button>
    </div>

    <div class="document">
        <!-- Header -->
        <header class="document-header">
            <h1>üîê BITCOIN EMERGENCY ACCESS DOCUMENT</h1>
            <p class="subtitle">Confidential Recovery Instructions</p>
            <div class="document-meta">
                <span>Document ID: <strong id="doc-id">VAULT-XXXX-XXXX</strong></span>
                <span>Generated: <strong id="doc-date">{{DATE}}</strong></span>
                <span>Version: <strong id="doc-version">1.0</strong></span>
            </div>
        </header>

        <!-- Critical Warning -->
        <div class="warning-box">
            <h2>‚ö†Ô∏è CRITICAL SECURITY NOTICE</h2>
            <p>This document contains sensitive information about Bitcoin custody. Handle with extreme care:</p>
            <ul>
                <li><strong>Store physically secure</strong> ‚Äì Use a safe, lockbox, or safety deposit box</li>
                <li><strong>Limit access</strong> ‚Äì Only share with designated heirs/trustees</li>
                <li><strong>Never digitize</strong> ‚Äì Do not photograph, scan, or store electronically</li>
                <li><strong>Verify authenticity</strong> ‚Äì Contact the owner or trusted advisor before acting</li>
                <li><strong>This document alone is NOT sufficient</strong> to access funds ‚Äì it provides guidance only</li>
            </ul>
        </div>

        <!-- For Whom This Document Is Intended -->
        <section class="section">
            <h2>üìã Purpose & Intended Recipients</h2>
            <p id="doc-purpose">This emergency access document is prepared for designated heirs and trusted parties to facilitate the recovery and proper handling of Bitcoin holdings in the event of the owner's incapacity or death.</p>
            
            <h3>Designated Recipients:</h3>
            <div id="recipients-list">
                <!-- Populated dynamically -->
                <div class="contact-card">
                    <div class="contact-item">
                        <div class="name">{{HEIR_NAME}}</div>
                        <div class="role">{{HEIR_ROLE}}</div>
                        <div class="details">
                            Contact: {{HEIR_CONTACT}}<br>
                            Access Level: {{ACCESS_LEVEL}}
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- What To Do First -->
        <section class="section">
            <h2>üö® Immediate Steps (Read First)</h2>
            <ol class="steps" id="first-steps">
                <li>
                    <strong>Do Not Panic ‚Äì Take Your Time</strong>
                    Bitcoin on the blockchain is secure indefinitely. There is no urgency unless theft is suspected.
                </li>
                <li>
                    <strong>Verify Document Authenticity</strong>
                    Contact the trusted advisor listed below to confirm this document is current and valid.
                </li>
                <li>
                    <strong>Gather Required Materials</strong>
                    Collect all items listed in the "Required Materials" section before attempting recovery.
                </li>
                <li>
                    <strong>Follow Recovery Steps In Order</strong>
                    Each wallet type has specific procedures. Do not skip steps or improvise.
                </li>
                <li>
                    <strong>Seek Professional Help If Needed</strong>
                    Contact listed Bitcoin professionals for assistance with complex recoveries.
                </li>
            </ol>
        </section>

        <!-- Wallet Overview -->
        <section class="section">
            <h2>üí∞ Wallet Overview</h2>
            <p>The following Bitcoin wallets are documented in this custody system:</p>
            
            <table class="data-table" id="wallets-table">
                <thead>
                    <tr>
                        <th>Wallet Name</th>
                        <th>Type</th>
                        <th>Purpose</th>
                        <th>Backup Locations</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Populated dynamically -->
                    <tr>
                        <td>{{WALLET_NAME}}</td>
                        <td>{{WALLET_TYPE}}</td>
                        <td>{{WALLET_PURPOSE}}</td>
                        <td>{{BACKUP_LOCATIONS}}</td>
                    </tr>
                </tbody>
            </table>
            
            <div class="important-note">
                <strong>Important:</strong> Wallet balances are not included in this document for security reasons. 
                Use a block explorer or the listed wallet software to verify current balances.
            </div>
        </section>

        <!-- Backup Locations -->
        <section class="section">
            <h2>üìç Backup Location Registry</h2>
            <p>Recovery materials are stored in the following locations. Each location uses an alias for security.</p>
            
            <div id="locations-list">
                <!-- Populated dynamically -->
                <div class="info-card">
                    <h4>üè† {{LOCATION_ALIAS}}</h4>
                    <p><strong>What's Here:</strong> {{ITEMS_STORED}}</p>
                    <p><strong>Access Instructions:</strong> {{ACCESS_INSTRUCTIONS}}</p>
                    <p><strong>Security Features:</strong> {{SECURITY_FEATURES}}</p>
                </div>
            </div>
            
            <div class="important-note">
                <strong>Security Note:</strong> Full addresses are stored separately. Contact the trusted advisor 
                for specific location details if aliases are unclear.
            </div>
        </section>

        <div class="page-break"></div>

        <!-- Recovery Procedures -->
        <section class="section">
            <h2>üîß Recovery Procedures</h2>
            
            <h3>For Single-Signature (Singlesig) Wallets:</h3>
            <ol class="steps">
                <li>
                    <strong>Locate the Seed Phrase Backup</strong>
                    Find the 12 or 24-word seed phrase from the documented backup location.
                </li>
                <li>
                    <strong>Verify Seed Phrase Integrity</strong>
                    Ensure all words are legible. Check the final word (checksum) is valid.
                </li>
                <li>
                    <strong>Choose Recovery Method</strong>
                    Use a hardware wallet (recommended) or the original wallet software to import.
                </li>
                <li>
                    <strong>Enter Seed Phrase Carefully</strong>
                    Type each word exactly as written. Watch for similar-looking words (affect/effect, etc.)
                </li>
                <li>
                    <strong>Verify Balance Before Transacting</strong>
                    Confirm the expected balance appears before sending any transactions.
                </li>
            </ol>
            
            <h3>For Multi-Signature (Multisig) Wallets:</h3>
            <ol class="steps">
                <li>
                    <strong>Gather Required Number of Keys</strong>
                    A {{M}}-of-{{N}} multisig requires at least {{M}} keys to sign. Identify which keys you have access to.
                </li>
                <li>
                    <strong>Locate the Wallet Configuration File</strong>
                    The configuration (descriptor/BSMS file) is required to reconstruct the wallet.
                </li>
                <li>
                    <strong>Import Configuration to Compatible Wallet</strong>
                    Use software that supports the wallet standard (Sparrow, Nunchuk, etc.)
                </li>
                <li>
                    <strong>Connect/Import Required Signing Keys</strong>
                    Import each key using its seed phrase or connect hardware devices.
                </li>
                <li>
                    <strong>Coordinate Signing If Multiple Parties</strong>
                    If keys are held by different people, coordinate to create and sign the transaction.
                </li>
            </ol>
        </section>

        <!-- Required Materials Checklist -->
        <section class="section">
            <h2>‚úÖ Required Materials Checklist</h2>
            <p>Before attempting recovery, ensure you have gathered the following items:</p>
            
            <ul class="checklist" id="materials-checklist">
                <li>Seed phrase backup(s) - 12 or 24 words</li>
                <li>Wallet configuration file (for multisig)</li>
                <li>Hardware wallet device(s) and PIN(s)</li>
                <li>Passphrase (if wallet uses additional passphrase)</li>
                <li>Derivation path information (if non-standard)</li>
                <li>Computer with wallet software installed</li>
                <li>This emergency access document</li>
                <li>Contact information for trusted advisor</li>
            </ul>
        </section>

        <!-- Trusted Contacts -->
        <section class="section">
            <h2>üë• Trusted Contacts</h2>
            <p>The following individuals can assist with recovery questions:</p>
            
            <div class="contact-card" id="contacts-list">
                <!-- Populated dynamically -->
                <div class="contact-item">
                    <div class="name">{{CONTACT_NAME}}</div>
                    <div class="role">{{CONTACT_ROLE}}</div>
                    <div class="details">
                        Phone: {{PHONE}}<br>
                        Email: {{EMAIL}}<br>
                        Notes: {{NOTES}}
                    </div>
                </div>
            </div>
            
            <div class="important-note">
                <strong>Verification:</strong> When contacting these individuals, use a pre-agreed verification 
                phrase or method to confirm identity before sharing sensitive information.
            </div>
        </section>

        <!-- Custom Instructions -->
        <section class="section">
            <h2>üìù Additional Instructions</h2>
            <div id="custom-instructions">
                <!-- Populated from user's custom instructions -->
                <p>{{CUSTOM_INSTRUCTIONS}}</p>
            </div>
        </section>

        <!-- Common Mistakes to Avoid -->
        <section class="section">
            <h2>‚õî Common Mistakes to Avoid</h2>
            <ul>
                <li><strong>Entering seed phrases on websites</strong> ‚Äì Never type your seed phrase into any website, ever.</li>
                <li><strong>Sharing seed phrases digitally</strong> ‚Äì Never send via email, text, chat, or photo.</li>
                <li><strong>Rushing the process</strong> ‚Äì Bitcoin is patient. Take time to understand before acting.</li>
                <li><strong>Trusting "support" contacts</strong> ‚Äì Scammers impersonate support. Legitimate services never ask for seeds.</li>
                <li><strong>Using unfamiliar software</strong> ‚Äì Only use recommended wallet software from official sources.</li>
                <li><strong>Making large transactions first</strong> ‚Äì Test with small amounts before moving significant funds.</li>
                <li><strong>Ignoring fees</strong> ‚Äì Understand transaction fees before sending. Use recommended fee estimation.</li>
                <li><strong>Discarding "empty" wallets</strong> ‚Äì Wallets may have additional accounts or future value.</li>
            </ul>
        </section>

        <!-- Glossary -->
        <section class="section">
            <h2>üìñ Glossary of Terms</h2>
            <table class="data-table">
                <tr>
                    <td class="label">Seed Phrase</td>
                    <td>12 or 24 words that can recover a Bitcoin wallet. Must be kept secret and secure.</td>
                </tr>
                <tr>
                    <td class="label">Passphrase</td>
                    <td>Optional additional password that creates a hidden wallet. Sometimes called "25th word."</td>
                </tr>
                <tr>
                    <td class="label">Multisig</td>
                    <td>Wallet requiring multiple keys to authorize transactions (e.g., 2-of-3 means 2 keys from 3 total).</td>
                </tr>
                <tr>
                    <td class="label">Hardware Wallet</td>
                    <td>Physical device that securely stores Bitcoin keys (e.g., Coldcard, Trezor, Ledger).</td>
                </tr>
                <tr>
                    <td class="label">Derivation Path</td>
                    <td>Technical parameter that determines which addresses are generated. Usually handled automatically.</td>
                </tr>
                <tr>
                    <td class="label">UTXO</td>
                    <td>Unspent Transaction Output ‚Äì the "coins" in your wallet that can be spent.</td>
                </tr>
                <tr>
                    <td class="label">Block Explorer</td>
                    <td>Website to view Bitcoin transactions and addresses (e.g., mempool.space, blockstream.info).</td>
                </tr>
            </table>
        </section>

        <!-- Signature Section -->
        <section class="section signature-area">
            <h2>‚úçÔ∏è Document Acknowledgment</h2>
            <p>By signing below, the recipient acknowledges receipt of this document and agrees to maintain its confidentiality.</p>
            
            <div class="signature-grid">
                <div>
                    <div style="height: 60px;"></div>
                    <div class="signature-line">Owner Signature & Date</div>
                </div>
                <div>
                    <div style="height: 60px;"></div>
                    <div class="signature-line">Recipient Signature & Date</div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="document-footer">
            <p>Generated by Sovereign Vault ‚Äì Bitcoin Custody Intelligence System</p>
            <p>This document should be reviewed and updated annually or when custody arrangements change.</p>
            <p>Last Review: <span id="last-review">{{DATE}}</span> | Next Review Due: <span id="next-review">{{DATE + 1 year}}</span></p>
        </footer>
    </div>

    <script>
        // This script populates template variables when opened from Sovereign Vault
        // It receives data via URL parameters or postMessage from parent window
        
        document.addEventListener('DOMContentLoaded', function() {
            // Check for data in URL hash (base64 encoded JSON)
            const hash = window.location.hash.substring(1);
            if (hash) {
                try {
                    const data = JSON.parse(atob(hash));
                    populateDocument(data);
                } catch (e) {
                    console.log('No embedded data found, using template placeholders');
                }
            }
            
            // Listen for postMessage from parent
            window.addEventListener('message', function(event) {
                if (event.data && event.data.type === 'POPULATE_DOCUMENT') {
                    populateDocument(event.data.payload);
                }
            });
            
            // Set default date if not populated
            const today = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            if (document.getElementById('doc-date').textContent === '{{DATE}}') {
                document.getElementById('doc-date').textContent = today;
            }
            if (document.getElementById('last-review').textContent === '{{DATE}}') {
                document.getElementById('last-review').textContent = today;
            }
            
            // Generate document ID
            if (document.getElementById('doc-id').textContent === 'VAULT-XXXX-XXXX') {
                const docId = 'VAULT-' + Math.random().toString(36).substring(2, 6).toUpperCase() + 
                              '-' + Math.random().toString(36).substring(2, 6).toUpperCase();
                document.getElementById('doc-id').textContent = docId;
            }
        });
        
        function populateDocument(data) {
            // Populate header
            if (data.documentId) {
                document.getElementById('doc-id').textContent = data.documentId;
            }
            if (data.date) {
                document.getElementById('doc-date').textContent = data.date;
            }
            if (data.version) {
                document.getElementById('doc-version').textContent = data.version;
            }
            
            // Populate purpose
            if (data.purpose) {
                document.getElementById('doc-purpose').textContent = data.purpose;
            }
            
            // Populate recipients/heirs
            if (data.heirs && data.heirs.length > 0) {
                const recipientsList = document.getElementById('recipients-list');
                recipientsList.innerHTML = '<div class="contact-card">' + 
                    data.heirs.map(heir => `
                        <div class="contact-item">
                            <div class="name">${heir.name}</div>
                            <div class="role">${heir.relationship || 'Designated Heir'}</div>
                            <div class="details">
                                Contact: ${heir.contact || 'See separate secure document'}<br>
                                Access Level: ${heir.accessLevel || 'Full Recovery Access'}
                            </div>
                        </div>
                    `).join('') + '</div>';
            }
            
            // Populate wallets table
            if (data.wallets && data.wallets.length > 0) {
                const tbody = document.querySelector('#wallets-table tbody');
                tbody.innerHTML = data.wallets.map(wallet => `
                    <tr>
                        <td>${wallet.name}</td>
                        <td>${wallet.type}</td>
                        <td>${wallet.purpose || 'General'}</td>
                        <td>${wallet.backupLocations ? wallet.backupLocations.join(', ') : 'See backup registry'}</td>
                    </tr>
                `).join('');
            }
            
            // Populate backup locations
            if (data.locations && data.locations.length > 0) {
                const locationsList = document.getElementById('locations-list');
                locationsList.innerHTML = data.locations.map(loc => `
                    <div class="info-card">
                        <h4>üè† ${loc.alias || loc.name}</h4>
                        <p><strong>What's Here:</strong> ${loc.items || 'See detailed inventory'}</p>
                        <p><strong>Access Instructions:</strong> ${loc.accessInstructions || 'Contact trusted advisor'}</p>
                        <p><strong>Security Features:</strong> ${loc.security || 'Standard security'}</p>
                    </div>
                `).join('');
            }
            
            // Populate contacts
            if (data.contacts && data.contacts.length > 0) {
                const contactsList = document.getElementById('contacts-list');
                contactsList.innerHTML = data.contacts.map(contact => `
                    <div class="contact-item">
                        <div class="name">${contact.name}</div>
                        <div class="role">${contact.role || 'Trusted Contact'}</div>
                        <div class="details">
                            ${contact.phone ? 'Phone: ' + contact.phone + '<br>' : ''}
                            ${contact.email ? 'Email: ' + contact.email + '<br>' : ''}
                            ${contact.notes ? 'Notes: ' + contact.notes : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            // Populate custom instructions
            if (data.instructions) {
                document.getElementById('custom-instructions').innerHTML = 
                    '<div style="white-space: pre-wrap;">' + data.instructions + '</div>';
            }
            
            // Update multisig info if present
            if (data.multisigConfig) {
                const stepsSection = document.querySelector('h3:contains("Multi-Signature")');
                // Update M-of-N references in the text
            }
        }
    </script>
</body>
</html>
