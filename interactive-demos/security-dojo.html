<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Security Dojo – Become Your Own Bank Safely</title>
  <link rel="stylesheet" href="/css/brand.css">
  <style>
    :root {
      --critical: #ef4444;
      --high: #f97316;
      --medium: #eab308;
      --low: #84cc16;
      --success: #22c55e;
      --bg-darker: #0a0a0a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-sans);
      background: var(--color-bg);
      color: var(--color-text);
      line-height: 1.6;
    }

    header {
      position: sticky;
      top: 0;
      background: var(--color-surface);
      border-bottom: 2px solid var(--color-brand);
      padding: 1rem 1.5rem;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    header .container {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .belt-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 1rem;
      background: rgba(255, 152, 0, 0.15);
      border: 1px solid var(--color-brand);
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    a { color: var(--color-brand); text-decoration: none; transition: opacity 0.2s; }
    a:hover { opacity: 0.8; }

    .hero {
      background: linear-gradient(135deg, rgba(247, 147, 26, 0.1) 0%, rgba(247, 147, 26, 0.05) 100%);
      padding: 3rem 1.5rem;
      text-align: center;
      border-bottom: 1px solid var(--color-border);
    }

    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      background: var(--gradient-brand);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1.2rem;
      color: var(--color-muted);
      max-width: 600px;
      margin: 0 auto 2rem;
    }

    .cta-button {
      background: var(--gradient-brand);
      border: none;
      color: #fff;
      font-weight: 600;
      padding: 1rem 2rem;
      border-radius: 999px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: transform 0.2s, box-shadow 0.2s;
      display: inline-block;
    }

    .cta-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(247, 147, 26, 0.3);
    }

    .cta-button:active {
      transform: translateY(0);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }

    /* Security Score Dashboard */
    .score-dashboard {
      display: none;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .score-card {
      background: var(--color-surface);
      border-radius: 20px;
      padding: 3rem;
      margin-bottom: 2rem;
      border: 2px solid var(--color-border);
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .score-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-brand);
    }

    .score-visual {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 2rem;
    }

    .score-circle {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(
        var(--color-brand) 0deg,
        var(--color-brand) var(--score-angle, 0deg),
        var(--color-border) var(--score-angle, 0deg)
      );
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      animation: rotateScore 1s ease-out;
    }

    @keyframes rotateScore {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .score-inner {
      width: 85%;
      height: 85%;
      border-radius: 50%;
      background: var(--color-bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .score-number {
      font-size: 4rem;
      font-weight: 700;
      line-height: 1;
    }

    .score-grade {
      font-size: 1.2rem;
      color: var(--color-muted);
      margin-top: 0.5rem;
    }

    .score-status {
      display: inline-block;
      padding: 0.5rem 1.5rem;
      border-radius: 999px;
      font-weight: 600;
      margin-top: 1rem;
    }

    .status-critical { background: rgba(239, 68, 68, 0.2); color: var(--critical); }
    .status-warning { background: rgba(249, 115, 22, 0.2); color: var(--high); }
    .status-good { background: rgba(34, 197, 94, 0.2); color: var(--success); }

    /* Vulnerabilities Grid */
    .vuln-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .vuln-card {
      background: var(--color-surface);
      border: 2px solid var(--color-border);
      border-radius: 16px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .vuln-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      transition: all 0.3s ease;
    }

    .vuln-card.critical::before { background: var(--critical); }
    .vuln-card.high::before { background: var(--high); }
    .vuln-card.medium::before { background: var(--medium); }
    .vuln-card.low::before { background: var(--low); }

    .vuln-card:hover {
      border-color: var(--color-brand);
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .vuln-card.expanded {
      grid-column: 1 / -1;
      border-color: var(--color-brand);
    }

    .vuln-header {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .vuln-icon {
      font-size: 2rem;
      line-height: 1;
    }

    .vuln-info {
      flex: 1;
    }

    .vuln-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .severity-badge {
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .severity-critical { background: rgba(239, 68, 68, 0.2); color: var(--critical); }
    .severity-high { background: rgba(249, 115, 22, 0.2); color: var(--high); }
    .severity-medium { background: rgba(234, 179, 8, 0.2); color: var(--medium); }
    .severity-low { background: rgba(132, 204, 22, 0.2); color: var(--low); }

    .vuln-description {
      color: var(--color-muted);
      margin-bottom: 1rem;
    }

    .vuln-details {
      display: none;
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid var(--color-border);
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        max-height: 0;
      }
      to {
        opacity: 1;
        max-height: 2000px;
      }
    }

    .vuln-card.expanded .vuln-details {
      display: block;
    }

    .action-button {
      background: var(--gradient-brand);
      border: none;
      color: #fff;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 999px;
      cursor: pointer;
      margin-top: 1rem;
      transition: transform 0.2s;
      display: inline-block;
    }

    .action-button:hover {
      transform: translateX(5px);
    }

    .action-button.secondary {
      background: transparent;
      border: 2px solid var(--color-brand);
      color: var(--color-brand);
    }

    /* Training Module */
    .training-section {
      background: var(--color-surface);
      border-radius: 20px;
      padding: 2rem;
      margin-top: 2rem;
    }

    .training-section h3 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .exercise-box {
      background: var(--bg-darker);
      border: 1px solid var(--color-border);
      border-radius: 12px;
      padding: 1.5rem;
      margin: 1rem 0;
    }

    .exercise-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .exercise-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .difficulty-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .difficulty-beginner { background: rgba(132, 204, 22, 0.2); color: var(--low); }
    .difficulty-intermediate { background: rgba(234, 179, 8, 0.2); color: var(--medium); }
    .difficulty-advanced { background: rgba(249, 115, 22, 0.2); color: var(--high); }

    .checklist {
      list-style: none;
      padding: 0;
    }

    .checklist li {
      padding: 0.75rem;
      margin: 0.5rem 0;
      background: var(--color-surface);
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .checklist li:hover {
      background: rgba(247, 147, 26, 0.1);
    }

    .checklist li.completed {
      opacity: 0.6;
    }

    .checkbox {
      width: 24px;
      height: 24px;
      border: 2px solid var(--color-border);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .checklist li.completed .checkbox {
      background: var(--success);
      border-color: var(--success);
    }

    .checkbox::after {
      content: '✓';
      color: white;
      font-weight: 700;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .checklist li.completed .checkbox::after {
      opacity: 1;
    }

    /* Interactive Simulator */
    .simulator {
      background: var(--bg-darker);
      border: 2px solid var(--color-border);
      border-radius: 16px;
      padding: 2rem;
      margin: 2rem 0;
    }

    .simulator-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .simulator-title {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .key-display {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .key-card {
      background: var(--color-surface);
      border: 2px solid var(--color-border);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s;
    }

    .key-card.active {
      border-color: var(--color-brand);
      box-shadow: 0 0 20px rgba(247, 147, 26, 0.3);
    }

    .key-card h4 {
      margin-bottom: 1rem;
      color: var(--color-brand);
    }

    .key-visual {
      font-size: 3rem;
      margin-bottom: 1rem;
    }

    .key-status {
      font-size: 0.9rem;
      color: var(--color-muted);
    }

    .sig-required {
      text-align: center;
      padding: 1rem;
      background: rgba(247, 147, 26, 0.1);
      border-radius: 12px;
      margin: 1rem 0;
      font-weight: 600;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--color-border);
      border-radius: 999px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-brand);
      transition: width 0.5s ease;
    }

    /* Recommendations */
    .recommendations {
      margin-top: 3rem;
    }

    .rec-category {
      margin-bottom: 2rem;
    }

    .rec-category h3 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .rec-list {
      display: grid;
      gap: 0.75rem;
    }

    .rec-item {
      background: var(--color-surface);
      border-left: 4px solid var(--color-border);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s;
    }

    .rec-item:hover {
      border-left-color: var(--color-brand);
      background: rgba(247, 147, 26, 0.05);
    }

    .rec-item.priority-high { border-left-color: var(--high); }
    .rec-item.priority-medium { border-left-color: var(--medium); }
    .rec-item.priority-low { border-left-color: var(--low); }

    .rec-content {
      flex: 1;
    }

    .rec-text {
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .rec-category-tag {
      font-size: 0.8rem;
      color: var(--color-muted);
    }

    .rec-action {
      margin-left: 1rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2rem;
      }

      .hero p {
        font-size: 1rem;
      }

      .vuln-grid {
        grid-template-columns: 1fr;
      }

      .score-card {
        padding: 2rem 1rem;
      }

      .key-display {
        grid-template-columns: 1fr;
      }
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--color-muted);
    }

    .spinner {
      border: 3px solid var(--color-border);
      border-top-color: var(--color-brand);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <a href="/interactive-demos/">← Back to Demos</a>
      <div class="belt-badge">
        <span id="belt-rank">🥋 White Belt</span>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero" id="hero-section">
    <h1>🥋 Security Dojo</h1>
    <p>Test your opsec, master multi-sig, and become your own bank safely. Get personalized recommendations and hands-on training.</p>
    <button class="cta-button" id="btn-audit">
      🔍 Run Security Audit
    </button>
  </section>

  <!-- Main Container -->
  <main class="container">
    <!-- Loading State -->
    <div class="loading" id="loading" style="display: none;">
      <div class="spinner"></div>
      <p>Analyzing your security posture...</p>
    </div>

    <!-- Score Dashboard -->
    <div class="score-dashboard" id="dashboard">
      <!-- Score Card -->
      <div class="score-card">
        <div class="score-visual">
          <div class="score-circle" id="score-circle">
            <div class="score-inner">
              <div class="score-number" id="score-number">0</div>
              <div class="score-grade" id="score-grade">F</div>
            </div>
          </div>
        </div>
        <h2>Your Security Score</h2>
        <div class="score-status" id="score-status">Critical</div>
        <p style="color: var(--color-muted); margin-top: 1rem;">
          <span id="critical-count">0</span> critical issues ·
          <span id="high-count">0</span> high priority ·
          <span id="total-vuln">0</span> total vulnerabilities
        </p>
      </div>

      <!-- Vulnerabilities Section -->
      <section>
        <h2 style="margin-bottom: 1.5rem;">🎯 Your Security Training Path</h2>
        <p style="color: var(--color-muted); margin-bottom: 2rem;">
          Click each vulnerability to unlock interactive training and hands-on exercises.
        </p>
        <div class="vuln-grid" id="vuln-grid"></div>
      </section>

      <!-- Recommendations -->
      <section class="recommendations" id="recommendations">
        <h2 style="margin-bottom: 1.5rem;">📋 Action Plan</h2>

        <div class="rec-category">
          <h3>🔥 Immediate (Do Today)</h3>
          <div class="rec-list" id="immediate-recs"></div>
        </div>

        <div class="rec-category">
          <h3>⚡ Short-Term (This Week)</h3>
          <div class="rec-list" id="short-term-recs"></div>
        </div>

        <div class="rec-category">
          <h3>📅 Long-Term (This Month)</h3>
          <div class="rec-list" id="long-term-recs"></div>
        </div>
      </section>
    </div>
  </main>

  <script src="../ai-agents/advanced-agents.js"></script>
  <script>
    // Initialize
    const auditor = new SecurityAuditAgent();
    let auditData = null;
    let completedExercises = new Set();

    // Belt system
    const beltRanks = [
      { name: 'White Belt', score: 0 },
      { name: 'Yellow Belt', score: 30 },
      { name: 'Orange Belt', score: 50 },
      { name: 'Green Belt', score: 65 },
      { name: 'Blue Belt', score: 75 },
      { name: 'Brown Belt', score: 85 },
      { name: 'Black Belt', score: 95 }
    ];

    function getBeltRank(score) {
      for (let i = beltRanks.length - 1; i >= 0; i--) {
        if (score >= beltRanks[i].score) {
          return beltRanks[i].name;
        }
      }
      return 'White Belt';
    }

    // Vulnerability templates with interactive training
    const vulnTemplates = {
      multiSig: {
        icon: '🔐',
        title: 'Multi-Signature Security',
        description: 'Single signature wallets are vulnerable to single points of failure.',
        training: `
          <div class="training-section">
            <h3>🎓 Master Multi-Sig Setup</h3>
            <p>Learn how to create a 2-of-3 multi-signature wallet for enhanced security.</p>

            <div class="simulator">
              <div class="simulator-header">
                <div class="simulator-title">Multi-Sig Simulator</div>
                <p style="color: var(--color-muted);">Experience how multi-sig protects your funds</p>
              </div>

              <div class="key-display" id="multisig-keys">
                <div class="key-card" data-key="1">
                  <div class="key-visual">🔑</div>
                  <h4>Key 1</h4>
                  <div class="key-status">Hardware Wallet</div>
                  <button class="action-button" onclick="signKey(1)">Sign</button>
                </div>
                <div class="key-card" data-key="2">
                  <div class="key-visual">🔑</div>
                  <h4>Key 2</h4>
                  <div class="key-status">Mobile Device</div>
                  <button class="action-button" onclick="signKey(2)">Sign</button>
                </div>
                <div class="key-card" data-key="3">
                  <div class="key-visual">🔑</div>
                  <h4>Key 3</h4>
                  <div class="key-status">Backup Location</div>
                  <button class="action-button" onclick="signKey(3)">Sign</button>
                </div>
              </div>

              <div class="sig-required">
                <div>Signatures: <span id="sig-count">0</span> / 2 required</div>
                <div class="progress-bar">
                  <div class="progress-fill" id="sig-progress" style="width: 0%"></div>
                </div>
              </div>

              <button class="action-button" id="broadcast-btn" style="width: 100%; opacity: 0.5; cursor: not-allowed;" disabled>
                📡 Broadcast Transaction
              </button>
            </div>

            <div class="exercise-box">
              <div class="exercise-header">
                <div class="exercise-title">🎯 Hands-On Exercise</div>
                <span class="difficulty-badge difficulty-intermediate">Intermediate</span>
              </div>
              <p style="margin-bottom: 1rem;">Complete these steps to master multi-sig:</p>
              <ul class="checklist" id="multisig-checklist">
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Understand 2-of-3 multi-sig structure</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Sign transaction with two different keys</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Experience single key compromise scenario</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Design your own multi-sig backup strategy</span>
                </li>
              </ul>
            </div>
          </div>
        `
      },
      hardwareWallet: {
        icon: '🔒',
        title: 'Hardware Wallet Protection',
        description: 'Software wallets are vulnerable to malware and hacking.',
        training: `
          <div class="training-section">
            <h3>🎓 Hardware Wallet Mastery</h3>
            <p>Learn why hardware wallets are essential for self-custody.</p>

            <div class="exercise-box">
              <div class="exercise-header">
                <div class="exercise-title">🎯 Hardware Wallet Setup</div>
                <span class="difficulty-badge difficulty-beginner">Beginner</span>
              </div>
              <ul class="checklist">
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Research reputable hardware wallet manufacturers</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Verify device authenticity and tamper-proof seals</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Generate seed phrase offline</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Set up PIN and passphrase</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Test with small amount first</span>
                </li>
              </ul>
            </div>

            <div class="simulator" style="margin-top: 2rem;">
              <h4>🆚 Hot Wallet vs Cold Wallet</h4>
              <p style="margin-bottom: 1.5rem; color: var(--color-muted);">
                Understand the security difference between software and hardware wallets.
              </p>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                <div>
                  <h5 style="color: var(--high); margin-bottom: 1rem;">💻 Hot Wallet (Software)</h5>
                  <ul style="color: var(--color-muted); list-style-position: inside;">
                    <li>Private keys on internet-connected device</li>
                    <li>Vulnerable to malware</li>
                    <li>Convenient for small amounts</li>
                    <li>Free</li>
                  </ul>
                </div>
                <div>
                  <h5 style="color: var(--success); margin-bottom: 1rem;">🔒 Cold Wallet (Hardware)</h5>
                  <ul style="color: var(--color-muted); list-style-position: inside;">
                    <li>Private keys never leave device</li>
                    <li>Immune to remote attacks</li>
                    <li>Best for long-term storage</li>
                    <li>~$60-200 investment</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        `
      },
      backups: {
        icon: '💾',
        title: 'Backup Strategy',
        description: 'Inadequate backups mean permanent loss of funds.',
        training: `
          <div class="training-section">
            <h3>🎓 The 3-2-1 Backup Rule</h3>
            <p>Never lose access to your Bitcoin with a bulletproof backup strategy.</p>

            <div class="exercise-box">
              <h4 style="margin-bottom: 1rem;">🎯 Test Your Backup</h4>
              <p style="color: var(--color-muted); margin-bottom: 1.5rem;">
                Scenario: Your house burns down. Can you recover your Bitcoin?
              </p>
              <ul class="checklist">
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span><strong>3 copies:</strong> Original + 2 backups of seed phrase</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span><strong>2 different media:</strong> Metal plate + encrypted digital</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span><strong>1 offsite:</strong> One backup in different location</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Test recovery process with small wallet</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Document recovery instructions for heirs</span>
                </li>
              </ul>
            </div>

            <div class="simulator" style="margin-top: 2rem;">
              <h4>🔥 Disaster Recovery Scenarios</h4>
              <div style="display: grid; gap: 1rem; margin-top: 1rem;">
                <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                  <strong>🏠 House Fire:</strong>
                  <span style="color: var(--color-muted);">
                    Primary backup destroyed → Offsite backup saves you ✅
                  </span>
                </div>
                <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                  <strong>💻 Device Stolen:</strong>
                  <span style="color: var(--color-muted);">
                    Metal backup at home → Recover all funds ✅
                  </span>
                </div>
                <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                  <strong>🧠 Memory Loss:</strong>
                  <span style="color: var(--color-muted);">
                    Documented instructions for family → They can recover ✅
                  </span>
                </div>
              </div>
            </div>
          </div>
        `
      },
      accessControl: {
        icon: '👤',
        title: 'Access Control',
        description: 'Weak access controls create unnecessary attack vectors.',
        training: `
          <div class="training-section">
            <h3>🎓 Lock Down Your Access</h3>
            <p>Implement defense-in-depth security layers.</p>

            <div class="exercise-box">
              <div class="exercise-header">
                <div class="exercise-title">🎯 Security Checklist</div>
                <span class="difficulty-badge difficulty-beginner">Beginner</span>
              </div>
              <ul class="checklist">
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Enable 2FA on all exchange accounts</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Use hardware 2FA keys (not SMS)</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Create strong, unique passwords (password manager)</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Whitelist withdrawal addresses</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Set up withdrawal time delays</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Regular security audits of active sessions</span>
                </li>
              </ul>
            </div>
          </div>
        `
      },
      address_reuse: {
        icon: '🎭',
        title: 'Address Reuse & Privacy',
        description: 'Reusing addresses compromises your privacy and security.',
        training: `
          <div class="training-section">
            <h3>🎓 Master Bitcoin Privacy</h3>
            <p>Learn why address reuse is dangerous and how to protect your privacy.</p>

            <div class="exercise-box">
              <div class="exercise-header">
                <div class="exercise-title">🎯 Privacy Best Practices</div>
                <span class="difficulty-badge difficulty-intermediate">Intermediate</span>
              </div>
              <ul class="checklist">
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Always generate new address for each transaction</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Use coin control to manage UTXOs</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Avoid linking identities to addresses</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Consider CoinJoin for privacy</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Run Bitcoin Core over Tor</span>
                </li>
              </ul>
            </div>

            <div class="simulator" style="margin-top: 2rem;">
              <h4>🔍 Address Reuse Demonstration</h4>
              <p style="color: var(--color-muted); margin-bottom: 1rem;">
                See how address reuse exposes your entire transaction history:
              </p>
              <div style="display: grid; gap: 1rem;">
                <div style="padding: 1rem; background: var(--color-surface); border-radius: 8px;">
                  <strong style="color: var(--high);">❌ Reused Address:</strong><br/>
                  <code style="color: var(--color-muted); font-size: 0.9rem;">bc1qreused...</code><br/>
                  <span style="color: var(--color-muted);">
                    15 transactions visible • Total balance exposed • Links all payments
                  </span>
                </div>
                <div style="padding: 1rem; background: var(--color-surface); border-radius: 8px;">
                  <strong style="color: var(--success);">✅ New Address Each Time:</strong><br/>
                  <code style="color: var(--color-muted); font-size: 0.9rem;">bc1qnew1...</code>
                  <code style="color: var(--color-muted); font-size: 0.9rem;">bc1qnew2...</code>
                  <code style="color: var(--color-muted); font-size: 0.9rem;">bc1qnew3...</code><br/>
                  <span style="color: var(--color-muted);">
                    1 transaction each • Balance private • Payments unlinked
                  </span>
                </div>
              </div>
            </div>
          </div>
        `
      },
      malware: {
        icon: '🦠',
        title: 'Malware Protection',
        description: 'Malware can steal seeds, replace addresses, and drain wallets.',
        training: `
          <div class="training-section">
            <h3>🎓 Defend Against Malware</h3>
            <p>Protect your devices and Bitcoin from malicious software.</p>

            <div class="exercise-box">
              <div class="exercise-header">
                <div class="exercise-title">🎯 Anti-Malware Checklist</div>
                <span class="difficulty-badge difficulty-intermediate">Intermediate</span>
              </div>
              <ul class="checklist">
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Use dedicated device for Bitcoin transactions</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Keep OS and software updated</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Install reputable antivirus software</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Verify wallet software signatures</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Never enter seed phrase on internet-connected device</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Double-check recipient addresses before sending</span>
                </li>
              </ul>
            </div>
          </div>
        `
      },
      exchange_hack: {
        icon: '🏦',
        title: 'Exchange Risk',
        description: 'Not your keys, not your coins. Exchange hacks are common.',
        training: `
          <div class="training-section">
            <h3>🎓 Self-Custody First</h3>
            <p>Learn why keeping Bitcoin on exchanges is dangerous.</p>

            <div class="simulator" style="margin-bottom: 2rem;">
              <h4>📊 Famous Exchange Hacks</h4>
              <div style="display: grid; gap: 1rem; margin-top: 1rem;">
                <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                  <strong>Mt. Gox (2014):</strong>
                  <span style="color: var(--color-muted);">850,000 BTC stolen (~$460M then, $40B+ now)</span>
                </div>
                <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                  <strong>QuadrigaCX (2019):</strong>
                  <span style="color: var(--color-muted);">$190M lost when CEO "died" with keys</span>
                </div>
                <div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 8px;">
                  <strong>FTX (2022):</strong>
                  <span style="color: var(--color-muted);">$8B+ customer funds misused and lost</span>
                </div>
              </div>
            </div>

            <div class="exercise-box">
              <div class="exercise-header">
                <div class="exercise-title">🎯 Self-Custody Action Plan</div>
                <span class="difficulty-badge difficulty-beginner">Beginner</span>
              </div>
              <ul class="checklist">
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Withdraw all Bitcoin from exchanges to personal wallet</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Use exchanges only for buying/selling (not storage)</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Set up hardware wallet for long-term storage</span>
                </li>
                <li onclick="toggleCheck(this)">
                  <div class="checkbox"></div>
                  <span>Practice "not your keys, not your coins"</span>
                </li>
              </ul>
            </div>
          </div>
        `
      }
    };

    // Multi-sig simulator logic
    let signatures = new Set();

    window.signKey = function(keyNumber) {
      if (signatures.has(keyNumber)) {
        signatures.delete(keyNumber);
        document.querySelector(`[data-key="${keyNumber}"]`).classList.remove('active');
      } else {
        signatures.add(keyNumber);
        document.querySelector(`[data-key="${keyNumber}"]`).classList.add('active');
      }

      const sigCount = signatures.size;
      document.getElementById('sig-count').textContent = sigCount;
      document.getElementById('sig-progress').style.width = (sigCount / 2 * 100) + '%';

      const broadcastBtn = document.getElementById('broadcast-btn');
      if (sigCount >= 2) {
        broadcastBtn.style.opacity = '1';
        broadcastBtn.style.cursor = 'pointer';
        broadcastBtn.disabled = false;
        broadcastBtn.onclick = () => {
          alert('🎉 Transaction broadcasted successfully!\n\nYou just experienced how multi-sig protects your funds. Even if one key is compromised, the attacker cannot move your Bitcoin without a second signature.');
        };
      } else {
        broadcastBtn.style.opacity = '0.5';
        broadcastBtn.style.cursor = 'not-allowed';
        broadcastBtn.disabled = true;
      }
    };

    // Toggle checklist items
    window.toggleCheck = function(element) {
      element.classList.toggle('completed');
      updateBeltRank();
    };

    function updateBeltRank() {
      const totalChecks = document.querySelectorAll('.checklist li').length;
      const completedChecks = document.querySelectorAll('.checklist li.completed').length;

      if (totalChecks > 0 && auditData) {
        const checkProgress = (completedChecks / totalChecks) * 30; // 30 points max from exercises
        const totalScore = auditData.score + checkProgress;
        const belt = getBeltRank(Math.min(totalScore, 100));
        document.getElementById('belt-rank').textContent = `🥋 ${belt}`;
      }
    }

    // Run audit
    document.getElementById('btn-audit').addEventListener('click', async () => {
      document.getElementById('hero-section').style.display = 'none';
      document.getElementById('loading').style.display = 'block';

      try {
        auditData = await auditor.performSecurityAudit({ type: 'wallet', id: 'preview' }, 'intermediate');

        setTimeout(() => {
          document.getElementById('loading').style.display = 'none';
          displayAuditResults(auditData);
        }, 1500);
      } catch (error) {
        console.error('Audit failed:', error);
        alert('Audit failed. Please try again.');
        document.getElementById('hero-section').style.display = 'block';
        document.getElementById('loading').style.display = 'none';
      }
    });

    function displayAuditResults(data) {
      const dashboard = document.getElementById('dashboard');
      dashboard.style.display = 'block';

      // Update score
      const score = data.score;
      const grade = data.report.executive_summary.grade;
      const scoreAngle = (score / 100) * 360;

      document.getElementById('score-circle').style.setProperty('--score-angle', scoreAngle + 'deg');
      document.getElementById('score-number').textContent = score;
      document.getElementById('score-grade').textContent = grade;

      // Update status
      const statusEl = document.getElementById('score-status');
      const criticalIssues = data.report.executive_summary.critical_issues;
      const highIssues = data.report.executive_summary.high_issues;

      if (score >= 80) {
        statusEl.textContent = '✅ Excellent Security';
        statusEl.className = 'score-status status-good';
      } else if (score >= 60) {
        statusEl.textContent = '⚠️ Needs Improvement';
        statusEl.className = 'score-status status-warning';
      } else {
        statusEl.textContent = '🚨 Critical Risk';
        statusEl.className = 'score-status status-critical';
      }

      document.getElementById('critical-count').textContent = criticalIssues;
      document.getElementById('high-count').textContent = highIssues;
      document.getElementById('total-vuln').textContent = data.vulnerabilities.length;

      // Display vulnerabilities
      const vulnGrid = document.getElementById('vuln-grid');
      vulnGrid.innerHTML = '';

      data.vulnerabilities.forEach((vuln, index) => {
        const template = vulnTemplates[vuln.type];
        if (!template) return;

        const card = document.createElement('div');
        card.className = `vuln-card ${vuln.severity}`;
        card.innerHTML = `
          <div class="vuln-header">
            <div class="vuln-icon">${template.icon}</div>
            <div class="vuln-info">
              <div class="vuln-title">
                ${template.title}
                <span class="severity-badge severity-${vuln.severity}">${vuln.severity}</span>
              </div>
              <div class="vuln-description">${vuln.description}</div>
              <button class="action-button" onclick="expandVuln(${index})">
                Start Training →
              </button>
            </div>
          </div>
          <div class="vuln-details" id="vuln-details-${index}">
            ${template.training}
          </div>
        `;
        vulnGrid.appendChild(card);
      });

      // Display recommendations
      displayRecommendations(data.report.action_plan);

      // Update belt
      const belt = getBeltRank(score);
      document.getElementById('belt-rank').textContent = `🥋 ${belt}`;
    }

    window.expandVuln = function(index) {
      const cards = document.querySelectorAll('.vuln-card');
      const card = cards[index];

      // Close all other cards
      cards.forEach((c, i) => {
        if (i !== index) {
          c.classList.remove('expanded');
        }
      });

      // Toggle current card
      card.classList.toggle('expanded');

      // Scroll to card
      if (card.classList.contains('expanded')) {
        setTimeout(() => {
          card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
      }
    };

    function displayRecommendations(actionPlan) {
      // Immediate
      const immediateEl = document.getElementById('immediate-recs');
      immediateEl.innerHTML = actionPlan.immediate.length ?
        actionPlan.immediate.map(rec => createRecItem(rec)).join('') :
        '<p style="color: var(--color-muted);">No immediate critical actions required.</p>';

      // Short-term
      const shortTermEl = document.getElementById('short-term-recs');
      shortTermEl.innerHTML = actionPlan.short_term.map(rec => createRecItem(rec)).join('');

      // Long-term
      const longTermEl = document.getElementById('long-term-recs');
      longTermEl.innerHTML = actionPlan.long_term.map(rec => createRecItem(rec)).join('');
    }

    function createRecItem(rec) {
      return `
        <div class="rec-item priority-${rec.priority}">
          <div class="rec-content">
            <div class="rec-text">${rec.recommendation}</div>
            <div class="rec-category-tag">${rec.category}</div>
          </div>
          <div class="rec-action">
            <span class="severity-badge severity-${rec.priority === 'high' ? 'high' : rec.priority === 'medium' ? 'medium' : 'low'}">${rec.priority}</span>
          </div>
        </div>
      `;
    }

    // Load saved progress
    function loadProgress() {
      const saved = localStorage.getItem('securityDojoProgress');
      if (saved) {
        const progress = JSON.parse(saved);
        completedExercises = new Set(progress.completed || []);
      }
    }

    function saveProgress() {
      const progress = {
        completed: Array.from(completedExercises),
        lastUpdate: Date.now()
      };
      localStorage.setItem('securityDojoProgress', JSON.stringify(progress));
    }

    loadProgress();
  </script>
</body>
</html>
